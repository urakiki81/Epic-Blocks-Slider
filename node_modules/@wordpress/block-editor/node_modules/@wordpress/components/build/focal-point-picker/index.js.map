{"version":3,"sources":["@wordpress/components/src/focal-point-picker/index.js"],"names":["FocalPointPicker","props","arguments","state","isDragging","bounds","INITIAL_BOUNDS","percentages","value","containerRef","mediaRef","handleOnClick","bind","handleOnMouseUp","handleOnKeyDown","onMouseMove","updateBounds","updateValue","document","addEventListener","window","prevProps","url","setState","x","y","removeEventListener","current","dimensions","width","clientWidth","height","clientHeight","pickerDimensions","widthRatio","heightRatio","right","top","bottom","left","nextValue","onChange","nextPercentage","parseFloat","toFixed","calculateBounds","event","persist","keyCode","shiftKey","UP","DOWN","LEFT","RIGHT","includes","preventDefault","nextX","nextY","step","cursorPosition","pageX","pageY","Math","max","min","containerNode","getBoundingClientRect","body","scrollTop","undefined","iconCoordinates","autoPlay","className","help","instanceId","label","onDragStart","onDragEnd","classes","id","Component","defaultProps","noop","withInstanceId","withFocusOutside"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { noop } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component, createRef } from '@wordpress/element';\nimport { withInstanceId, compose } from '@wordpress/compose';\nimport { UP, DOWN, LEFT, RIGHT } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport withFocusOutside from '../higher-order/with-focus-outside';\nimport BaseControl from '../base-control';\nimport Controls from './controls';\nimport FocalPoint from './focal-point';\nimport Grid from './grid';\nimport Media from './media';\nimport {\n\tMediaWrapper,\n\tMediaContainer,\n} from './styles/focal-point-picker-style';\nimport { roundClamp } from '../utils/math';\nimport { INITIAL_BOUNDS } from './utils';\n\nexport class FocalPointPicker extends Component {\n\tconstructor( props ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.state = {\n\t\t\tisDragging: false,\n\t\t\tbounds: INITIAL_BOUNDS,\n\t\t\tpercentages: props.value,\n\t\t};\n\n\t\tthis.containerRef = createRef();\n\t\tthis.mediaRef = createRef();\n\n\t\tthis.handleOnClick = this.handleOnClick.bind( this );\n\t\tthis.handleOnMouseUp = this.handleOnMouseUp.bind( this );\n\t\tthis.handleOnKeyDown = this.handleOnKeyDown.bind( this );\n\t\tthis.onMouseMove = this.onMouseMove.bind( this );\n\n\t\tthis.updateBounds = this.updateBounds.bind( this );\n\t\tthis.updateValue = this.updateValue.bind( this );\n\t}\n\tcomponentDidMount() {\n\t\tdocument.addEventListener( 'mouseup', this.handleOnMouseUp );\n\t\twindow.addEventListener( 'resize', this.updateBounds );\n\t}\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( prevProps.url !== this.props.url ) {\n\t\t\tthis.setState( {\n\t\t\t\tisDragging: false,\n\t\t\t} );\n\t\t}\n\t\t/**\n\t\t * Handles cases where the incoming value changes.\n\t\t * An example is the values resetting based on an UNDO action.\n\t\t */\n\t\tif (\n\t\t\tthis.props.value.x !== this.state.percentages.x ||\n\t\t\tthis.props.value.y !== this.state.percentages.y\n\t\t) {\n\t\t\tthis.setState( { percentages: this.props.value } );\n\t\t}\n\t}\n\tcomponentWillUnmount() {\n\t\tdocument.removeEventListener( 'mouseup', this.handleOnMouseUp );\n\t\twindow.removeEventListener( 'resize', this.updateBounds );\n\t}\n\tcalculateBounds() {\n\t\tconst bounds = INITIAL_BOUNDS;\n\n\t\tif ( ! this.mediaRef.current ) {\n\t\t\treturn bounds;\n\t\t}\n\n\t\tconst dimensions = {\n\t\t\twidth: this.mediaRef.current.clientWidth,\n\t\t\theight: this.mediaRef.current.clientHeight,\n\t\t};\n\t\tconst pickerDimensions = this.pickerDimensions();\n\n\t\tconst widthRatio = pickerDimensions.width / dimensions.width;\n\t\tconst heightRatio = pickerDimensions.height / dimensions.height;\n\n\t\tif ( heightRatio >= widthRatio ) {\n\t\t\tbounds.width = bounds.right = pickerDimensions.width;\n\t\t\tbounds.height = dimensions.height * widthRatio;\n\t\t\tbounds.top = ( pickerDimensions.height - bounds.height ) / 2;\n\t\t\tbounds.bottom = bounds.top + bounds.height;\n\t\t} else {\n\t\t\tbounds.height = bounds.bottom = pickerDimensions.height;\n\t\t\tbounds.width = dimensions.width * heightRatio;\n\t\t\tbounds.left = ( pickerDimensions.width - bounds.width ) / 2;\n\t\t\tbounds.right = bounds.left + bounds.width;\n\t\t}\n\t\treturn bounds;\n\t}\n\tupdateValue( nextValue = {} ) {\n\t\tconst { onChange } = this.props;\n\t\tconst { x, y } = nextValue;\n\n\t\tconst nextPercentage = {\n\t\t\tx: parseFloat( x ).toFixed( 2 ),\n\t\t\ty: parseFloat( y ).toFixed( 2 ),\n\t\t};\n\n\t\tthis.setState( { percentages: nextPercentage }, () => {\n\t\t\tonChange( nextPercentage );\n\t\t} );\n\t}\n\tupdateBounds() {\n\t\tthis.setState( {\n\t\t\tbounds: this.calculateBounds(),\n\t\t} );\n\t}\n\thandleOnClick( event ) {\n\t\tevent.persist();\n\t\tthis.setState( { isDragging: true }, () => {\n\t\t\tthis.onMouseMove( event );\n\t\t} );\n\t}\n\thandleOnMouseUp() {\n\t\tthis.setState( { isDragging: false } );\n\t}\n\thandleOnKeyDown( event ) {\n\t\tconst { keyCode, shiftKey } = event;\n\t\tif ( ! [ UP, DOWN, LEFT, RIGHT ].includes( keyCode ) ) return;\n\n\t\tconst { x, y } = this.state.percentages;\n\n\t\tevent.preventDefault();\n\n\t\t// Normalizing values for incrementing/decrementing based on arrow keys\n\t\tlet nextX = parseFloat( x );\n\t\tlet nextY = parseFloat( y );\n\t\tconst step = shiftKey ? 0.1 : 0.01;\n\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase UP:\n\t\t\t\tnextY = nextY - step;\n\t\t\t\tbreak;\n\t\t\tcase DOWN:\n\t\t\t\tnextY = nextY + step;\n\t\t\t\tbreak;\n\t\t\tcase LEFT:\n\t\t\t\tnextX = nextX - step;\n\t\t\t\tbreak;\n\t\t\tcase RIGHT:\n\t\t\t\tnextX = nextX + step;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tnextX = roundClamp( nextX, 0, 1, step );\n\t\tnextY = roundClamp( nextY, 0, 1, step );\n\n\t\tconst percentages = {\n\t\t\tx: nextX,\n\t\t\ty: nextY,\n\t\t};\n\n\t\tthis.updateValue( percentages );\n\t}\n\tonMouseMove( event ) {\n\t\tconst { isDragging, bounds } = this.state;\n\n\t\tif ( ! isDragging ) return;\n\n\t\tconst { shiftKey } = event;\n\t\tconst pickerDimensions = this.pickerDimensions();\n\t\tconst cursorPosition = {\n\t\t\tleft: event.pageX - pickerDimensions.left,\n\t\t\ttop: event.pageY - pickerDimensions.top,\n\t\t};\n\n\t\tconst left = Math.max(\n\t\t\tbounds.left,\n\t\t\tMath.min( cursorPosition.left, bounds.right )\n\t\t);\n\t\tconst top = Math.max(\n\t\t\tbounds.top,\n\t\t\tMath.min( cursorPosition.top, bounds.bottom )\n\t\t);\n\n\t\tlet nextX =\n\t\t\t( left - bounds.left ) /\n\t\t\t( pickerDimensions.width - bounds.left * 2 );\n\t\tlet nextY =\n\t\t\t( top - bounds.top ) / ( pickerDimensions.height - bounds.top * 2 );\n\n\t\t// Enables holding shift to jump values by 10%\n\t\tconst step = shiftKey ? 0.1 : 0.01;\n\n\t\tnextX = roundClamp( nextX, 0, 1, step );\n\t\tnextY = roundClamp( nextY, 0, 1, step );\n\n\t\tconst nextPercentage = {\n\t\t\tx: nextX,\n\t\t\ty: nextY,\n\t\t};\n\n\t\tthis.updateValue( nextPercentage );\n\t}\n\tpickerDimensions() {\n\t\tconst containerNode = this.containerRef.current;\n\n\t\tif ( ! containerNode ) {\n\t\t\treturn {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0,\n\t\t\t\tleft: 0,\n\t\t\t\ttop: 0,\n\t\t\t};\n\t\t}\n\n\t\tconst { clientHeight, clientWidth } = containerNode;\n\t\tconst { top, left } = containerNode.getBoundingClientRect();\n\n\t\treturn {\n\t\t\twidth: clientWidth,\n\t\t\theight: clientHeight,\n\t\t\ttop: top + document.body.scrollTop,\n\t\t\tleft,\n\t\t};\n\t}\n\ticonCoordinates() {\n\t\tconst { value } = this.props;\n\t\tconst { bounds } = this.state;\n\n\t\tif ( bounds.left === undefined || bounds.top === undefined ) {\n\t\t\treturn {\n\t\t\t\tleft: '50%',\n\t\t\t\ttop: '50%',\n\t\t\t};\n\t\t}\n\n\t\tconst pickerDimensions = this.pickerDimensions();\n\t\tconst iconCoordinates = {\n\t\t\tleft:\n\t\t\t\tvalue.x * ( pickerDimensions.width - bounds.left * 2 ) +\n\t\t\t\tbounds.left,\n\t\t\ttop:\n\t\t\t\tvalue.y * ( pickerDimensions.height - bounds.top * 2 ) +\n\t\t\t\tbounds.top,\n\t\t};\n\n\t\treturn iconCoordinates;\n\t}\n\t// Callback method for the withFocusOutside higher-order component\n\thandleFocusOutside() {\n\t\tthis.setState( {\n\t\t\tisDragging: false,\n\t\t} );\n\t}\n\trender() {\n\t\tconst {\n\t\t\tautoPlay,\n\t\t\tclassName,\n\t\t\thelp,\n\t\t\tinstanceId,\n\t\t\tlabel,\n\t\t\tonDragStart,\n\t\t\tonDragEnd,\n\t\t\turl,\n\t\t} = this.props;\n\t\tconst { bounds, isDragging, percentages } = this.state;\n\t\tconst iconCoordinates = this.iconCoordinates();\n\n\t\tconst classes = classnames(\n\t\t\t'components-focal-point-picker-control',\n\t\t\tclassName\n\t\t);\n\n\t\tconst id = `inspector-focal-point-picker-control-${ instanceId }`;\n\n\t\treturn (\n\t\t\t<BaseControl\n\t\t\t\tlabel={ label }\n\t\t\t\tid={ id }\n\t\t\t\thelp={ help }\n\t\t\t\tclassName={ classes }\n\t\t\t>\n\t\t\t\t<MediaWrapper className=\"components-focal-point-picker-wrapper\">\n\t\t\t\t\t<MediaContainer\n\t\t\t\t\t\tclassName=\"components-focal-point-picker\"\n\t\t\t\t\t\tonDragStart={ ( event ) => {\n\t\t\t\t\t\t\tthis.setState( { isDragging: true } );\n\t\t\t\t\t\t\tonDragStart( event );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tonDrop={ ( event ) => {\n\t\t\t\t\t\t\tthis.setState( { isDragging: false } );\n\t\t\t\t\t\t\tonDragEnd( event );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tonKeyDown={ this.handleOnKeyDown }\n\t\t\t\t\t\tonMouseDown={ this.handleOnClick }\n\t\t\t\t\t\tonMouseMove={ this.onMouseMove }\n\t\t\t\t\t\tonMouseUp={ this.handleOnMouseUp }\n\t\t\t\t\t\tref={ this.containerRef }\n\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Grid\n\t\t\t\t\t\t\tbounds={ bounds }\n\t\t\t\t\t\t\tvalue={ percentages.x + percentages.y }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Media\n\t\t\t\t\t\t\talt={ __( 'Media preview' ) }\n\t\t\t\t\t\t\tautoPlay={ autoPlay }\n\t\t\t\t\t\t\tmediaRef={ this.mediaRef }\n\t\t\t\t\t\t\tonLoad={ this.updateBounds }\n\t\t\t\t\t\t\tsrc={ url }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<FocalPoint\n\t\t\t\t\t\t\tcoordinates={ iconCoordinates }\n\t\t\t\t\t\t\tisDragging={ isDragging }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</MediaContainer>\n\t\t\t\t</MediaWrapper>\n\t\t\t\t<Controls\n\t\t\t\t\tpercentages={ percentages }\n\t\t\t\t\tonChange={ this.updateValue }\n\t\t\t\t/>\n\t\t\t</BaseControl>\n\t\t);\n\t}\n}\n\nFocalPointPicker.defaultProps = {\n\tautoPlay: true,\n\tonDragStart: noop,\n\tonDragEnd: noop,\n\tonChange: noop,\n\tvalue: {\n\t\tx: 0.5,\n\t\ty: 0.5,\n\t},\n\turl: null,\n};\n\nexport default compose( [ withInstanceId, withFocusOutside ] )(\n\tFocalPointPicker\n);\n"]}