{"version":3,"sources":["@wordpress/block-editor/src/components/media-upload/index.native.js"],"names":["MEDIA_TYPE_IMAGE","MEDIA_TYPE_VIDEO","OPTION_TAKE_VIDEO","OPTION_TAKE_PHOTO","OPTION_TAKE_PHOTO_OR_VIDEO","MediaUpload","props","onPickerPresent","bind","onPickerSelect","getAllSources","state","otherMediaOptions","allowedTypes","otherMediaOptionsWithIcons","map","option","types","id","value","setState","cameraImageSource","mediaSources","deviceCamera","label","icon","capturePhoto","cameraVideoSource","captureVideo","deviceLibrarySource","deviceLibrary","image","siteLibrarySource","siteMediaLibrary","wordpress","mediaLibrary","internalSources","concat","__experimentalOnlyMediaLibrary","filter","source","some","allowedType","includes","getChooseFromDeviceIcon","isOneType","length","isImage","isVideo","picker","presentPicker","onSelect","multiple","mediaSource","shift","type","media","isReplacingMedia","isImageOrVideo","pickerTitle","getMediaOptions","instance","getMediaOptionsItems","render","open","React","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAGA;;AAKA;;AACA;;AACA;;AAKA;;;;;;;;;;AAEO,IAAMA,gBAAgB,GAAG,OAAzB;;AACA,IAAMC,gBAAgB,GAAG,OAAzB;;AAEA,IAAMC,iBAAiB,GAAG,cAAI,cAAJ,CAA1B;;AACA,IAAMC,iBAAiB,GAAG,cAAI,cAAJ,CAA1B;;AACA,IAAMC,0BAA0B,GAAG,cAAI,uBAAJ,CAAnC;;;IAEMC,W;;;;;AACZ,uBAAaC,KAAb,EAAqB;AAAA;;AAAA;AACpB,8BAAOA,KAAP;AACA,UAAKC,eAAL,GAAuB,MAAKA,eAAL,CAAqBC,IAArB,6CAAvB;AACA,UAAKC,cAAL,GAAsB,MAAKA,cAAL,CAAoBD,IAApB,6CAAtB;AACA,UAAKE,aAAL,GAAqB,MAAKA,aAAL,CAAmBF,IAAnB,6CAArB;AAEA,UAAKG,KAAL,GAAa;AACZC,MAAAA,iBAAiB,EAAE;AADP,KAAb;AANoB;AASpB;;;;wCAEmB;AAAA;;AAAA,kCACW,KAAKN,KADhB,CACXO,YADW;AAAA,UACXA,YADW,sCACI,EADJ;AAEnB,mDAAsBA,YAAtB,EAAoC,UAAED,iBAAF,EAAyB;AAC5D,YAAME,0BAA0B,GAAGF,iBAAiB,CAACG,GAAlB,CAClC,UAAEC,MAAF,EAAc;AACb,mCACIA,MADJ;AAECC,YAAAA,KAAK,EAAEJ,YAFR;AAGCK,YAAAA,EAAE,EAAEF,MAAM,CAACG;AAHZ;AAKA,SAPiC,CAAnC;;AAUA,QAAA,MAAI,CAACC,QAAL,CAAe;AAAER,UAAAA,iBAAiB,EAAEE;AAArB,SAAf;AACA,OAZD;AAaA;;;oCAEe;AACf,UAAMO,iBAAiB,GAAG;AACzBH,QAAAA,EAAE,EAAEI,gCAAaC,YADQ;AACM;AAC/BJ,QAAAA,KAAK,EAAEG,gCAAaC,YAAb,GAA4B,QAFV;AAEoB;AAC7CC,QAAAA,KAAK,EAAE,cAAI,cAAJ,CAHkB;AAIzBP,QAAAA,KAAK,EAAE,CAAEjB,gBAAF,CAJkB;AAKzByB,QAAAA,IAAI,EAAEC;AALmB,OAA1B;AAQA,UAAMC,iBAAiB,GAAG;AACzBT,QAAAA,EAAE,EAAEI,gCAAaC,YADQ;AAEzBJ,QAAAA,KAAK,EAAEG,gCAAaC,YAFK;AAGzBC,QAAAA,KAAK,EAAE,cAAI,cAAJ,CAHkB;AAIzBP,QAAAA,KAAK,EAAE,CAAEhB,gBAAF,CAJkB;AAKzBwB,QAAAA,IAAI,EAAEG;AALmB,OAA1B;AAQA,UAAMC,mBAAmB,GAAG;AAC3BX,QAAAA,EAAE,EAAEI,gCAAaQ,aADU;AAE3BX,QAAAA,KAAK,EAAEG,gCAAaQ,aAFO;AAG3BN,QAAAA,KAAK,EAAE,cAAI,oBAAJ,CAHoB;AAI3BP,QAAAA,KAAK,EAAE,CAAEjB,gBAAF,EAAoBC,gBAApB,CAJoB;AAK3BwB,QAAAA,IAAI,EAAEM;AALqB,OAA5B;AAQA,UAAMC,iBAAiB,GAAG;AACzBd,QAAAA,EAAE,EAAEI,gCAAaW,gBADQ;AAEzBd,QAAAA,KAAK,EAAEG,gCAAaW,gBAFK;AAGzBT,QAAAA,KAAK,EAAE,cAAI,yBAAJ,CAHkB;AAIzBP,QAAAA,KAAK,EAAE,CAAEjB,gBAAF,EAAoBC,gBAApB,CAJkB;AAKzBwB,QAAAA,IAAI,EAAES,gBALmB;AAMzBC,QAAAA,YAAY,EAAE;AANW,OAA1B;AASA,UAAMC,eAAe,GAAG,CACvBP,mBADuB,EAEvBR,iBAFuB,EAGvBM,iBAHuB,EAIvBK,iBAJuB,CAAxB;AAOA,aAAOI,eAAe,CAACC,MAAhB,CAAwB,KAAK1B,KAAL,CAAWC,iBAAnC,CAAP;AACA;;;2CAEsB;AAAA;;AAAA,wBAIlB,KAAKN,KAJa;AAAA,+CAErBO,YAFqB;AAAA,UAErBA,YAFqB,uCAEN,EAFM;AAAA,UAGrByB,8BAHqB,eAGrBA,8BAHqB;AAMtB,aAAO,KAAK5B,aAAL,GACL6B,MADK,CACG,UAAEC,MAAF,EAAc;AACtB,eAAOF,8BAA8B,GAClCE,MAAM,CAACL,YAD2B,GAElCtB,YAAY,CAAC4B,IAAb,CAAmB,UAAEC,WAAF;AAAA,iBACnBF,MAAM,CAACvB,KAAP,CAAa0B,QAAb,CAAuBD,WAAvB,CADmB;AAAA,SAAnB,CAFH;AAKA,OAPK,EAQL3B,GARK,CAQA,UAAEyB,MAAF,EAAc;AACnB,iCACIA,MADJ;AAECf,UAAAA,IAAI,EAAEe,MAAM,CAACf,IAAP,IAAe,MAAI,CAACmB,uBAAL;AAFtB;AAIA,OAbK,CAAP;AAcA;;;8CAEyB;AAAA,mCACK,KAAKtC,KADV,CACjBO,YADiB;AAAA,UACjBA,YADiB,uCACF,EADE;AAGzB,UAAMgC,SAAS,GAAGhC,YAAY,CAACiC,MAAb,KAAwB,CAA1C;AACA,UAAMC,OAAO,GAAGF,SAAS,IAAIhC,YAAY,CAAC8B,QAAb,CAAuB3C,gBAAvB,CAA7B;AACA,UAAMgD,OAAO,GAAGH,SAAS,IAAIhC,YAAY,CAAC8B,QAAb,CAAuB1C,gBAAvB,CAA7B;;AAEA,UAAK8C,OAAO,IAAI,CAAEF,SAAlB,EAA8B;AAC7B,eAAO,cAAP;AACA,OAFD,MAEO,IAAKG,OAAL,EAAe;AACrB,eAAO,cAAP;AACA;AACD;;;sCAEiB;AACjB,UAAK,KAAKC,MAAV,EAAmB;AAClB,aAAKA,MAAL,CAAYC,aAAZ;AACA;AACD;;;mCAEe/B,K,EAAQ;AAAA,yBACmC,KAAKb,KADxC;AAAA,+CACfO,YADe;AAAA,UACfA,YADe,sCACA,EADA;AAAA,UACIsC,QADJ,gBACIA,QADJ;AAAA,+CACcC,QADd;AAAA,UACcA,QADd,sCACyB,KADzB;AAEvB,UAAMC,WAAW,GAAG,KAAK3C,aAAL,GAClB6B,MADkB,CACV,UAAEC,MAAF;AAAA,eAAcA,MAAM,CAACrB,KAAP,KAAiBA,KAA/B;AAAA,OADU,EAElBmC,KAFkB,EAApB;AAGA,UAAMrC,KAAK,GAAGJ,YAAY,CAAC0B,MAAb,CAAqB,UAAEgB,IAAF;AAAA,eAClCF,WAAW,CAACpC,KAAZ,CAAkB0B,QAAlB,CAA4BY,IAA5B,CADkC;AAAA,OAArB,CAAd;AAIA,iDAAoBF,WAAW,CAACnC,EAAhC,EAAoCD,KAApC,EAA2CmC,QAA3C,EAAqD,UAAEI,KAAF,EAAa;AACjE,YAAOJ,QAAQ,IAAII,KAAd,IAA2BA,KAAK,IAAIA,KAAK,CAACtC,EAA/C,EAAsD;AACrDiC,UAAAA,QAAQ,CAAEK,KAAF,CAAR;AACA;AACD,OAJD;AAKA;;;6BAEQ;AAAA;;AAAA,yBACwC,KAAKlD,KAD7C;AAAA,+CACAO,YADA;AAAA,UACAA,YADA,sCACe,EADf;AAAA,UACmB4C,gBADnB,gBACmBA,gBADnB;AAER,UAAMZ,SAAS,GAAGhC,YAAY,CAACiC,MAAb,KAAwB,CAA1C;AACA,UAAMC,OAAO,GAAGF,SAAS,IAAIhC,YAAY,CAAC8B,QAAb,CAAuB3C,gBAAvB,CAA7B;AACA,UAAMgD,OAAO,GAAGH,SAAS,IAAIhC,YAAY,CAAC8B,QAAb,CAAuB1C,gBAAvB,CAA7B;AACA,UAAMyD,cAAc,GACnB7C,YAAY,CAACiC,MAAb,KAAwB,CAAxB,IACAjC,YAAY,CAAC8B,QAAb,CAAuB3C,gBAAvB,CADA,IAEAa,YAAY,CAAC8B,QAAb,CAAuB1C,gBAAvB,CAHD;AAKA,UAAI0D,WAAJ;;AACA,UAAKZ,OAAL,EAAe;AACd,YAAKU,gBAAL,EAAwB;AACvBE,UAAAA,WAAW,GAAG,cAAI,eAAJ,CAAd;AACA,SAFD,MAEO;AACNA,UAAAA,WAAW,GAAG,cAAI,cAAJ,CAAd;AACA;AACD,OAND,MAMO,IAAKX,OAAL,EAAe;AACrB,YAAKS,gBAAL,EAAwB;AACvBE,UAAAA,WAAW,GAAG,cAAI,eAAJ,CAAd;AACA,SAFD,MAEO;AACNA,UAAAA,WAAW,GAAG,cAAI,cAAJ,CAAd;AACA;AACD,OANM,MAMA,IAAKD,cAAL,EAAsB;AAC5B,YAAKD,gBAAL,EAAwB;AACvBE,UAAAA,WAAW,GAAG,cAAI,wBAAJ,CAAd;AACA,SAFD,MAEO;AACNA,UAAAA,WAAW,GAAG,cAAI,uBAAJ,CAAd;AACA;AACD;;AAED,UAAMC,eAAe,GAAG,SAAlBA,eAAkB;AAAA,eACvB,4BAAC,kBAAD;AACC,UAAA,KAAK,EAAGD,WADT;AAEC,UAAA,gBAAgB,MAFjB;AAGC,UAAA,GAAG,EAAG,aAAEE,QAAF;AAAA,mBAAkB,MAAI,CAACZ,MAAL,GAAcY,QAAhC;AAAA,WAHP;AAIC,UAAA,OAAO,EAAG,MAAI,CAACC,oBAAL,EAJX;AAKC,UAAA,QAAQ,EAAG,MAAI,CAACrD;AALjB,UADuB;AAAA,OAAxB;;AAUA,aAAO,KAAKH,KAAL,CAAWyD,MAAX,CAAmB;AACzBC,QAAAA,IAAI,EAAE,KAAKzD,eADc;AAEzBqD,QAAAA,eAAe,EAAfA;AAFyB,OAAnB,CAAP;AAIA;;;EAhL+BK,eAAMC,S;;;eAmLxB7D,W","sourcesContent":["/**\n * External dependencies\n */\nimport React from 'react';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Picker } from '@wordpress/components';\nimport {\n\tgetOtherMediaOptions,\n\trequestMediaPicker,\n\tmediaSources,\n} from '@wordpress/react-native-bridge';\nimport { capturePhoto, captureVideo, image, wordpress } from '@wordpress/icons';\n\nexport const MEDIA_TYPE_IMAGE = 'image';\nexport const MEDIA_TYPE_VIDEO = 'video';\n\nexport const OPTION_TAKE_VIDEO = __( 'Take a Video' );\nexport const OPTION_TAKE_PHOTO = __( 'Take a Photo' );\nexport const OPTION_TAKE_PHOTO_OR_VIDEO = __( 'Take a Photo or Video' );\n\nexport class MediaUpload extends React.Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\t\tthis.onPickerPresent = this.onPickerPresent.bind( this );\n\t\tthis.onPickerSelect = this.onPickerSelect.bind( this );\n\t\tthis.getAllSources = this.getAllSources.bind( this );\n\n\t\tthis.state = {\n\t\t\totherMediaOptions: [],\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { allowedTypes = [] } = this.props;\n\t\tgetOtherMediaOptions( allowedTypes, ( otherMediaOptions ) => {\n\t\t\tconst otherMediaOptionsWithIcons = otherMediaOptions.map(\n\t\t\t\t( option ) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...option,\n\t\t\t\t\t\ttypes: allowedTypes,\n\t\t\t\t\t\tid: option.value,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.setState( { otherMediaOptions: otherMediaOptionsWithIcons } );\n\t\t} );\n\t}\n\n\tgetAllSources() {\n\t\tconst cameraImageSource = {\n\t\t\tid: mediaSources.deviceCamera, // ID is the value sent to native\n\t\t\tvalue: mediaSources.deviceCamera + '-IMAGE', // This is needed to diferenciate image-camera from video-camera sources.\n\t\t\tlabel: __( 'Take a Photo' ),\n\t\t\ttypes: [ MEDIA_TYPE_IMAGE ],\n\t\t\ticon: capturePhoto,\n\t\t};\n\n\t\tconst cameraVideoSource = {\n\t\t\tid: mediaSources.deviceCamera,\n\t\t\tvalue: mediaSources.deviceCamera,\n\t\t\tlabel: __( 'Take a Video' ),\n\t\t\ttypes: [ MEDIA_TYPE_VIDEO ],\n\t\t\ticon: captureVideo,\n\t\t};\n\n\t\tconst deviceLibrarySource = {\n\t\t\tid: mediaSources.deviceLibrary,\n\t\t\tvalue: mediaSources.deviceLibrary,\n\t\t\tlabel: __( 'Choose from device' ),\n\t\t\ttypes: [ MEDIA_TYPE_IMAGE, MEDIA_TYPE_VIDEO ],\n\t\t\ticon: image,\n\t\t};\n\n\t\tconst siteLibrarySource = {\n\t\t\tid: mediaSources.siteMediaLibrary,\n\t\t\tvalue: mediaSources.siteMediaLibrary,\n\t\t\tlabel: __( 'WordPress Media Library' ),\n\t\t\ttypes: [ MEDIA_TYPE_IMAGE, MEDIA_TYPE_VIDEO ],\n\t\t\ticon: wordpress,\n\t\t\tmediaLibrary: true,\n\t\t};\n\n\t\tconst internalSources = [\n\t\t\tdeviceLibrarySource,\n\t\t\tcameraImageSource,\n\t\t\tcameraVideoSource,\n\t\t\tsiteLibrarySource,\n\t\t];\n\n\t\treturn internalSources.concat( this.state.otherMediaOptions );\n\t}\n\n\tgetMediaOptionsItems() {\n\t\tconst {\n\t\t\tallowedTypes = [],\n\t\t\t__experimentalOnlyMediaLibrary,\n\t\t} = this.props;\n\n\t\treturn this.getAllSources()\n\t\t\t.filter( ( source ) => {\n\t\t\t\treturn __experimentalOnlyMediaLibrary\n\t\t\t\t\t? source.mediaLibrary\n\t\t\t\t\t: allowedTypes.some( ( allowedType ) =>\n\t\t\t\t\t\t\tsource.types.includes( allowedType )\n\t\t\t\t\t  );\n\t\t\t} )\n\t\t\t.map( ( source ) => {\n\t\t\t\treturn {\n\t\t\t\t\t...source,\n\t\t\t\t\ticon: source.icon || this.getChooseFromDeviceIcon(),\n\t\t\t\t};\n\t\t\t} );\n\t}\n\n\tgetChooseFromDeviceIcon() {\n\t\tconst { allowedTypes = [] } = this.props;\n\n\t\tconst isOneType = allowedTypes.length === 1;\n\t\tconst isImage = isOneType && allowedTypes.includes( MEDIA_TYPE_IMAGE );\n\t\tconst isVideo = isOneType && allowedTypes.includes( MEDIA_TYPE_VIDEO );\n\n\t\tif ( isImage || ! isOneType ) {\n\t\t\treturn 'format-image';\n\t\t} else if ( isVideo ) {\n\t\t\treturn 'format-video';\n\t\t}\n\t}\n\n\tonPickerPresent() {\n\t\tif ( this.picker ) {\n\t\t\tthis.picker.presentPicker();\n\t\t}\n\t}\n\n\tonPickerSelect( value ) {\n\t\tconst { allowedTypes = [], onSelect, multiple = false } = this.props;\n\t\tconst mediaSource = this.getAllSources()\n\t\t\t.filter( ( source ) => source.value === value )\n\t\t\t.shift();\n\t\tconst types = allowedTypes.filter( ( type ) =>\n\t\t\tmediaSource.types.includes( type )\n\t\t);\n\n\t\trequestMediaPicker( mediaSource.id, types, multiple, ( media ) => {\n\t\t\tif ( ( multiple && media ) || ( media && media.id ) ) {\n\t\t\t\tonSelect( media );\n\t\t\t}\n\t\t} );\n\t}\n\n\trender() {\n\t\tconst { allowedTypes = [], isReplacingMedia } = this.props;\n\t\tconst isOneType = allowedTypes.length === 1;\n\t\tconst isImage = isOneType && allowedTypes.includes( MEDIA_TYPE_IMAGE );\n\t\tconst isVideo = isOneType && allowedTypes.includes( MEDIA_TYPE_VIDEO );\n\t\tconst isImageOrVideo =\n\t\t\tallowedTypes.length === 2 &&\n\t\t\tallowedTypes.includes( MEDIA_TYPE_IMAGE ) &&\n\t\t\tallowedTypes.includes( MEDIA_TYPE_VIDEO );\n\n\t\tlet pickerTitle;\n\t\tif ( isImage ) {\n\t\t\tif ( isReplacingMedia ) {\n\t\t\t\tpickerTitle = __( 'Replace image' );\n\t\t\t} else {\n\t\t\t\tpickerTitle = __( 'Choose image' );\n\t\t\t}\n\t\t} else if ( isVideo ) {\n\t\t\tif ( isReplacingMedia ) {\n\t\t\t\tpickerTitle = __( 'Replace video' );\n\t\t\t} else {\n\t\t\t\tpickerTitle = __( 'Choose video' );\n\t\t\t}\n\t\t} else if ( isImageOrVideo ) {\n\t\t\tif ( isReplacingMedia ) {\n\t\t\t\tpickerTitle = __( 'Replace image or video' );\n\t\t\t} else {\n\t\t\t\tpickerTitle = __( 'Choose image or video' );\n\t\t\t}\n\t\t}\n\n\t\tconst getMediaOptions = () => (\n\t\t\t<Picker\n\t\t\t\ttitle={ pickerTitle }\n\t\t\t\thideCancelButton\n\t\t\t\tref={ ( instance ) => ( this.picker = instance ) }\n\t\t\t\toptions={ this.getMediaOptionsItems() }\n\t\t\t\tonChange={ this.onPickerSelect }\n\t\t\t/>\n\t\t);\n\n\t\treturn this.props.render( {\n\t\t\topen: this.onPickerPresent,\n\t\t\tgetMediaOptions,\n\t\t} );\n\t}\n}\n\nexport default MediaUpload;\n"]}