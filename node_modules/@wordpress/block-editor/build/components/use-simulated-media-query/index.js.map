{"version":3,"sources":["@wordpress/block-editor/src/components/use-simulated-media-query/index.js"],"names":["ENABLED_MEDIA_QUERY","DISABLED_MEDIA_QUERY","VALID_MEDIA_QUERY_REGEX","getStyleSheetsThatMatchHostname","window","styleSheet","href","location","protocol","host","isReplaceableMediaRule","rule","media","mediaText","match","replaceRule","newRuleText","index","deleteRule","insertRule","replaceMediaQueryWithWidthEvaluation","ruleText","widthValue","replace","matchedSubstring","type","width","useSimulatedMediaQuery","marker","styleSheets","originalStyles","forEach","styleSheetIndex","relevantSection","ruleIndex","cssRules","length","CSSRule","STYLE_RULE","MEDIA_RULE","cssText","RegExp","rulesCollection","originalRuleText"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { filter, get } from 'lodash';\nimport { match } from 'css-mediaquery';\n\n/**\n * WordPress dependencies\n */\nimport { useEffect } from '@wordpress/element';\nimport { getProtocol, getAuthority } from '@wordpress/url';\n\nconst ENABLED_MEDIA_QUERY = '(min-width:0px)';\nconst DISABLED_MEDIA_QUERY = '(min-width:999999px)';\n\nconst VALID_MEDIA_QUERY_REGEX = /\\((min|max)-width:[^\\(]*?\\)/g;\n\nfunction getStyleSheetsThatMatchHostname() {\n\tif ( typeof window === 'undefined' ) {\n\t\treturn [];\n\t}\n\n\treturn filter(\n\t\tget( window, [ 'document', 'styleSheets' ], [] ),\n\t\t( styleSheet ) => {\n\t\t\tif ( ! styleSheet.href ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn (\n\t\t\t\tgetProtocol( styleSheet.href ) === window.location.protocol &&\n\t\t\t\tgetAuthority( styleSheet.href ) === window.location.host\n\t\t\t);\n\t\t}\n\t);\n}\n\nfunction isReplaceableMediaRule( rule ) {\n\tif ( ! rule.media ) {\n\t\treturn false;\n\t}\n\t// Need to use \"media.mediaText\" instead of \"conditionText\" for IE support.\n\treturn !! rule.media.mediaText.match( VALID_MEDIA_QUERY_REGEX );\n}\n\nfunction replaceRule( styleSheet, newRuleText, index ) {\n\tstyleSheet.deleteRule( index );\n\tstyleSheet.insertRule( newRuleText, index );\n}\n\nfunction replaceMediaQueryWithWidthEvaluation( ruleText, widthValue ) {\n\treturn ruleText.replace( VALID_MEDIA_QUERY_REGEX, ( matchedSubstring ) => {\n\t\tif (\n\t\t\tmatch( matchedSubstring, {\n\t\t\t\ttype: 'screen',\n\t\t\t\twidth: widthValue,\n\t\t\t} )\n\t\t) {\n\t\t\treturn ENABLED_MEDIA_QUERY;\n\t\t}\n\t\treturn DISABLED_MEDIA_QUERY;\n\t} );\n}\n\n/**\n * Function that manipulates media queries from stylesheets to simulate a given\n * viewport width.\n *\n * @param {string}  marker CSS selector string defining start and end of\n *                         manipulable styles.\n * @param {number?} width  Viewport width to simulate. If provided null, the\n *                         stylesheets will not be modified.\n */\nexport default function useSimulatedMediaQuery( marker, width ) {\n\tuseEffect( () => {\n\t\tif ( ! width ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst styleSheets = getStyleSheetsThatMatchHostname();\n\t\tconst originalStyles = [];\n\t\tstyleSheets.forEach( ( styleSheet, styleSheetIndex ) => {\n\t\t\tlet relevantSection = false;\n\t\t\tfor (\n\t\t\t\tlet ruleIndex = 0;\n\t\t\t\truleIndex < styleSheet.cssRules.length;\n\t\t\t\t++ruleIndex\n\t\t\t) {\n\t\t\t\tconst rule = styleSheet.cssRules[ ruleIndex ];\n\t\t\t\tif (\n\t\t\t\t\trule.type !== window.CSSRule.STYLE_RULE &&\n\t\t\t\t\trule.type !== window.CSSRule.MEDIA_RULE\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\t! relevantSection &&\n\t\t\t\t\t!! rule.cssText.match( new RegExp( `#start-${ marker }` ) )\n\t\t\t\t) {\n\t\t\t\t\trelevantSection = true;\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\trelevantSection &&\n\t\t\t\t\t!! rule.cssText.match( new RegExp( `#end-${ marker }` ) )\n\t\t\t\t) {\n\t\t\t\t\trelevantSection = false;\n\t\t\t\t}\n\n\t\t\t\tif ( ! relevantSection || ! isReplaceableMediaRule( rule ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst ruleText = rule.cssText;\n\t\t\t\tif ( ! originalStyles[ styleSheetIndex ] ) {\n\t\t\t\t\toriginalStyles[ styleSheetIndex ] = [];\n\t\t\t\t}\n\t\t\t\toriginalStyles[ styleSheetIndex ][ ruleIndex ] = ruleText;\n\t\t\t\treplaceRule(\n\t\t\t\t\tstyleSheet,\n\t\t\t\t\treplaceMediaQueryWithWidthEvaluation( ruleText, width ),\n\t\t\t\t\truleIndex\n\t\t\t\t);\n\t\t\t}\n\t\t} );\n\t\treturn () => {\n\t\t\toriginalStyles.forEach( ( rulesCollection, styleSheetIndex ) => {\n\t\t\t\tif ( ! rulesCollection ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfor (\n\t\t\t\t\tlet ruleIndex = 0;\n\t\t\t\t\truleIndex < rulesCollection.length;\n\t\t\t\t\t++ruleIndex\n\t\t\t\t) {\n\t\t\t\t\tconst originalRuleText = rulesCollection[ ruleIndex ];\n\t\t\t\t\tif ( originalRuleText ) {\n\t\t\t\t\t\treplaceRule(\n\t\t\t\t\t\t\tstyleSheets[ styleSheetIndex ],\n\t\t\t\t\t\t\toriginalRuleText,\n\t\t\t\t\t\t\truleIndex\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\t}, [ width ] );\n}\n"]}