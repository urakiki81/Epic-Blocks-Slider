{"version":3,"sources":["@wordpress/block-editor/src/components/writing-flow/focus-capture.js"],"names":["FocusCapture","ref","selectedClientId","isReverse","containerRef","noCapture","hasMultiSelection","multiSelectionContainer","isNavigationMode","select","setNavigationMode","onFocus","current","focus","tabbables","tabbable","find","length","wrapper","lastTabbable","undefined","position"],"mappings":";;;;;;;AAQA;;AALA;;AAMA;;AACA;;AAKA;;AAfA;;;;AAKA;;;;AAOA;;;;AAKA;;;;;;;;;;;;;;;AAeA,IAAMA,YAAY,GAAG,yBACpB,gBASCC,GATD,EAUK;AAAA,MARHC,gBAQG,QARHA,gBAQG;AAAA,MAPHC,SAOG,QAPHA,SAOG;AAAA,MANHC,YAMG,QANHA,YAMG;AAAA,MALHC,SAKG,QALHA,SAKG;AAAA,MAJHC,iBAIG,QAJHA,iBAIG;AAAA,MAHHC,uBAGG,QAHHA,uBAGG;AACJ,MAAMC,gBAAgB,GAAG,qBAAW,UAAEC,MAAF;AAAA,WACnCA,MAAM,CAAE,mBAAF,CAAN,CAA8BD,gBAA9B,EADmC;AAAA,GAAX,CAAzB;;AADI,qBAI0B,uBAAa,mBAAb,CAJ1B;AAAA,MAIIE,iBAJJ,gBAIIA,iBAJJ;;AAMJ,WAASC,OAAT,GAAmB;AAClB;AACA,QAAKN,SAAS,CAACO,OAAf,EAAyB;AACxBP,MAAAA,SAAS,CAACO,OAAV,GAAoB,IAApB;AACA;AACA,KALiB,CAOlB;AACA;AACA;;;AACA,QAAK,CAAEV,gBAAP,EAA0B;AACzB,UAAKI,iBAAL,EAAyB;AACxBC,QAAAA,uBAAuB,CAACK,OAAxB,CAAgCC,KAAhC;AACA;AACA;;AAEDH,MAAAA,iBAAiB,CAAE,IAAF,CAAjB;;AAEA,UAAMI,SAAS,GAAGD,WAAME,QAAN,CAAeC,IAAf,CAAqBZ,YAAY,CAACQ,OAAlC,CAAlB;;AAEA,UAAKE,SAAS,CAACG,MAAf,EAAwB;AACvB,YAAKd,SAAL,EAAiB;AAChB,4BAAMW,SAAN,EAAkBD,KAAlB;AACA,SAFD,MAEO;AACN,6BAAOC,SAAP,EAAmBD,KAAnB;AACA;AACD;;AAED;AACA,KA7BiB,CA+BlB;AACA;;;AACA,QAAMK,OAAO,GAAG,2BAAiBhB,gBAAjB,CAAhB;;AAEA,QAAKC,SAAL,EAAiB;AAChB,UAAMW,UAAS,GAAGD,WAAME,QAAN,CAAeC,IAAf,CAAqBE,OAArB,CAAlB;;AACA,UAAMC,YAAY,GAAG,kBAAML,UAAN,KAAqBI,OAA1C;AACAC,MAAAA,YAAY,CAACN,KAAb;AACA,KAJD,MAIO;AACNK,MAAAA,OAAO,CAACL,KAAR;AACA;AACD;;AAED,SACC;AACC,IAAA,GAAG,EAAGZ,GADP,CAEC;AAFD;AAGC,IAAA,QAAQ,EAAG,CAAEO,gBAAF,GAAqB,GAArB,GAA2BY,SAHvC;AAIC,IAAA,OAAO,EAAGT,OAJX,CAKC;AACA;AAND;AAOC,IAAA,KAAK,EAAG;AAAEU,MAAAA,QAAQ,EAAE;AAAZ;AAPT,IADD;AAWA,CAxEmB,CAArB;eA2EerB,Y","sourcesContent":["/**\n * External dependencies\n */\nimport { first, last } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { forwardRef } from '@wordpress/element';\nimport { focus } from '@wordpress/dom';\nimport { useSelect, useDispatch } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport { getBlockDOMNode } from '../../utils/dom';\n\n/**\n * Renders focus capturing areas to redirect focus to the selected block if not\n * in Navigation mode.\n *\n * @param {string}  selectedClientId Client ID of the selected block.\n * @param {boolean} isReverse        Set to true if the component is rendered\n *                                   after the block list, false if rendered\n *                                   before.\n * @param {Object}  containerRef     Reference containing the element reference\n *                                   of the block list container.\n * @param {boolean} noCapture        Reference containing the flag for enabling\n *                                   or disabling capturing.\n *\n * @return {WPElement} The focus capture element.\n */\nconst FocusCapture = forwardRef(\n\t(\n\t\t{\n\t\t\tselectedClientId,\n\t\t\tisReverse,\n\t\t\tcontainerRef,\n\t\t\tnoCapture,\n\t\t\thasMultiSelection,\n\t\t\tmultiSelectionContainer,\n\t\t},\n\t\tref\n\t) => {\n\t\tconst isNavigationMode = useSelect( ( select ) =>\n\t\t\tselect( 'core/block-editor' ).isNavigationMode()\n\t\t);\n\t\tconst { setNavigationMode } = useDispatch( 'core/block-editor' );\n\n\t\tfunction onFocus() {\n\t\t\t// Do not capture incoming focus if set by us in WritingFlow.\n\t\t\tif ( noCapture.current ) {\n\t\t\t\tnoCapture.current = null;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// When focus coming in from out of the block list, and no block is\n\t\t\t// selected, enable Navigation mode and select the first or last block\n\t\t\t// depending on the direction.\n\t\t\tif ( ! selectedClientId ) {\n\t\t\t\tif ( hasMultiSelection ) {\n\t\t\t\t\tmultiSelectionContainer.current.focus();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tsetNavigationMode( true );\n\n\t\t\t\tconst tabbables = focus.tabbable.find( containerRef.current );\n\n\t\t\t\tif ( tabbables.length ) {\n\t\t\t\t\tif ( isReverse ) {\n\t\t\t\t\t\tlast( tabbables ).focus();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfirst( tabbables ).focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// If there is a selected block, move focus to the first or last\n\t\t\t// tabbable element depending on the direction.\n\t\t\tconst wrapper = getBlockDOMNode( selectedClientId );\n\n\t\t\tif ( isReverse ) {\n\t\t\t\tconst tabbables = focus.tabbable.find( wrapper );\n\t\t\t\tconst lastTabbable = last( tabbables ) || wrapper;\n\t\t\t\tlastTabbable.focus();\n\t\t\t} else {\n\t\t\t\twrapper.focus();\n\t\t\t}\n\t\t}\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\tref={ ref }\n\t\t\t\t// Don't allow tabbing to this element in Navigation mode.\n\t\t\t\ttabIndex={ ! isNavigationMode ? '0' : undefined }\n\t\t\t\tonFocus={ onFocus }\n\t\t\t\t// Needs to be positioned within the viewport, so focus to this\n\t\t\t\t// element does not scroll the page.\n\t\t\t\tstyle={ { position: 'fixed' } }\n\t\t\t/>\n\t\t);\n\t}\n);\n\nexport default FocusCapture;\n"]}