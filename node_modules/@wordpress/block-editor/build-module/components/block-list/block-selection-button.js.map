{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/block-selection-button.js"],"names":["classnames","Button","useSelect","useDispatch","useEffect","useRef","BACKSPACE","DELETE","getBlockType","__experimentalGetAccessibleBlockLabel","getAccessibleBlockLabel","speak","BlockTitle","isWindows","window","navigator","platform","indexOf","BlockSelectionButton","clientId","rootClientId","props","selected","select","__unstableGetBlockWithoutInnerBlocks","getBlockIndex","hasBlockMovingClientId","getBlockListSettings","index","name","attributes","blockMovingMode","orientation","setNavigationMode","removeBlock","ref","current","focus","label","onKeyDown","event","keyCode","preventDefault","blockType","classNames"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Button } from '@wordpress/components';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useEffect, useRef } from '@wordpress/element';\nimport { BACKSPACE, DELETE } from '@wordpress/keycodes';\nimport {\n\tgetBlockType,\n\t__experimentalGetAccessibleBlockLabel as getAccessibleBlockLabel,\n} from '@wordpress/blocks';\nimport { speak } from '@wordpress/a11y';\n\n/**\n * Internal dependencies\n */\nimport BlockTitle from '../block-title';\n\n/**\n * Returns true if the user is using windows.\n *\n * @return {boolean} Whether the user is using Windows.\n */\nfunction isWindows() {\n\treturn window.navigator.platform.indexOf( 'Win' ) > -1;\n}\n\n/**\n * Block selection button component, displaying the label of the block. If the block\n * descends from a root block, a button is displayed enabling the user to select\n * the root block.\n *\n * @param {string} props          Component props.\n * @param {string} props.clientId Client ID of block.\n *\n * @return {WPComponent} The component to be rendered.\n */\nfunction BlockSelectionButton( { clientId, rootClientId, ...props } ) {\n\tconst selected = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\t__unstableGetBlockWithoutInnerBlocks,\n\t\t\t\tgetBlockIndex,\n\t\t\t\thasBlockMovingClientId,\n\t\t\t\tgetBlockListSettings,\n\t\t\t} = select( 'core/block-editor' );\n\t\t\tconst index = getBlockIndex( clientId, rootClientId );\n\t\t\tconst { name, attributes } = __unstableGetBlockWithoutInnerBlocks(\n\t\t\t\tclientId\n\t\t\t);\n\t\t\tconst blockMovingMode = hasBlockMovingClientId();\n\t\t\treturn {\n\t\t\t\tindex,\n\t\t\t\tname,\n\t\t\t\tattributes,\n\t\t\t\tblockMovingMode,\n\t\t\t\torientation: getBlockListSettings( rootClientId )?.orientation,\n\t\t\t};\n\t\t},\n\t\t[ clientId, rootClientId ]\n\t);\n\tconst { index, name, attributes, blockMovingMode, orientation } = selected;\n\tconst { setNavigationMode, removeBlock } = useDispatch(\n\t\t'core/block-editor'\n\t);\n\tconst ref = useRef();\n\n\t// Focus the breadcrumb in navigation mode.\n\tuseEffect( () => {\n\t\tref.current.focus();\n\n\t\t// NVDA on windows suffers from a bug where focus changes are not announced properly\n\t\t// See WordPress/gutenberg#24121 and nvaccess/nvda#5825 for more details\n\t\t// To solve it we announce the focus change manually.\n\t\tif ( isWindows() ) {\n\t\t\tspeak( label );\n\t\t}\n\t}, [] );\n\n\tfunction onKeyDown( event ) {\n\t\tconst { keyCode } = event;\n\n\t\tif ( keyCode === BACKSPACE || keyCode === DELETE ) {\n\t\t\tremoveBlock( clientId );\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\tconst blockType = getBlockType( name );\n\tconst label = getAccessibleBlockLabel(\n\t\tblockType,\n\t\tattributes,\n\t\tindex + 1,\n\t\torientation\n\t);\n\n\tconst classNames = classnames(\n\t\t'block-editor-block-list__block-selection-button',\n\t\t{\n\t\t\t'is-block-moving-mode': !! blockMovingMode,\n\t\t}\n\t);\n\n\treturn (\n\t\t<div className={ classNames } { ...props }>\n\t\t\t<Button\n\t\t\t\tref={ ref }\n\t\t\t\tonClick={ () => setNavigationMode( false ) }\n\t\t\t\tonKeyDown={ onKeyDown }\n\t\t\t\tlabel={ label }\n\t\t\t>\n\t\t\t\t<BlockTitle clientId={ clientId } />\n\t\t\t</Button>\n\t\t</div>\n\t);\n}\n\nexport default BlockSelectionButton;\n"]}