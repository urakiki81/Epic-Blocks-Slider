{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/block-invalid-warning.js"],"names":["__","_x","Button","Modal","useState","useCallback","useMemo","getBlockType","createBlock","rawHandler","compose","withDispatch","withSelect","Warning","BlockCompare","BlockInvalidWarning","convertToHTML","convertToBlocks","convertToClassic","attemptBlockRecovery","block","hasHTMLBlock","compare","setCompare","onCompare","onCompareClose","hiddenActions","title","onClick","filter","Boolean","blockToBlocks","blockToClassic","content","originalContent","blockToHTML","HTML","recoverBlock","name","attributes","innerBlocks","select","clientId","getBlock","dispatch","replaceBlock"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __, _x } from '@wordpress/i18n';\nimport { Button, Modal } from '@wordpress/components';\nimport { useState, useCallback, useMemo } from '@wordpress/element';\nimport { getBlockType, createBlock, rawHandler } from '@wordpress/blocks';\nimport { compose } from '@wordpress/compose';\nimport { withDispatch, withSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport Warning from '../warning';\nimport BlockCompare from '../block-compare';\n\nexport function BlockInvalidWarning( {\n\tconvertToHTML,\n\tconvertToBlocks,\n\tconvertToClassic,\n\tattemptBlockRecovery,\n\tblock,\n} ) {\n\tconst hasHTMLBlock = !! getBlockType( 'core/html' );\n\tconst [ compare, setCompare ] = useState( false );\n\n\tconst onCompare = useCallback( () => setCompare( true ), [] );\n\tconst onCompareClose = useCallback( () => setCompare( false ), [] );\n\n\t// We memo the array here to prevent the children components from being updated unexpectedly\n\tconst hiddenActions = useMemo(\n\t\t() =>\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\t// translators: Button to fix block content\n\t\t\t\t\ttitle: _x( 'Resolve', 'imperative verb' ),\n\t\t\t\t\tonClick: onCompare,\n\t\t\t\t},\n\t\t\t\thasHTMLBlock && {\n\t\t\t\t\ttitle: __( 'Convert to HTML' ),\n\t\t\t\t\tonClick: convertToHTML,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: __( 'Convert to Classic Block' ),\n\t\t\t\t\tonClick: convertToClassic,\n\t\t\t\t},\n\t\t\t].filter( Boolean ),\n\t\t[ onCompare, convertToHTML, convertToClassic ]\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<Warning\n\t\t\t\tactions={ [\n\t\t\t\t\t<Button\n\t\t\t\t\t\tkey=\"recover\"\n\t\t\t\t\t\tonClick={ attemptBlockRecovery }\n\t\t\t\t\t\tisPrimary\n\t\t\t\t\t>\n\t\t\t\t\t\t{ __( 'Attempt Block Recovery' ) }\n\t\t\t\t\t</Button>,\n\t\t\t\t] }\n\t\t\t\tsecondaryActions={ hiddenActions }\n\t\t\t>\n\t\t\t\t{ __( 'This block contains unexpected or invalid content.' ) }\n\t\t\t</Warning>\n\t\t\t{ compare && (\n\t\t\t\t<Modal\n\t\t\t\t\ttitle={\n\t\t\t\t\t\t// translators: Dialog title to fix block content\n\t\t\t\t\t\t__( 'Resolve Block' )\n\t\t\t\t\t}\n\t\t\t\t\tonRequestClose={ onCompareClose }\n\t\t\t\t\tclassName=\"block-editor-block-compare\"\n\t\t\t\t>\n\t\t\t\t\t<BlockCompare\n\t\t\t\t\t\tblock={ block }\n\t\t\t\t\t\tonKeep={ convertToHTML }\n\t\t\t\t\t\tonConvert={ convertToBlocks }\n\t\t\t\t\t\tconvertor={ blockToBlocks }\n\t\t\t\t\t\tconvertButtonText={ __( 'Convert to Blocks' ) }\n\t\t\t\t\t/>\n\t\t\t\t</Modal>\n\t\t\t) }\n\t\t</>\n\t);\n}\n\nconst blockToClassic = ( block ) =>\n\tcreateBlock( 'core/freeform', {\n\t\tcontent: block.originalContent,\n\t} );\nconst blockToHTML = ( block ) =>\n\tcreateBlock( 'core/html', {\n\t\tcontent: block.originalContent,\n\t} );\nconst blockToBlocks = ( block ) =>\n\trawHandler( {\n\t\tHTML: block.originalContent,\n\t} );\nconst recoverBlock = ( { name, attributes, innerBlocks } ) =>\n\tcreateBlock( name, attributes, innerBlocks );\n\nexport default compose( [\n\twithSelect( ( select, { clientId } ) => ( {\n\t\tblock: select( 'core/block-editor' ).getBlock( clientId ),\n\t} ) ),\n\twithDispatch( ( dispatch, { block } ) => {\n\t\tconst { replaceBlock } = dispatch( 'core/block-editor' );\n\n\t\treturn {\n\t\t\tconvertToClassic() {\n\t\t\t\treplaceBlock( block.clientId, blockToClassic( block ) );\n\t\t\t},\n\t\t\tconvertToHTML() {\n\t\t\t\treplaceBlock( block.clientId, blockToHTML( block ) );\n\t\t\t},\n\t\t\tconvertToBlocks() {\n\t\t\t\treplaceBlock( block.clientId, blockToBlocks( block ) );\n\t\t\t},\n\t\t\tattemptBlockRecovery() {\n\t\t\t\treplaceBlock( block.clientId, recoverBlock( block ) );\n\t\t\t},\n\t\t};\n\t} ),\n] )( BlockInvalidWarning );\n"]}