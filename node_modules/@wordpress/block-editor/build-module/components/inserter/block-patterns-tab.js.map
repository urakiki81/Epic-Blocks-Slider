{"version":3,"sources":["@wordpress/block-editor/src/components/inserter/block-patterns-tab.js"],"names":["fromPairs","useMemo","useCallback","__","_x","useAsyncList","InserterPanel","searchItems","InserterNoResults","usePatternsState","BlockPatternList","BlockPatternsSearchResults","filterValue","onInsert","patterns","onClick","currentShownPatterns","filteredPatterns","length","BlockPatternsPerCategories","categories","getPatternIndex","pattern","Infinity","indexedCategories","map","index","name","Math","min","category","undefined","orderedPatterns","sort","a","b","uncategorizedPatterns","filter","patternCategory","categoryPatterns","includes","label","BlockPatternsTabs"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { fromPairs } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useMemo, useCallback } from '@wordpress/element';\nimport { __, _x } from '@wordpress/i18n';\nimport { useAsyncList } from '@wordpress/compose';\n\n/**\n * Internal dependencies\n */\nimport InserterPanel from './panel';\nimport { searchItems } from './search-items';\nimport InserterNoResults from './no-results';\nimport usePatternsState from './hooks/use-patterns-state';\nimport BlockPatternList from '../block-patterns-list';\n\nfunction BlockPatternsSearchResults( { filterValue, onInsert } ) {\n\tconst [ patterns, , onClick ] = usePatternsState( onInsert );\n\tconst currentShownPatterns = useAsyncList( patterns );\n\n\tconst filteredPatterns = useMemo(\n\t\t() => searchItems( patterns, filterValue ),\n\t\t[ filterValue, patterns ]\n\t);\n\n\tif ( filterValue ) {\n\t\treturn !! filteredPatterns.length ? (\n\t\t\t<InserterPanel title={ __( 'Search Results' ) }>\n\t\t\t\t<BlockPatternList\n\t\t\t\t\tshownPatterns={ currentShownPatterns }\n\t\t\t\t\tblockPatterns={ filteredPatterns }\n\t\t\t\t\tonClickPattern={ onClick }\n\t\t\t\t/>\n\t\t\t</InserterPanel>\n\t\t) : (\n\t\t\t<InserterNoResults />\n\t\t);\n\t}\n}\n\nfunction BlockPatternsPerCategories( { onInsert } ) {\n\tconst [ patterns, categories, onClick ] = usePatternsState( onInsert );\n\n\tconst getPatternIndex = useCallback(\n\t\t( pattern ) => {\n\t\t\tif ( ! pattern.categories || ! pattern.categories.length ) {\n\t\t\t\treturn Infinity;\n\t\t\t}\n\t\t\tconst indexedCategories = fromPairs(\n\t\t\t\tcategories.map( ( { name }, index ) => [ name, index ] )\n\t\t\t);\n\t\t\treturn Math.min(\n\t\t\t\t...pattern.categories.map( ( category ) =>\n\t\t\t\t\tindexedCategories[ category ] !== undefined\n\t\t\t\t\t\t? indexedCategories[ category ]\n\t\t\t\t\t\t: Infinity\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\t[ categories ]\n\t);\n\n\t// Ordering the patterns per category is important for the async rendering.\n\tconst orderedPatterns = useMemo( () => {\n\t\treturn patterns.sort( ( a, b ) => {\n\t\t\treturn getPatternIndex( a ) - getPatternIndex( b );\n\t\t} );\n\t}, [ patterns, getPatternIndex ] );\n\n\tconst currentShownPatterns = useAsyncList( orderedPatterns );\n\n\t// Uncategorized Patterns\n\tconst uncategorizedPatterns = useMemo(\n\t\t() =>\n\t\t\tpatterns.filter(\n\t\t\t\t( pattern ) => getPatternIndex( pattern ) === Infinity\n\t\t\t),\n\t\t[ patterns, getPatternIndex ]\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t{ categories.map( ( patternCategory ) => {\n\t\t\t\tconst categoryPatterns = patterns.filter(\n\t\t\t\t\t( pattern ) =>\n\t\t\t\t\t\tpattern.categories &&\n\t\t\t\t\t\tpattern.categories.includes( patternCategory.name )\n\t\t\t\t);\n\t\t\t\treturn (\n\t\t\t\t\t!! categoryPatterns.length && (\n\t\t\t\t\t\t<InserterPanel\n\t\t\t\t\t\t\tkey={ patternCategory.name }\n\t\t\t\t\t\t\ttitle={ patternCategory.label }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BlockPatternList\n\t\t\t\t\t\t\t\tshownPatterns={ currentShownPatterns }\n\t\t\t\t\t\t\t\tblockPatterns={ categoryPatterns }\n\t\t\t\t\t\t\t\tonClickPattern={ onClick }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</InserterPanel>\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t} ) }\n\n\t\t\t{ !! uncategorizedPatterns.length && (\n\t\t\t\t<InserterPanel title={ _x( 'Uncategorized' ) }>\n\t\t\t\t\t<BlockPatternList\n\t\t\t\t\t\tshownPatterns={ currentShownPatterns }\n\t\t\t\t\t\tblockPatterns={ uncategorizedPatterns }\n\t\t\t\t\t\tonClickPattern={ onClick }\n\t\t\t\t\t/>\n\t\t\t\t</InserterPanel>\n\t\t\t) }\n\t\t</>\n\t);\n}\n\nfunction BlockPatternsTabs( { onInsert, filterValue } ) {\n\treturn filterValue ? (\n\t\t<BlockPatternsSearchResults\n\t\t\tonInsert={ onInsert }\n\t\t\tfilterValue={ filterValue }\n\t\t/>\n\t) : (\n\t\t<BlockPatternsPerCategories onInsert={ onInsert } />\n\t);\n}\n\nexport default BlockPatternsTabs;\n"]}