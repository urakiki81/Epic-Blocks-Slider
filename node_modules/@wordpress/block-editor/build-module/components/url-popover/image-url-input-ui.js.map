{"version":3,"sources":["@wordpress/block-editor/src/components/url-popover/image-url-input-ui.js"],"names":["find","isEmpty","each","map","__","useRef","useState","useCallback","ToolbarButton","Button","NavigableMenu","MenuItem","ToggleControl","TextControl","SVG","Path","LEFT","RIGHT","UP","DOWN","BACKSPACE","ENTER","link","linkIcon","close","URLPopover","LINK_DESTINATION_NONE","LINK_DESTINATION_CUSTOM","LINK_DESTINATION_MEDIA","LINK_DESTINATION_ATTACHMENT","NEW_TAB_REL","icon","ImageURLInputUI","linkDestination","onChangeUrl","url","mediaType","mediaUrl","mediaLink","linkTarget","linkClass","rel","isOpen","setIsOpen","openLinkUI","isEditingLink","setIsEditingLink","urlInput","setUrlInput","autocompleteRef","stopPropagation","event","stopPropagationRelevantKeys","indexOf","keyCode","startEditLink","stopEditLink","closeLinkUI","removeNewTabRel","currentRel","newRel","undefined","relVal","regExp","RegExp","replace","trim","getUpdatedLinkTargetSettings","value","newLinkTarget","updatedRel","onFocusOutside","autocompleteElement","current","contains","target","onSubmitLinkChange","href","preventDefault","onLinkRemove","getLinkDestinations","title","onSetHref","linkDestinations","linkDestinationInput","destination","onSetNewTab","updatedLinkTarget","onSetLinkRel","onSetLinkClass","advancedOptions","linkEditorValue","urlLabel","__experimentalImageURLInputUI"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { find, isEmpty, each, map } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useRef, useState, useCallback } from '@wordpress/element';\nimport {\n\tToolbarButton,\n\tButton,\n\tNavigableMenu,\n\tMenuItem,\n\tToggleControl,\n\tTextControl,\n\tSVG,\n\tPath,\n} from '@wordpress/components';\nimport { LEFT, RIGHT, UP, DOWN, BACKSPACE, ENTER } from '@wordpress/keycodes';\nimport { link as linkIcon, close } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport URLPopover from './index';\n\nconst LINK_DESTINATION_NONE = 'none';\nconst LINK_DESTINATION_CUSTOM = 'custom';\nconst LINK_DESTINATION_MEDIA = 'media';\nconst LINK_DESTINATION_ATTACHMENT = 'attachment';\nconst NEW_TAB_REL = [ 'noreferrer', 'noopener' ];\n\nconst icon = (\n\t<SVG viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t<Path d=\"M0,0h24v24H0V0z\" fill=\"none\" />\n\t\t<Path d=\"m19 5v14h-14v-14h14m0-2h-14c-1.1 0-2 0.9-2 2v14c0 1.1 0.9 2 2 2h14c1.1 0 2-0.9 2-2v-14c0-1.1-0.9-2-2-2z\" />\n\t\t<Path d=\"m14.14 11.86l-3 3.87-2.14-2.59-3 3.86h12l-3.86-5.14z\" />\n\t</SVG>\n);\n\nconst ImageURLInputUI = ( {\n\tlinkDestination,\n\tonChangeUrl,\n\turl,\n\tmediaType = 'image',\n\tmediaUrl,\n\tmediaLink,\n\tlinkTarget,\n\tlinkClass,\n\trel,\n} ) => {\n\tconst [ isOpen, setIsOpen ] = useState( false );\n\tconst openLinkUI = useCallback( () => {\n\t\tsetIsOpen( true );\n\t} );\n\n\tconst [ isEditingLink, setIsEditingLink ] = useState( false );\n\tconst [ urlInput, setUrlInput ] = useState( null );\n\n\tconst autocompleteRef = useRef( null );\n\n\tconst stopPropagation = ( event ) => {\n\t\tevent.stopPropagation();\n\t};\n\n\tconst stopPropagationRelevantKeys = ( event ) => {\n\t\tif (\n\t\t\t[ LEFT, DOWN, RIGHT, UP, BACKSPACE, ENTER ].indexOf(\n\t\t\t\tevent.keyCode\n\t\t\t) > -1\n\t\t) {\n\t\t\t// Stop the key event from propagating up to ObserveTyping.startTypingInTextField.\n\t\t\tevent.stopPropagation();\n\t\t}\n\t};\n\n\tconst startEditLink = useCallback( () => {\n\t\tif (\n\t\t\tlinkDestination === LINK_DESTINATION_MEDIA ||\n\t\t\tlinkDestination === LINK_DESTINATION_ATTACHMENT\n\t\t) {\n\t\t\tsetUrlInput( '' );\n\t\t}\n\t\tsetIsEditingLink( true );\n\t} );\n\n\tconst stopEditLink = useCallback( () => {\n\t\tsetIsEditingLink( false );\n\t} );\n\n\tconst closeLinkUI = useCallback( () => {\n\t\tsetUrlInput( null );\n\t\tstopEditLink();\n\t\tsetIsOpen( false );\n\t} );\n\n\tconst removeNewTabRel = ( currentRel ) => {\n\t\tlet newRel = currentRel;\n\n\t\tif ( currentRel !== undefined && ! isEmpty( newRel ) ) {\n\t\t\tif ( ! isEmpty( newRel ) ) {\n\t\t\t\teach( NEW_TAB_REL, ( relVal ) => {\n\t\t\t\t\tconst regExp = new RegExp( '\\\\b' + relVal + '\\\\b', 'gi' );\n\t\t\t\t\tnewRel = newRel.replace( regExp, '' );\n\t\t\t\t} );\n\n\t\t\t\t// Only trim if NEW_TAB_REL values was replaced.\n\t\t\t\tif ( newRel !== currentRel ) {\n\t\t\t\t\tnewRel = newRel.trim();\n\t\t\t\t}\n\n\t\t\t\tif ( isEmpty( newRel ) ) {\n\t\t\t\t\tnewRel = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn newRel;\n\t};\n\n\tconst getUpdatedLinkTargetSettings = ( value ) => {\n\t\tconst newLinkTarget = value ? '_blank' : undefined;\n\n\t\tlet updatedRel;\n\t\tif ( ! newLinkTarget && ! rel ) {\n\t\t\tupdatedRel = undefined;\n\t\t} else {\n\t\t\tupdatedRel = removeNewTabRel( rel );\n\t\t}\n\n\t\treturn {\n\t\t\tlinkTarget: newLinkTarget,\n\t\t\trel: updatedRel,\n\t\t};\n\t};\n\n\tconst onFocusOutside = useCallback( () => {\n\t\treturn ( event ) => {\n\t\t\t// The autocomplete suggestions list renders in a separate popover (in a portal),\n\t\t\t// so onFocusOutside fails to detect that a click on a suggestion occurred in the\n\t\t\t// LinkContainer. Detect clicks on autocomplete suggestions using a ref here, and\n\t\t\t// return to avoid the popover being closed.\n\t\t\tconst autocompleteElement = autocompleteRef.current;\n\t\t\tif (\n\t\t\t\tautocompleteElement &&\n\t\t\t\tautocompleteElement.contains( event.target )\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetIsOpen( false );\n\t\t\tsetUrlInput( null );\n\t\t\tstopEditLink();\n\t\t};\n\t} );\n\n\tconst onSubmitLinkChange = useCallback( () => {\n\t\treturn ( event ) => {\n\t\t\tif ( urlInput ) {\n\t\t\t\tonChangeUrl( { href: urlInput } );\n\t\t\t}\n\t\t\tstopEditLink();\n\t\t\tsetUrlInput( null );\n\t\t\tevent.preventDefault();\n\t\t};\n\t} );\n\n\tconst onLinkRemove = useCallback( () => {\n\t\tonChangeUrl( {\n\t\t\tlinkDestination: LINK_DESTINATION_NONE,\n\t\t\thref: '',\n\t\t} );\n\t} );\n\n\tconst getLinkDestinations = () => {\n\t\treturn [\n\t\t\t{\n\t\t\t\tlinkDestination: LINK_DESTINATION_MEDIA,\n\t\t\t\ttitle: __( 'Media File' ),\n\t\t\t\turl: mediaType === 'image' ? mediaUrl : undefined,\n\t\t\t\ticon,\n\t\t\t},\n\t\t\t{\n\t\t\t\tlinkDestination: LINK_DESTINATION_ATTACHMENT,\n\t\t\t\ttitle: __( 'Attachment Page' ),\n\t\t\t\turl: mediaType === 'image' ? mediaLink : undefined,\n\t\t\t\ticon: (\n\t\t\t\t\t<SVG viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t\t\t<Path d=\"M0 0h24v24H0V0z\" fill=\"none\" />\n\t\t\t\t\t\t<Path d=\"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z\" />\n\t\t\t\t\t</SVG>\n\t\t\t\t),\n\t\t\t},\n\t\t];\n\t};\n\n\tconst onSetHref = ( value ) => {\n\t\tconst linkDestinations = getLinkDestinations();\n\t\tlet linkDestinationInput;\n\t\tif ( ! value ) {\n\t\t\tlinkDestinationInput = LINK_DESTINATION_NONE;\n\t\t} else {\n\t\t\tlinkDestinationInput = (\n\t\t\t\tfind( linkDestinations, ( destination ) => {\n\t\t\t\t\treturn destination.url === value;\n\t\t\t\t} ) || { linkDestination: LINK_DESTINATION_CUSTOM }\n\t\t\t).linkDestination;\n\t\t}\n\t\tonChangeUrl( {\n\t\t\tlinkDestination: linkDestinationInput,\n\t\t\thref: value,\n\t\t} );\n\t};\n\n\tconst onSetNewTab = ( value ) => {\n\t\tconst updatedLinkTarget = getUpdatedLinkTargetSettings( value );\n\t\tonChangeUrl( updatedLinkTarget );\n\t};\n\n\tconst onSetLinkRel = ( value ) => {\n\t\tonChangeUrl( { rel: value } );\n\t};\n\n\tconst onSetLinkClass = ( value ) => {\n\t\tonChangeUrl( { linkClass: value } );\n\t};\n\n\tconst advancedOptions = (\n\t\t<>\n\t\t\t<ToggleControl\n\t\t\t\tlabel={ __( 'Open in new tab' ) }\n\t\t\t\tonChange={ onSetNewTab }\n\t\t\t\tchecked={ linkTarget === '_blank' }\n\t\t\t/>\n\t\t\t<TextControl\n\t\t\t\tlabel={ __( 'Link Rel' ) }\n\t\t\t\tvalue={ removeNewTabRel( rel ) || '' }\n\t\t\t\tonChange={ onSetLinkRel }\n\t\t\t\tonKeyPress={ stopPropagation }\n\t\t\t\tonKeyDown={ stopPropagationRelevantKeys }\n\t\t\t/>\n\t\t\t<TextControl\n\t\t\t\tlabel={ __( 'Link CSS Class' ) }\n\t\t\t\tvalue={ linkClass || '' }\n\t\t\t\tonKeyPress={ stopPropagation }\n\t\t\t\tonKeyDown={ stopPropagationRelevantKeys }\n\t\t\t\tonChange={ onSetLinkClass }\n\t\t\t/>\n\t\t</>\n\t);\n\n\tconst linkEditorValue = urlInput !== null ? urlInput : url;\n\n\tconst urlLabel = (\n\t\tfind( getLinkDestinations(), [ 'linkDestination', linkDestination ] ) ||\n\t\t{}\n\t).title;\n\n\treturn (\n\t\t<>\n\t\t\t<ToolbarButton\n\t\t\t\ticon={ linkIcon }\n\t\t\t\tclassName=\"components-toolbar__control\"\n\t\t\t\tlabel={ url ? __( 'Edit link' ) : __( 'Insert link' ) }\n\t\t\t\taria-expanded={ isOpen }\n\t\t\t\tonClick={ openLinkUI }\n\t\t\t/>\n\t\t\t{ isOpen && (\n\t\t\t\t<URLPopover\n\t\t\t\t\tonFocusOutside={ onFocusOutside() }\n\t\t\t\t\tonClose={ closeLinkUI }\n\t\t\t\t\trenderSettings={ () => advancedOptions }\n\t\t\t\t\tadditionalControls={\n\t\t\t\t\t\t! linkEditorValue && (\n\t\t\t\t\t\t\t<NavigableMenu>\n\t\t\t\t\t\t\t\t{ map( getLinkDestinations(), ( link ) => (\n\t\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\t\tkey={ link.linkDestination }\n\t\t\t\t\t\t\t\t\t\ticon={ link.icon }\n\t\t\t\t\t\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\t\t\t\t\t\tsetUrlInput( null );\n\t\t\t\t\t\t\t\t\t\t\tonSetHref( link.url );\n\t\t\t\t\t\t\t\t\t\t\tstopEditLink();\n\t\t\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{ link.title }\n\t\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t) ) }\n\t\t\t\t\t\t\t</NavigableMenu>\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t>\n\t\t\t\t\t{ ( ! url || isEditingLink ) && (\n\t\t\t\t\t\t<URLPopover.LinkEditor\n\t\t\t\t\t\t\tclassName=\"block-editor-format-toolbar__link-container-content\"\n\t\t\t\t\t\t\tvalue={ linkEditorValue }\n\t\t\t\t\t\t\tonChangeInputValue={ setUrlInput }\n\t\t\t\t\t\t\tonKeyDown={ stopPropagationRelevantKeys }\n\t\t\t\t\t\t\tonKeyPress={ stopPropagation }\n\t\t\t\t\t\t\tonSubmit={ onSubmitLinkChange() }\n\t\t\t\t\t\t\tautocompleteRef={ autocompleteRef }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ url && ! isEditingLink && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<URLPopover.LinkViewer\n\t\t\t\t\t\t\t\tclassName=\"block-editor-format-toolbar__link-container-content\"\n\t\t\t\t\t\t\t\tonKeyPress={ stopPropagation }\n\t\t\t\t\t\t\t\turl={ url }\n\t\t\t\t\t\t\t\tonEditLinkClick={ startEditLink }\n\t\t\t\t\t\t\t\turlLabel={ urlLabel }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\ticon={ close }\n\t\t\t\t\t\t\t\tlabel={ __( 'Remove link' ) }\n\t\t\t\t\t\t\t\tonClick={ onLinkRemove }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) }\n\t\t\t\t</URLPopover>\n\t\t\t) }\n\t\t</>\n\t);\n};\n\nexport { ImageURLInputUI as __experimentalImageURLInputUI };\n"]}