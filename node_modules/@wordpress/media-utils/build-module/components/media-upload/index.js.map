{"version":3,"sources":["@wordpress/media-utils/src/components/media-upload/index.js"],"names":["castArray","defaults","pick","Component","__","window","wp","DEFAULT_EMPTY_GALLERY","getFeaturedImageMediaFrame","media","view","MediaFrame","Select","extend","featuredImageToolbar","toolbar","createSelectToolbar","text","l10n","setFeaturedImage","state","options","editState","selection","get","EditImage","model","single","controller","render","content","set","loadEditor","createStates","on","states","add","FeaturedImage","editImage","getGalleryDetailsMediaFrame","Post","galleryToolbar","editing","Toolbar","items","insert","style","updateGallery","insertGallery","priority","requires","library","click","close","trigger","setState","reset","Library","id","title","createGalleryTitle","filterable","multiple","editable","query","type","GalleryEdit","menu","displaySettings","GalleryAdd","slimImageObject","img","attrSet","getAttachmentsCollection","ids","order","orderby","post__in","posts_per_page","MediaUpload","allowedTypes","gallery","unstableFeaturedImageFlow","modalClass","arguments","openModal","bind","onOpen","onSelect","onUpdate","onClose","buildAndSetGalleryFrame","frameConfig","frame","$el","addClass","buildAndSetFeatureImageFrame","initializeListeners","props","addToGallery","value","lastGalleryValue","remove","currentState","length","GalleryDetailsMediaFrame","attachments","Selection","models","toJSON","mimeType","featuredImageFrame","selections","selectedImages","map","attachment","updateCollection","forEach","more","frameContent","collection","toArray","mirroring","_hasMore","open"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { castArray, defaults, pick } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\n\nconst { wp } = window;\n\nconst DEFAULT_EMPTY_GALLERY = [];\n\n/**\n * Prepares the Featured Image toolbars and frames.\n *\n * @return {wp.media.view.MediaFrame.Select} The default media workflow.\n */\nconst getFeaturedImageMediaFrame = () => {\n\treturn wp.media.view.MediaFrame.Select.extend( {\n\t\t/**\n\t\t * Enables the Set Featured Image Button.\n\t\t *\n\t\t * @param {Object} toolbar toolbar for featured image state\n\t\t * @return {void}\n\t\t */\n\t\tfeaturedImageToolbar( toolbar ) {\n\t\t\tthis.createSelectToolbar( toolbar, {\n\t\t\t\ttext: wp.media.view.l10n.setFeaturedImage,\n\t\t\t\tstate: this.options.state,\n\t\t\t} );\n\t\t},\n\n\t\t/**\n\t\t * Handle the edit state requirements of selected media item.\n\t\t *\n\t\t * @return {void}\n\t\t */\n\t\teditState() {\n\t\t\tconst selection = this.state( 'featured-image' ).get( 'selection' );\n\t\t\tconst view = new wp.media.view.EditImage( {\n\t\t\t\tmodel: selection.single(),\n\t\t\t\tcontroller: this,\n\t\t\t} ).render();\n\n\t\t\t// Set the view to the EditImage frame using the selected image.\n\t\t\tthis.content.set( view );\n\n\t\t\t// After bringing in the frame, load the actual editor via an ajax call.\n\t\t\tview.loadEditor();\n\t\t},\n\n\t\t/**\n\t\t * Create the default states.\n\t\t *\n\t\t * @return {void}\n\t\t */\n\t\tcreateStates: function createStates() {\n\t\t\tthis.on(\n\t\t\t\t'toolbar:create:featured-image',\n\t\t\t\tthis.featuredImageToolbar,\n\t\t\t\tthis\n\t\t\t);\n\t\t\tthis.on( 'content:render:edit-image', this.editState, this );\n\n\t\t\tthis.states.add( [\n\t\t\t\tnew wp.media.controller.FeaturedImage(),\n\t\t\t\tnew wp.media.controller.EditImage( {\n\t\t\t\t\tmodel: this.options.editImage,\n\t\t\t\t} ),\n\t\t\t] );\n\t\t},\n\t} );\n};\n\n/**\n * Prepares the Gallery toolbars and frames.\n *\n * @return {wp.media.view.MediaFrame.Post} The default media workflow.\n */\nconst getGalleryDetailsMediaFrame = () => {\n\t/**\n\t * Custom gallery details frame.\n\t *\n\t * @see https://github.com/xwp/wp-core-media-widgets/blob/905edbccfc2a623b73a93dac803c5335519d7837/wp-admin/js/widgets/media-gallery-widget.js\n\t * @class GalleryDetailsMediaFrame\n\t * @class\n\t */\n\treturn wp.media.view.MediaFrame.Post.extend( {\n\t\t/**\n\t\t * Set up gallery toolbar.\n\t\t *\n\t\t * @return {void}\n\t\t */\n\t\tgalleryToolbar() {\n\t\t\tconst editing = this.state().get( 'editing' );\n\t\t\tthis.toolbar.set(\n\t\t\t\tnew wp.media.view.Toolbar( {\n\t\t\t\t\tcontroller: this,\n\t\t\t\t\titems: {\n\t\t\t\t\t\tinsert: {\n\t\t\t\t\t\t\tstyle: 'primary',\n\t\t\t\t\t\t\ttext: editing\n\t\t\t\t\t\t\t\t? wp.media.view.l10n.updateGallery\n\t\t\t\t\t\t\t\t: wp.media.view.l10n.insertGallery,\n\t\t\t\t\t\t\tpriority: 80,\n\t\t\t\t\t\t\trequires: { library: true },\n\n\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t * @fires wp.media.controller.State#update\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tconst controller = this.controller,\n\t\t\t\t\t\t\t\t\tstate = controller.state();\n\n\t\t\t\t\t\t\t\tcontroller.close();\n\t\t\t\t\t\t\t\tstate.trigger(\n\t\t\t\t\t\t\t\t\t'update',\n\t\t\t\t\t\t\t\t\tstate.get( 'library' )\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t// Restore and reset the default state.\n\t\t\t\t\t\t\t\tcontroller.setState( controller.options.state );\n\t\t\t\t\t\t\t\tcontroller.reset();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t} )\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Handle the edit state requirements of selected media item.\n\t\t *\n\t\t * @return {void}\n\t\t */\n\t\teditState() {\n\t\t\tconst selection = this.state( 'gallery' ).get( 'selection' );\n\t\t\tconst view = new wp.media.view.EditImage( {\n\t\t\t\tmodel: selection.single(),\n\t\t\t\tcontroller: this,\n\t\t\t} ).render();\n\n\t\t\t// Set the view to the EditImage frame using the selected image.\n\t\t\tthis.content.set( view );\n\n\t\t\t// After bringing in the frame, load the actual editor via an ajax call.\n\t\t\tview.loadEditor();\n\t\t},\n\n\t\t/**\n\t\t * Create the default states.\n\t\t *\n\t\t * @return {void}\n\t\t */\n\t\tcreateStates: function createStates() {\n\t\t\tthis.on( 'toolbar:create:main-gallery', this.galleryToolbar, this );\n\t\t\tthis.on( 'content:render:edit-image', this.editState, this );\n\n\t\t\tthis.states.add( [\n\t\t\t\tnew wp.media.controller.Library( {\n\t\t\t\t\tid: 'gallery',\n\t\t\t\t\ttitle: wp.media.view.l10n.createGalleryTitle,\n\t\t\t\t\tpriority: 40,\n\t\t\t\t\ttoolbar: 'main-gallery',\n\t\t\t\t\tfilterable: 'uploaded',\n\t\t\t\t\tmultiple: 'add',\n\t\t\t\t\teditable: false,\n\n\t\t\t\t\tlibrary: wp.media.query(\n\t\t\t\t\t\tdefaults(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tthis.options.library\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\t} ),\n\t\t\t\tnew wp.media.controller.EditImage( {\n\t\t\t\t\tmodel: this.options.editImage,\n\t\t\t\t} ),\n\n\t\t\t\tnew wp.media.controller.GalleryEdit( {\n\t\t\t\t\tlibrary: this.options.selection,\n\t\t\t\t\tediting: this.options.editing,\n\t\t\t\t\tmenu: 'gallery',\n\t\t\t\t\tdisplaySettings: false,\n\t\t\t\t\tmultiple: true,\n\t\t\t\t} ),\n\n\t\t\t\tnew wp.media.controller.GalleryAdd(),\n\t\t\t] );\n\t\t},\n\t} );\n};\n\n// the media library image object contains numerous attributes\n// we only need this set to display the image in the library\nconst slimImageObject = ( img ) => {\n\tconst attrSet = [\n\t\t'sizes',\n\t\t'mime',\n\t\t'type',\n\t\t'subtype',\n\t\t'id',\n\t\t'url',\n\t\t'alt',\n\t\t'link',\n\t\t'caption',\n\t];\n\treturn pick( img, attrSet );\n};\n\nconst getAttachmentsCollection = ( ids ) => {\n\treturn wp.media.query( {\n\t\torder: 'ASC',\n\t\torderby: 'post__in',\n\t\tpost__in: ids,\n\t\tposts_per_page: -1,\n\t\tquery: true,\n\t\ttype: 'image',\n\t} );\n};\n\nclass MediaUpload extends Component {\n\tconstructor( {\n\t\tallowedTypes,\n\t\tgallery = false,\n\t\tunstableFeaturedImageFlow = false,\n\t\tmodalClass,\n\t\tmultiple = false,\n\t\ttitle = __( 'Select or Upload Media' ),\n\t} ) {\n\t\tsuper( ...arguments );\n\t\tthis.openModal = this.openModal.bind( this );\n\t\tthis.onOpen = this.onOpen.bind( this );\n\t\tthis.onSelect = this.onSelect.bind( this );\n\t\tthis.onUpdate = this.onUpdate.bind( this );\n\t\tthis.onClose = this.onClose.bind( this );\n\n\t\tif ( gallery ) {\n\t\t\tthis.buildAndSetGalleryFrame();\n\t\t} else {\n\t\t\tconst frameConfig = {\n\t\t\t\ttitle,\n\t\t\t\tmultiple,\n\t\t\t};\n\t\t\tif ( !! allowedTypes ) {\n\t\t\t\tframeConfig.library = { type: allowedTypes };\n\t\t\t}\n\n\t\t\tthis.frame = wp.media( frameConfig );\n\t\t}\n\n\t\tif ( modalClass ) {\n\t\t\tthis.frame.$el.addClass( modalClass );\n\t\t}\n\n\t\tif ( unstableFeaturedImageFlow ) {\n\t\t\tthis.buildAndSetFeatureImageFrame();\n\t\t}\n\t\tthis.initializeListeners();\n\t}\n\n\tinitializeListeners() {\n\t\t// When an image is selected in the media frame...\n\t\tthis.frame.on( 'select', this.onSelect );\n\t\tthis.frame.on( 'update', this.onUpdate );\n\t\tthis.frame.on( 'open', this.onOpen );\n\t\tthis.frame.on( 'close', this.onClose );\n\t}\n\n\t/**\n\t * Sets the Gallery frame and initializes listeners.\n\t *\n\t * @return {void}\n\t */\n\tbuildAndSetGalleryFrame() {\n\t\tconst {\n\t\t\taddToGallery = false,\n\t\t\tallowedTypes,\n\t\t\tmultiple = false,\n\t\t\tvalue = DEFAULT_EMPTY_GALLERY,\n\t\t} = this.props;\n\n\t\t// If the value did not changed there is no need to rebuild the frame,\n\t\t// we can continue to use the existing one.\n\t\tif ( value === this.lastGalleryValue ) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.lastGalleryValue = value;\n\n\t\t// If a frame already existed remove it.\n\t\tif ( this.frame ) {\n\t\t\tthis.frame.remove();\n\t\t}\n\t\tlet currentState;\n\t\tif ( addToGallery ) {\n\t\t\tcurrentState = 'gallery-library';\n\t\t} else {\n\t\t\tcurrentState = value && value.length ? 'gallery-edit' : 'gallery';\n\t\t}\n\t\tif ( ! this.GalleryDetailsMediaFrame ) {\n\t\t\tthis.GalleryDetailsMediaFrame = getGalleryDetailsMediaFrame();\n\t\t}\n\t\tconst attachments = getAttachmentsCollection( value );\n\t\tconst selection = new wp.media.model.Selection( attachments.models, {\n\t\t\tprops: attachments.props.toJSON(),\n\t\t\tmultiple,\n\t\t} );\n\t\tthis.frame = new this.GalleryDetailsMediaFrame( {\n\t\t\tmimeType: allowedTypes,\n\t\t\tstate: currentState,\n\t\t\tmultiple,\n\t\t\tselection,\n\t\t\tediting: value && value.length ? true : false,\n\t\t} );\n\t\twp.media.frame = this.frame;\n\t\tthis.initializeListeners();\n\t}\n\n\t/**\n\t * Initializes the Media Library requirements for the featured image flow.\n\t *\n\t * @return {void}\n\t */\n\tbuildAndSetFeatureImageFrame() {\n\t\tconst featuredImageFrame = getFeaturedImageMediaFrame();\n\t\tconst attachments = getAttachmentsCollection( this.props.value );\n\t\tconst selection = new wp.media.model.Selection( attachments.models, {\n\t\t\tprops: attachments.props.toJSON(),\n\t\t} );\n\t\tthis.frame = new featuredImageFrame( {\n\t\t\tmimeType: this.props.allowedTypes,\n\t\t\tstate: 'featured-image',\n\t\t\tmultiple: this.props.multiple,\n\t\t\tselection,\n\t\t\tediting: this.props.value ? true : false,\n\t\t} );\n\t\twp.media.frame = this.frame;\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.frame.remove();\n\t}\n\n\tonUpdate( selections ) {\n\t\tconst { onSelect, multiple = false } = this.props;\n\t\tconst state = this.frame.state();\n\t\tconst selectedImages = selections || state.get( 'selection' );\n\n\t\tif ( ! selectedImages || ! selectedImages.models.length ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( multiple ) {\n\t\t\tonSelect(\n\t\t\t\tselectedImages.models.map( ( model ) =>\n\t\t\t\t\tslimImageObject( model.toJSON() )\n\t\t\t\t)\n\t\t\t);\n\t\t} else {\n\t\t\tonSelect( slimImageObject( selectedImages.models[ 0 ].toJSON() ) );\n\t\t}\n\t}\n\n\tonSelect() {\n\t\tconst { onSelect, multiple = false } = this.props;\n\t\t// Get media attachment details from the frame state\n\t\tconst attachment = this.frame.state().get( 'selection' ).toJSON();\n\t\tonSelect( multiple ? attachment : attachment[ 0 ] );\n\t}\n\n\tonOpen() {\n\t\tthis.updateCollection();\n\t\tif ( ! this.props.value ) {\n\t\t\treturn;\n\t\t}\n\t\tif ( ! this.props.gallery ) {\n\t\t\tconst selection = this.frame.state().get( 'selection' );\n\t\t\tcastArray( this.props.value ).forEach( ( id ) => {\n\t\t\t\tselection.add( wp.media.attachment( id ) );\n\t\t\t} );\n\t\t}\n\n\t\t// load the images so they are available in the media modal.\n\t\tgetAttachmentsCollection( castArray( this.props.value ) ).more();\n\t}\n\n\tonClose() {\n\t\tconst { onClose } = this.props;\n\n\t\tif ( onClose ) {\n\t\t\tonClose();\n\t\t}\n\t}\n\n\tupdateCollection() {\n\t\tconst frameContent = this.frame.content.get();\n\t\tif ( frameContent && frameContent.collection ) {\n\t\t\tconst collection = frameContent.collection;\n\n\t\t\t// clean all attachments we have in memory.\n\t\t\tcollection\n\t\t\t\t.toArray()\n\t\t\t\t.forEach( ( model ) => model.trigger( 'destroy', model ) );\n\n\t\t\t// reset has more flag, if library had small amount of items all items may have been loaded before.\n\t\t\tcollection.mirroring._hasMore = true;\n\n\t\t\t// request items\n\t\t\tcollection.more();\n\t\t}\n\t}\n\n\topenModal() {\n\t\tif ( this.props.gallery ) {\n\t\t\tthis.buildAndSetGalleryFrame();\n\t\t}\n\t\tthis.frame.open();\n\t}\n\n\trender() {\n\t\treturn this.props.render( { open: this.openModal } );\n\t}\n}\n\nexport default MediaUpload;\n"]}