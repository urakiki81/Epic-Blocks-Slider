{"version":3,"sources":["@wordpress/components/src/focal-point-picker/index.js"],"names":["noop","classnames","__","Component","createRef","withInstanceId","compose","UP","DOWN","LEFT","RIGHT","withFocusOutside","BaseControl","Controls","FocalPoint","Grid","Media","MediaWrapper","MediaContainer","roundClamp","INITIAL_BOUNDS","FocalPointPicker","props","arguments","state","isDragging","bounds","percentages","value","containerRef","mediaRef","handleOnClick","bind","handleOnMouseUp","handleOnKeyDown","onMouseMove","updateBounds","updateValue","document","addEventListener","window","prevProps","url","setState","x","y","removeEventListener","current","dimensions","width","clientWidth","height","clientHeight","pickerDimensions","widthRatio","heightRatio","right","top","bottom","left","nextValue","onChange","nextPercentage","parseFloat","toFixed","calculateBounds","event","persist","keyCode","shiftKey","includes","preventDefault","nextX","nextY","step","cursorPosition","pageX","pageY","Math","max","min","containerNode","getBoundingClientRect","body","scrollTop","undefined","iconCoordinates","autoPlay","className","help","instanceId","label","onDragStart","onDragEnd","classes","id","defaultProps"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { noop } from 'lodash';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component, createRef } from '@wordpress/element';\nimport { withInstanceId, compose } from '@wordpress/compose';\nimport { UP, DOWN, LEFT, RIGHT } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport withFocusOutside from '../higher-order/with-focus-outside';\nimport BaseControl from '../base-control';\nimport Controls from './controls';\nimport FocalPoint from './focal-point';\nimport Grid from './grid';\nimport Media from './media';\nimport {\n\tMediaWrapper,\n\tMediaContainer,\n} from './styles/focal-point-picker-style';\nimport { roundClamp } from '../utils/math';\nimport { INITIAL_BOUNDS } from './utils';\n\nexport class FocalPointPicker extends Component {\n\tconstructor( props ) {\n\t\tsuper( ...arguments );\n\n\t\tthis.state = {\n\t\t\tisDragging: false,\n\t\t\tbounds: INITIAL_BOUNDS,\n\t\t\tpercentages: props.value,\n\t\t};\n\n\t\tthis.containerRef = createRef();\n\t\tthis.mediaRef = createRef();\n\n\t\tthis.handleOnClick = this.handleOnClick.bind( this );\n\t\tthis.handleOnMouseUp = this.handleOnMouseUp.bind( this );\n\t\tthis.handleOnKeyDown = this.handleOnKeyDown.bind( this );\n\t\tthis.onMouseMove = this.onMouseMove.bind( this );\n\n\t\tthis.updateBounds = this.updateBounds.bind( this );\n\t\tthis.updateValue = this.updateValue.bind( this );\n\t}\n\tcomponentDidMount() {\n\t\tdocument.addEventListener( 'mouseup', this.handleOnMouseUp );\n\t\twindow.addEventListener( 'resize', this.updateBounds );\n\t}\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( prevProps.url !== this.props.url ) {\n\t\t\tthis.setState( {\n\t\t\t\tisDragging: false,\n\t\t\t} );\n\t\t}\n\t\t/**\n\t\t * Handles cases where the incoming value changes.\n\t\t * An example is the values resetting based on an UNDO action.\n\t\t */\n\t\tif (\n\t\t\tthis.props.value.x !== this.state.percentages.x ||\n\t\t\tthis.props.value.y !== this.state.percentages.y\n\t\t) {\n\t\t\tthis.setState( { percentages: this.props.value } );\n\t\t}\n\t}\n\tcomponentWillUnmount() {\n\t\tdocument.removeEventListener( 'mouseup', this.handleOnMouseUp );\n\t\twindow.removeEventListener( 'resize', this.updateBounds );\n\t}\n\tcalculateBounds() {\n\t\tconst bounds = INITIAL_BOUNDS;\n\n\t\tif ( ! this.mediaRef.current ) {\n\t\t\treturn bounds;\n\t\t}\n\n\t\tconst dimensions = {\n\t\t\twidth: this.mediaRef.current.clientWidth,\n\t\t\theight: this.mediaRef.current.clientHeight,\n\t\t};\n\t\tconst pickerDimensions = this.pickerDimensions();\n\n\t\tconst widthRatio = pickerDimensions.width / dimensions.width;\n\t\tconst heightRatio = pickerDimensions.height / dimensions.height;\n\n\t\tif ( heightRatio >= widthRatio ) {\n\t\t\tbounds.width = bounds.right = pickerDimensions.width;\n\t\t\tbounds.height = dimensions.height * widthRatio;\n\t\t\tbounds.top = ( pickerDimensions.height - bounds.height ) / 2;\n\t\t\tbounds.bottom = bounds.top + bounds.height;\n\t\t} else {\n\t\t\tbounds.height = bounds.bottom = pickerDimensions.height;\n\t\t\tbounds.width = dimensions.width * heightRatio;\n\t\t\tbounds.left = ( pickerDimensions.width - bounds.width ) / 2;\n\t\t\tbounds.right = bounds.left + bounds.width;\n\t\t}\n\t\treturn bounds;\n\t}\n\tupdateValue( nextValue = {} ) {\n\t\tconst { onChange } = this.props;\n\t\tconst { x, y } = nextValue;\n\n\t\tconst nextPercentage = {\n\t\t\tx: parseFloat( x ).toFixed( 2 ),\n\t\t\ty: parseFloat( y ).toFixed( 2 ),\n\t\t};\n\n\t\tthis.setState( { percentages: nextPercentage }, () => {\n\t\t\tonChange( nextPercentage );\n\t\t} );\n\t}\n\tupdateBounds() {\n\t\tthis.setState( {\n\t\t\tbounds: this.calculateBounds(),\n\t\t} );\n\t}\n\thandleOnClick( event ) {\n\t\tevent.persist();\n\t\tthis.setState( { isDragging: true }, () => {\n\t\t\tthis.onMouseMove( event );\n\t\t} );\n\t}\n\thandleOnMouseUp() {\n\t\tthis.setState( { isDragging: false } );\n\t}\n\thandleOnKeyDown( event ) {\n\t\tconst { keyCode, shiftKey } = event;\n\t\tif ( ! [ UP, DOWN, LEFT, RIGHT ].includes( keyCode ) ) return;\n\n\t\tconst { x, y } = this.state.percentages;\n\n\t\tevent.preventDefault();\n\n\t\t// Normalizing values for incrementing/decrementing based on arrow keys\n\t\tlet nextX = parseFloat( x );\n\t\tlet nextY = parseFloat( y );\n\t\tconst step = shiftKey ? 0.1 : 0.01;\n\n\t\tswitch ( event.keyCode ) {\n\t\t\tcase UP:\n\t\t\t\tnextY = nextY - step;\n\t\t\t\tbreak;\n\t\t\tcase DOWN:\n\t\t\t\tnextY = nextY + step;\n\t\t\t\tbreak;\n\t\t\tcase LEFT:\n\t\t\t\tnextX = nextX - step;\n\t\t\t\tbreak;\n\t\t\tcase RIGHT:\n\t\t\t\tnextX = nextX + step;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tnextX = roundClamp( nextX, 0, 1, step );\n\t\tnextY = roundClamp( nextY, 0, 1, step );\n\n\t\tconst percentages = {\n\t\t\tx: nextX,\n\t\t\ty: nextY,\n\t\t};\n\n\t\tthis.updateValue( percentages );\n\t}\n\tonMouseMove( event ) {\n\t\tconst { isDragging, bounds } = this.state;\n\n\t\tif ( ! isDragging ) return;\n\n\t\tconst { shiftKey } = event;\n\t\tconst pickerDimensions = this.pickerDimensions();\n\t\tconst cursorPosition = {\n\t\t\tleft: event.pageX - pickerDimensions.left,\n\t\t\ttop: event.pageY - pickerDimensions.top,\n\t\t};\n\n\t\tconst left = Math.max(\n\t\t\tbounds.left,\n\t\t\tMath.min( cursorPosition.left, bounds.right )\n\t\t);\n\t\tconst top = Math.max(\n\t\t\tbounds.top,\n\t\t\tMath.min( cursorPosition.top, bounds.bottom )\n\t\t);\n\n\t\tlet nextX =\n\t\t\t( left - bounds.left ) /\n\t\t\t( pickerDimensions.width - bounds.left * 2 );\n\t\tlet nextY =\n\t\t\t( top - bounds.top ) / ( pickerDimensions.height - bounds.top * 2 );\n\n\t\t// Enables holding shift to jump values by 10%\n\t\tconst step = shiftKey ? 0.1 : 0.01;\n\n\t\tnextX = roundClamp( nextX, 0, 1, step );\n\t\tnextY = roundClamp( nextY, 0, 1, step );\n\n\t\tconst nextPercentage = {\n\t\t\tx: nextX,\n\t\t\ty: nextY,\n\t\t};\n\n\t\tthis.updateValue( nextPercentage );\n\t}\n\tpickerDimensions() {\n\t\tconst containerNode = this.containerRef.current;\n\n\t\tif ( ! containerNode ) {\n\t\t\treturn {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0,\n\t\t\t\tleft: 0,\n\t\t\t\ttop: 0,\n\t\t\t};\n\t\t}\n\n\t\tconst { clientHeight, clientWidth } = containerNode;\n\t\tconst { top, left } = containerNode.getBoundingClientRect();\n\n\t\treturn {\n\t\t\twidth: clientWidth,\n\t\t\theight: clientHeight,\n\t\t\ttop: top + document.body.scrollTop,\n\t\t\tleft,\n\t\t};\n\t}\n\ticonCoordinates() {\n\t\tconst { value } = this.props;\n\t\tconst { bounds } = this.state;\n\n\t\tif ( bounds.left === undefined || bounds.top === undefined ) {\n\t\t\treturn {\n\t\t\t\tleft: '50%',\n\t\t\t\ttop: '50%',\n\t\t\t};\n\t\t}\n\n\t\tconst pickerDimensions = this.pickerDimensions();\n\t\tconst iconCoordinates = {\n\t\t\tleft:\n\t\t\t\tvalue.x * ( pickerDimensions.width - bounds.left * 2 ) +\n\t\t\t\tbounds.left,\n\t\t\ttop:\n\t\t\t\tvalue.y * ( pickerDimensions.height - bounds.top * 2 ) +\n\t\t\t\tbounds.top,\n\t\t};\n\n\t\treturn iconCoordinates;\n\t}\n\t// Callback method for the withFocusOutside higher-order component\n\thandleFocusOutside() {\n\t\tthis.setState( {\n\t\t\tisDragging: false,\n\t\t} );\n\t}\n\trender() {\n\t\tconst {\n\t\t\tautoPlay,\n\t\t\tclassName,\n\t\t\thelp,\n\t\t\tinstanceId,\n\t\t\tlabel,\n\t\t\tonDragStart,\n\t\t\tonDragEnd,\n\t\t\turl,\n\t\t} = this.props;\n\t\tconst { bounds, isDragging, percentages } = this.state;\n\t\tconst iconCoordinates = this.iconCoordinates();\n\n\t\tconst classes = classnames(\n\t\t\t'components-focal-point-picker-control',\n\t\t\tclassName\n\t\t);\n\n\t\tconst id = `inspector-focal-point-picker-control-${ instanceId }`;\n\n\t\treturn (\n\t\t\t<BaseControl\n\t\t\t\tlabel={ label }\n\t\t\t\tid={ id }\n\t\t\t\thelp={ help }\n\t\t\t\tclassName={ classes }\n\t\t\t>\n\t\t\t\t<MediaWrapper className=\"components-focal-point-picker-wrapper\">\n\t\t\t\t\t<MediaContainer\n\t\t\t\t\t\tclassName=\"components-focal-point-picker\"\n\t\t\t\t\t\tonDragStart={ ( event ) => {\n\t\t\t\t\t\t\tthis.setState( { isDragging: true } );\n\t\t\t\t\t\t\tonDragStart( event );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tonDrop={ ( event ) => {\n\t\t\t\t\t\t\tthis.setState( { isDragging: false } );\n\t\t\t\t\t\t\tonDragEnd( event );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tonKeyDown={ this.handleOnKeyDown }\n\t\t\t\t\t\tonMouseDown={ this.handleOnClick }\n\t\t\t\t\t\tonMouseMove={ this.onMouseMove }\n\t\t\t\t\t\tonMouseUp={ this.handleOnMouseUp }\n\t\t\t\t\t\tref={ this.containerRef }\n\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Grid\n\t\t\t\t\t\t\tbounds={ bounds }\n\t\t\t\t\t\t\tvalue={ percentages.x + percentages.y }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Media\n\t\t\t\t\t\t\talt={ __( 'Media preview' ) }\n\t\t\t\t\t\t\tautoPlay={ autoPlay }\n\t\t\t\t\t\t\tmediaRef={ this.mediaRef }\n\t\t\t\t\t\t\tonLoad={ this.updateBounds }\n\t\t\t\t\t\t\tsrc={ url }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<FocalPoint\n\t\t\t\t\t\t\tcoordinates={ iconCoordinates }\n\t\t\t\t\t\t\tisDragging={ isDragging }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</MediaContainer>\n\t\t\t\t</MediaWrapper>\n\t\t\t\t<Controls\n\t\t\t\t\tpercentages={ percentages }\n\t\t\t\t\tonChange={ this.updateValue }\n\t\t\t\t/>\n\t\t\t</BaseControl>\n\t\t);\n\t}\n}\n\nFocalPointPicker.defaultProps = {\n\tautoPlay: true,\n\tonDragStart: noop,\n\tonDragEnd: noop,\n\tonChange: noop,\n\tvalue: {\n\t\tx: 0.5,\n\t\ty: 0.5,\n\t},\n\turl: null,\n};\n\nexport default compose( [ withInstanceId, withFocusOutside ] )(\n\tFocalPointPicker\n);\n"]}