{"version":3,"sources":["@wordpress/editor/src/components/post-taxonomies/hierarchical-term-selector.js"],"names":["get","unescape","unescapeString","without","find","some","invoke","__","_x","_n","sprintf","Component","CheckboxControl","TreeSelect","withSpokenMessages","withFilters","Button","withSelect","withDispatch","withInstanceId","compose","apiFetch","addQueryArgs","buildTermsTree","DEFAULT_QUERY","per_page","orderby","order","_fields","MIN_TERMS_COUNT_FOR_FILTER","HierarchicalTermSelector","arguments","findTerm","bind","onChange","onChangeFormName","onChangeFormParent","onAddTerm","onToggleForm","setFilterValue","sortBySelected","state","loading","availableTermsTree","availableTerms","adding","formName","formParent","showForm","filterValue","filteredTermsTree","termId","props","onUpdateTerms","terms","taxonomy","hasTerm","indexOf","newTerms","rest_base","event","newValue","target","value","trim","setState","newParent","parent","name","term","parseInt","toLowerCase","preventDefault","slug","existingTerm","id","addRequest","path","method","data","undefined","findOrCreatePromise","catch","error","errorCode","code","search","then","searchResult","Promise","reject","availableTerm","newAvailableTerms","termAddedMessage","speak","xhr","statusText","fetchTerms","fetchRequest","prevProps","termsTree","treeHasSelection","termTree","children","anyChildIsSelected","map","filter","child","length","termOrChildIsSelected","termA","termB","termASelected","termBSelected","sort","getFilterMatcher","getResultCount","count","i","resultCount","resultsFoundMessage","debouncedSpeak","matchTermsForFilter","originalTerm","renderedTerms","renderTerms","instanceId","hasCreateAction","hasAssignAction","labelWithFallback","labelProperty","fallbackIsCategory","fallbackIsNotCategory","newTermButtonLabel","newTermLabel","parentSelectLabel","noParentOption","newTermSubmitLabel","inputId","filterInputId","filterLabel","groupLabel","showFilter","select","getCurrentPost","getTaxonomy","getEditedPostAttribute","dispatch","restBase","editPost"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tget,\n\tunescape as unescapeString,\n\twithout,\n\tfind,\n\tsome,\n\tinvoke,\n} from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __, _x, _n, sprintf } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport {\n\tCheckboxControl,\n\tTreeSelect,\n\twithSpokenMessages,\n\twithFilters,\n\tButton,\n} from '@wordpress/components';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { withInstanceId, compose } from '@wordpress/compose';\nimport apiFetch from '@wordpress/api-fetch';\nimport { addQueryArgs } from '@wordpress/url';\n\n/**\n * Internal dependencies\n */\nimport { buildTermsTree } from '../../utils/terms';\n\n/**\n * Module Constants\n */\nconst DEFAULT_QUERY = {\n\tper_page: -1,\n\torderby: 'name',\n\torder: 'asc',\n\t_fields: 'id,name,parent',\n};\n\nconst MIN_TERMS_COUNT_FOR_FILTER = 8;\n\nclass HierarchicalTermSelector extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\t\tthis.findTerm = this.findTerm.bind( this );\n\t\tthis.onChange = this.onChange.bind( this );\n\t\tthis.onChangeFormName = this.onChangeFormName.bind( this );\n\t\tthis.onChangeFormParent = this.onChangeFormParent.bind( this );\n\t\tthis.onAddTerm = this.onAddTerm.bind( this );\n\t\tthis.onToggleForm = this.onToggleForm.bind( this );\n\t\tthis.setFilterValue = this.setFilterValue.bind( this );\n\t\tthis.sortBySelected = this.sortBySelected.bind( this );\n\t\tthis.state = {\n\t\t\tloading: true,\n\t\t\tavailableTermsTree: [],\n\t\t\tavailableTerms: [],\n\t\t\tadding: false,\n\t\t\tformName: '',\n\t\t\tformParent: '',\n\t\t\tshowForm: false,\n\t\t\tfilterValue: '',\n\t\t\tfilteredTermsTree: [],\n\t\t};\n\t}\n\n\tonChange( termId ) {\n\t\tconst { onUpdateTerms, terms = [], taxonomy } = this.props;\n\t\tconst hasTerm = terms.indexOf( termId ) !== -1;\n\t\tconst newTerms = hasTerm\n\t\t\t? without( terms, termId )\n\t\t\t: [ ...terms, termId ];\n\t\tonUpdateTerms( newTerms, taxonomy.rest_base );\n\t}\n\n\tonChangeFormName( event ) {\n\t\tconst newValue =\n\t\t\tevent.target.value.trim() === '' ? '' : event.target.value;\n\t\tthis.setState( { formName: newValue } );\n\t}\n\n\tonChangeFormParent( newParent ) {\n\t\tthis.setState( { formParent: newParent } );\n\t}\n\n\tonToggleForm() {\n\t\tthis.setState( ( state ) => ( {\n\t\t\tshowForm: ! state.showForm,\n\t\t} ) );\n\t}\n\n\tfindTerm( terms, parent, name ) {\n\t\treturn find( terms, ( term ) => {\n\t\t\treturn (\n\t\t\t\t( ( ! term.parent && ! parent ) ||\n\t\t\t\t\tparseInt( term.parent ) === parseInt( parent ) ) &&\n\t\t\t\tterm.name.toLowerCase() === name.toLowerCase()\n\t\t\t);\n\t\t} );\n\t}\n\n\tonAddTerm( event ) {\n\t\tevent.preventDefault();\n\t\tconst { onUpdateTerms, taxonomy, terms, slug } = this.props;\n\t\tconst { formName, formParent, adding, availableTerms } = this.state;\n\t\tif ( formName === '' || adding ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// check if the term we are adding already exists\n\t\tconst existingTerm = this.findTerm(\n\t\t\tavailableTerms,\n\t\t\tformParent,\n\t\t\tformName\n\t\t);\n\t\tif ( existingTerm ) {\n\t\t\t// if the term we are adding exists but is not selected select it\n\t\t\tif ( ! some( terms, ( term ) => term === existingTerm.id ) ) {\n\t\t\t\tonUpdateTerms(\n\t\t\t\t\t[ ...terms, existingTerm.id ],\n\t\t\t\t\ttaxonomy.rest_base\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.setState( {\n\t\t\t\tformName: '',\n\t\t\t\tformParent: '',\n\t\t\t} );\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setState( {\n\t\t\tadding: true,\n\t\t} );\n\t\tthis.addRequest = apiFetch( {\n\t\t\tpath: `/wp/v2/${ taxonomy.rest_base }`,\n\t\t\tmethod: 'POST',\n\t\t\tdata: {\n\t\t\t\tname: formName,\n\t\t\t\tparent: formParent ? formParent : undefined,\n\t\t\t},\n\t\t} );\n\t\t// Tries to create a term or fetch it if it already exists\n\t\tconst findOrCreatePromise = this.addRequest.catch( ( error ) => {\n\t\t\tconst errorCode = error.code;\n\t\t\tif ( errorCode === 'term_exists' ) {\n\t\t\t\t// search the new category created since last fetch\n\t\t\t\tthis.addRequest = apiFetch( {\n\t\t\t\t\tpath: addQueryArgs( `/wp/v2/${ taxonomy.rest_base }`, {\n\t\t\t\t\t\t...DEFAULT_QUERY,\n\t\t\t\t\t\tparent: formParent || 0,\n\t\t\t\t\t\tsearch: formName,\n\t\t\t\t\t} ),\n\t\t\t\t} );\n\t\t\t\treturn this.addRequest.then( ( searchResult ) => {\n\t\t\t\t\treturn this.findTerm( searchResult, formParent, formName );\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn Promise.reject( error );\n\t\t} );\n\t\tfindOrCreatePromise.then(\n\t\t\t( term ) => {\n\t\t\t\tconst hasTerm = !! find(\n\t\t\t\t\tthis.state.availableTerms,\n\t\t\t\t\t( availableTerm ) => availableTerm.id === term.id\n\t\t\t\t);\n\t\t\t\tconst newAvailableTerms = hasTerm\n\t\t\t\t\t? this.state.availableTerms\n\t\t\t\t\t: [ term, ...this.state.availableTerms ];\n\t\t\t\tconst termAddedMessage = sprintf(\n\t\t\t\t\t/* translators: %s: taxonomy name */\n\t\t\t\t\t_x( '%s added', 'term' ),\n\t\t\t\t\tget(\n\t\t\t\t\t\tthis.props.taxonomy,\n\t\t\t\t\t\t[ 'labels', 'singular_name' ],\n\t\t\t\t\t\tslug === 'category' ? __( 'Category' ) : __( 'Term' )\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t\tthis.props.speak( termAddedMessage, 'assertive' );\n\t\t\t\tthis.addRequest = null;\n\t\t\t\tthis.setState( {\n\t\t\t\t\tadding: false,\n\t\t\t\t\tformName: '',\n\t\t\t\t\tformParent: '',\n\t\t\t\t\tavailableTerms: newAvailableTerms,\n\t\t\t\t\tavailableTermsTree: this.sortBySelected(\n\t\t\t\t\t\tbuildTermsTree( newAvailableTerms )\n\t\t\t\t\t),\n\t\t\t\t} );\n\t\t\t\tonUpdateTerms( [ ...terms, term.id ], taxonomy.rest_base );\n\t\t\t},\n\t\t\t( xhr ) => {\n\t\t\t\tif ( xhr.statusText === 'abort' ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.addRequest = null;\n\t\t\t\tthis.setState( {\n\t\t\t\t\tadding: false,\n\t\t\t\t} );\n\t\t\t}\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.fetchTerms();\n\t}\n\n\tcomponentWillUnmount() {\n\t\tinvoke( this.fetchRequest, [ 'abort' ] );\n\t\tinvoke( this.addRequest, [ 'abort' ] );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( this.props.taxonomy !== prevProps.taxonomy ) {\n\t\t\tthis.fetchTerms();\n\t\t}\n\t}\n\n\tfetchTerms() {\n\t\tconst { taxonomy } = this.props;\n\t\tif ( ! taxonomy ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.fetchRequest = apiFetch( {\n\t\t\tpath: addQueryArgs(\n\t\t\t\t`/wp/v2/${ taxonomy.rest_base }`,\n\t\t\t\tDEFAULT_QUERY\n\t\t\t),\n\t\t} );\n\t\tthis.fetchRequest.then(\n\t\t\t( terms ) => {\n\t\t\t\t// resolve\n\t\t\t\tconst availableTermsTree = this.sortBySelected(\n\t\t\t\t\tbuildTermsTree( terms )\n\t\t\t\t);\n\n\t\t\t\tthis.fetchRequest = null;\n\t\t\t\tthis.setState( {\n\t\t\t\t\tloading: false,\n\t\t\t\t\tavailableTermsTree,\n\t\t\t\t\tavailableTerms: terms,\n\t\t\t\t} );\n\t\t\t},\n\t\t\t( xhr ) => {\n\t\t\t\t// reject\n\t\t\t\tif ( xhr.statusText === 'abort' ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.fetchRequest = null;\n\t\t\t\tthis.setState( {\n\t\t\t\t\tloading: false,\n\t\t\t\t} );\n\t\t\t}\n\t\t);\n\t}\n\n\tsortBySelected( termsTree ) {\n\t\tconst { terms } = this.props;\n\t\tconst treeHasSelection = ( termTree ) => {\n\t\t\tif ( terms.indexOf( termTree.id ) !== -1 ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif ( undefined === termTree.children ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst anyChildIsSelected =\n\t\t\t\ttermTree.children\n\t\t\t\t\t.map( treeHasSelection )\n\t\t\t\t\t.filter( ( child ) => child ).length > 0;\n\t\t\tif ( anyChildIsSelected ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\t\tconst termOrChildIsSelected = ( termA, termB ) => {\n\t\t\tconst termASelected = treeHasSelection( termA );\n\t\t\tconst termBSelected = treeHasSelection( termB );\n\n\t\t\tif ( termASelected === termBSelected ) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif ( termASelected && ! termBSelected ) {\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tif ( ! termASelected && termBSelected ) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn 0;\n\t\t};\n\t\ttermsTree.sort( termOrChildIsSelected );\n\t\treturn termsTree;\n\t}\n\n\tsetFilterValue( event ) {\n\t\tconst { availableTermsTree } = this.state;\n\t\tconst filterValue = event.target.value;\n\t\tconst filteredTermsTree = availableTermsTree\n\t\t\t.map( this.getFilterMatcher( filterValue ) )\n\t\t\t.filter( ( term ) => term );\n\t\tconst getResultCount = ( terms ) => {\n\t\t\tlet count = 0;\n\t\t\tfor ( let i = 0; i < terms.length; i++ ) {\n\t\t\t\tcount++;\n\t\t\t\tif ( undefined !== terms[ i ].children ) {\n\t\t\t\t\tcount += getResultCount( terms[ i ].children );\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn count;\n\t\t};\n\t\tthis.setState( {\n\t\t\tfilterValue,\n\t\t\tfilteredTermsTree,\n\t\t} );\n\n\t\tconst resultCount = getResultCount( filteredTermsTree );\n\t\tconst resultsFoundMessage = sprintf(\n\t\t\t/* translators: %d: number of results */\n\t\t\t_n( '%d result found.', '%d results found.', resultCount ),\n\t\t\tresultCount\n\t\t);\n\t\tthis.props.debouncedSpeak( resultsFoundMessage, 'assertive' );\n\t}\n\n\tgetFilterMatcher( filterValue ) {\n\t\tconst matchTermsForFilter = ( originalTerm ) => {\n\t\t\tif ( '' === filterValue ) {\n\t\t\t\treturn originalTerm;\n\t\t\t}\n\n\t\t\t// Shallow clone, because we'll be filtering the term's children and\n\t\t\t// don't want to modify the original term.\n\t\t\tconst term = { ...originalTerm };\n\n\t\t\t// Map and filter the children, recursive so we deal with grandchildren\n\t\t\t// and any deeper levels.\n\t\t\tif ( term.children.length > 0 ) {\n\t\t\t\tterm.children = term.children\n\t\t\t\t\t.map( matchTermsForFilter )\n\t\t\t\t\t.filter( ( child ) => child );\n\t\t\t}\n\n\t\t\t// If the term's name contains the filterValue, or it has children\n\t\t\t// (i.e. some child matched at some point in the tree) then return it.\n\t\t\tif (\n\t\t\t\t-1 !==\n\t\t\t\t\tterm.name\n\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t.indexOf( filterValue.toLowerCase() ) ||\n\t\t\t\tterm.children.length > 0\n\t\t\t) {\n\t\t\t\treturn term;\n\t\t\t}\n\n\t\t\t// Otherwise, return false. After mapping, the list of terms will need\n\t\t\t// to have false values filtered out.\n\t\t\treturn false;\n\t\t};\n\t\treturn matchTermsForFilter;\n\t}\n\n\trenderTerms( renderedTerms ) {\n\t\tconst { terms = [] } = this.props;\n\t\treturn renderedTerms.map( ( term ) => {\n\t\t\treturn (\n\t\t\t\t<div\n\t\t\t\t\tkey={ term.id }\n\t\t\t\t\tclassName=\"editor-post-taxonomies__hierarchical-terms-choice\"\n\t\t\t\t>\n\t\t\t\t\t<CheckboxControl\n\t\t\t\t\t\tchecked={ terms.indexOf( term.id ) !== -1 }\n\t\t\t\t\t\tonChange={ () => {\n\t\t\t\t\t\t\tconst termId = parseInt( term.id, 10 );\n\t\t\t\t\t\t\tthis.onChange( termId );\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tlabel={ unescapeString( term.name ) }\n\t\t\t\t\t/>\n\t\t\t\t\t{ !! term.children.length && (\n\t\t\t\t\t\t<div className=\"editor-post-taxonomies__hierarchical-terms-subchoices\">\n\t\t\t\t\t\t\t{ this.renderTerms( term.children ) }\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) }\n\t\t\t\t</div>\n\t\t\t);\n\t\t} );\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tslug,\n\t\t\ttaxonomy,\n\t\t\tinstanceId,\n\t\t\thasCreateAction,\n\t\t\thasAssignAction,\n\t\t} = this.props;\n\n\t\tif ( ! hasAssignAction ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst {\n\t\t\tavailableTermsTree,\n\t\t\tavailableTerms,\n\t\t\tfilteredTermsTree,\n\t\t\tformName,\n\t\t\tformParent,\n\t\t\tloading,\n\t\t\tshowForm,\n\t\t\tfilterValue,\n\t\t} = this.state;\n\t\tconst labelWithFallback = (\n\t\t\tlabelProperty,\n\t\t\tfallbackIsCategory,\n\t\t\tfallbackIsNotCategory\n\t\t) =>\n\t\t\tget(\n\t\t\t\ttaxonomy,\n\t\t\t\t[ 'labels', labelProperty ],\n\t\t\t\tslug === 'category' ? fallbackIsCategory : fallbackIsNotCategory\n\t\t\t);\n\t\tconst newTermButtonLabel = labelWithFallback(\n\t\t\t'add_new_item',\n\t\t\t__( 'Add new category' ),\n\t\t\t__( 'Add new term' )\n\t\t);\n\t\tconst newTermLabel = labelWithFallback(\n\t\t\t'new_item_name',\n\t\t\t__( 'Add new category' ),\n\t\t\t__( 'Add new term' )\n\t\t);\n\t\tconst parentSelectLabel = labelWithFallback(\n\t\t\t'parent_item',\n\t\t\t__( 'Parent Category' ),\n\t\t\t__( 'Parent Term' )\n\t\t);\n\t\tconst noParentOption = `— ${ parentSelectLabel } —`;\n\t\tconst newTermSubmitLabel = newTermButtonLabel;\n\t\tconst inputId = `editor-post-taxonomies__hierarchical-terms-input-${ instanceId }`;\n\t\tconst filterInputId = `editor-post-taxonomies__hierarchical-terms-filter-${ instanceId }`;\n\t\tconst filterLabel = get(\n\t\t\tthis.props.taxonomy,\n\t\t\t[ 'labels', 'search_items' ],\n\t\t\t__( 'Search Terms' )\n\t\t);\n\t\tconst groupLabel = get(\n\t\t\tthis.props.taxonomy,\n\t\t\t[ 'name' ],\n\t\t\t__( 'Terms' )\n\t\t);\n\t\tconst showFilter = availableTerms.length >= MIN_TERMS_COUNT_FOR_FILTER;\n\n\t\treturn [\n\t\t\tshowFilter && (\n\t\t\t\t<label key=\"filter-label\" htmlFor={ filterInputId }>\n\t\t\t\t\t{ filterLabel }\n\t\t\t\t</label>\n\t\t\t),\n\t\t\tshowFilter && (\n\t\t\t\t<input\n\t\t\t\t\ttype=\"search\"\n\t\t\t\t\tid={ filterInputId }\n\t\t\t\t\tvalue={ filterValue }\n\t\t\t\t\tonChange={ this.setFilterValue }\n\t\t\t\t\tclassName=\"editor-post-taxonomies__hierarchical-terms-filter\"\n\t\t\t\t\tkey=\"term-filter-input\"\n\t\t\t\t/>\n\t\t\t),\n\t\t\t<div\n\t\t\t\tclassName=\"editor-post-taxonomies__hierarchical-terms-list\"\n\t\t\t\tkey=\"term-list\"\n\t\t\t\ttabIndex=\"0\"\n\t\t\t\trole=\"group\"\n\t\t\t\taria-label={ groupLabel }\n\t\t\t>\n\t\t\t\t{ this.renderTerms(\n\t\t\t\t\t'' !== filterValue ? filteredTermsTree : availableTermsTree\n\t\t\t\t) }\n\t\t\t</div>,\n\t\t\t! loading && hasCreateAction && (\n\t\t\t\t<Button\n\t\t\t\t\tkey=\"term-add-button\"\n\t\t\t\t\tonClick={ this.onToggleForm }\n\t\t\t\t\tclassName=\"editor-post-taxonomies__hierarchical-terms-add\"\n\t\t\t\t\taria-expanded={ showForm }\n\t\t\t\t\tisLink\n\t\t\t\t>\n\t\t\t\t\t{ newTermButtonLabel }\n\t\t\t\t</Button>\n\t\t\t),\n\t\t\tshowForm && (\n\t\t\t\t<form onSubmit={ this.onAddTerm } key=\"hierarchical-terms-form\">\n\t\t\t\t\t<label\n\t\t\t\t\t\thtmlFor={ inputId }\n\t\t\t\t\t\tclassName=\"editor-post-taxonomies__hierarchical-terms-label\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{ newTermLabel }\n\t\t\t\t\t</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tid={ inputId }\n\t\t\t\t\t\tclassName=\"editor-post-taxonomies__hierarchical-terms-input\"\n\t\t\t\t\t\tvalue={ formName }\n\t\t\t\t\t\tonChange={ this.onChangeFormName }\n\t\t\t\t\t\trequired\n\t\t\t\t\t/>\n\t\t\t\t\t{ !! availableTerms.length && (\n\t\t\t\t\t\t<TreeSelect\n\t\t\t\t\t\t\tlabel={ parentSelectLabel }\n\t\t\t\t\t\t\tnoOptionLabel={ noParentOption }\n\t\t\t\t\t\t\tonChange={ this.onChangeFormParent }\n\t\t\t\t\t\t\tselectedId={ formParent }\n\t\t\t\t\t\t\ttree={ availableTermsTree }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t<Button\n\t\t\t\t\t\tisSecondary\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\tclassName=\"editor-post-taxonomies__hierarchical-terms-submit\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{ newTermSubmitLabel }\n\t\t\t\t\t</Button>\n\t\t\t\t</form>\n\t\t\t),\n\t\t];\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, { slug } ) => {\n\t\tconst { getCurrentPost } = select( 'core/editor' );\n\t\tconst { getTaxonomy } = select( 'core' );\n\t\tconst taxonomy = getTaxonomy( slug );\n\t\treturn {\n\t\t\thasCreateAction: taxonomy\n\t\t\t\t? get(\n\t\t\t\t\t\tgetCurrentPost(),\n\t\t\t\t\t\t[ '_links', 'wp:action-create-' + taxonomy.rest_base ],\n\t\t\t\t\t\tfalse\n\t\t\t\t  )\n\t\t\t\t: false,\n\t\t\thasAssignAction: taxonomy\n\t\t\t\t? get(\n\t\t\t\t\t\tgetCurrentPost(),\n\t\t\t\t\t\t[ '_links', 'wp:action-assign-' + taxonomy.rest_base ],\n\t\t\t\t\t\tfalse\n\t\t\t\t  )\n\t\t\t\t: false,\n\t\t\tterms: taxonomy\n\t\t\t\t? select( 'core/editor' ).getEditedPostAttribute(\n\t\t\t\t\t\ttaxonomy.rest_base\n\t\t\t\t  )\n\t\t\t\t: [],\n\t\t\ttaxonomy,\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => ( {\n\t\tonUpdateTerms( terms, restBase ) {\n\t\t\tdispatch( 'core/editor' ).editPost( { [ restBase ]: terms } );\n\t\t},\n\t} ) ),\n\twithSpokenMessages,\n\twithInstanceId,\n\twithFilters( 'editor.PostTaxonomyType' ),\n] )( HierarchicalTermSelector );\n"]}