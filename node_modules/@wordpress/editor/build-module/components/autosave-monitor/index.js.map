{"version":3,"sources":["@wordpress/editor/src/components/autosave-monitor/index.js"],"names":["Component","compose","withSelect","withDispatch","AutosaveMonitor","props","needsAutosave","isDirty","isAutosaveable","disableIntervalChecks","setAutosaveTimer","prevProps","editsReference","autosave","isAutosaving","clearTimeout","timerId","timeout","interval","setTimeout","autosaveTimerHandler","select","ownProps","getReferenceByDistinctEdits","isEditedPostDirty","isEditedPostAutosaveable","isAutosavingPost","getEditorSettings","autosaveInterval","dispatch"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { compose } from '@wordpress/compose';\nimport { withSelect, withDispatch } from '@wordpress/data';\n\nexport class AutosaveMonitor extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\t\tthis.needsAutosave = !! ( props.isDirty && props.isAutosaveable );\n\t}\n\n\tcomponentDidMount() {\n\t\tif ( ! this.props.disableIntervalChecks ) {\n\t\t\tthis.setAutosaveTimer();\n\t\t}\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif (\n\t\t\tthis.props.disableIntervalChecks &&\n\t\t\tthis.props.editsReference !== prevProps.editsReference\n\t\t) {\n\t\t\tthis.props.autosave();\n\t\t\treturn;\n\t\t}\n\n\t\tif ( ! this.props.isDirty && prevProps.isDirty ) {\n\t\t\tthis.needsAutosave = false;\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.props.isAutosaving && ! prevProps.isAutosaving ) {\n\t\t\tthis.needsAutosave = false;\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.props.editsReference !== prevProps.editsReference ) {\n\t\t\tthis.needsAutosave = true;\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tclearTimeout( this.timerId );\n\t}\n\n\tsetAutosaveTimer( timeout = this.props.interval * 1000 ) {\n\t\tthis.timerId = setTimeout( () => {\n\t\t\tthis.autosaveTimerHandler();\n\t\t}, timeout );\n\t}\n\n\tautosaveTimerHandler() {\n\t\tif ( ! this.props.isAutosaveable ) {\n\t\t\tthis.setAutosaveTimer( 1000 );\n\t\t\treturn;\n\t\t}\n\n\t\tif ( this.needsAutosave ) {\n\t\t\tthis.needsAutosave = false;\n\t\t\tthis.props.autosave();\n\t\t}\n\n\t\tthis.setAutosaveTimer();\n\t}\n\n\trender() {\n\t\treturn null;\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, ownProps ) => {\n\t\tconst { getReferenceByDistinctEdits } = select( 'core' );\n\n\t\tconst {\n\t\t\tisEditedPostDirty,\n\t\t\tisEditedPostAutosaveable,\n\t\t\tisAutosavingPost,\n\t\t\tgetEditorSettings,\n\t\t} = select( 'core/editor' );\n\n\t\tconst { interval = getEditorSettings().autosaveInterval } = ownProps;\n\n\t\treturn {\n\t\t\teditsReference: getReferenceByDistinctEdits(),\n\t\t\tisDirty: isEditedPostDirty(),\n\t\t\tisAutosaveable: isEditedPostAutosaveable(),\n\t\t\tisAutosaving: isAutosavingPost(),\n\t\t\tinterval,\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch, ownProps ) => ( {\n\t\tautosave() {\n\t\t\tconst { autosave = dispatch( 'core/editor' ).autosave } = ownProps;\n\t\t\tautosave();\n\t\t},\n\t} ) ),\n] )( AutosaveMonitor );\n"]}