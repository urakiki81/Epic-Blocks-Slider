{"version":3,"sources":["@wordpress/editor/src/components/post-featured-image/index.js"],"names":["ALLOWED_MEDIA_TYPES","DEFAULT_FEATURE_IMAGE_LABEL","DEFAULT_SET_FEATURE_IMAGE_LABEL","DEFAULT_REMOVE_FEATURE_IMAGE_LABEL","PostFeaturedImage","currentPostId","featuredImageId","onUpdateImage","onDropImage","onRemoveImage","media","postType","noticeUI","postLabel","instructions","mediaWidth","mediaHeight","mediaSourceUrl","mediaSize","id","media_details","sizes","width","height","source_url","fallbackMediaSize","featured_image","open","set_featured_image","isLoading","remove_featured_image","applyWithSelect","select","getMedia","getPostType","getCurrentPostId","getEditedPostAttribute","applyWithDispatch","dispatch","noticeOperations","editPost","image","featured_media","filesList","getSettings","mediaUpload","allowedTypes","onFileChange","onError","message","removeAllNotices","createErrorNotice","withNotices"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { has, get } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { applyFilters } from '@wordpress/hooks';\nimport {\n\tDropZone,\n\tButton,\n\tSpinner,\n\tResponsiveWrapper,\n\twithNotices,\n\twithFilters,\n} from '@wordpress/components';\nimport { compose } from '@wordpress/compose';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { MediaUpload, MediaUploadCheck } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport PostFeaturedImageCheck from './check';\n\nconst ALLOWED_MEDIA_TYPES = [ 'image' ];\n\n// Used when labels from post type were not yet loaded or when they are not present.\nconst DEFAULT_FEATURE_IMAGE_LABEL = __( 'Featured image' );\nconst DEFAULT_SET_FEATURE_IMAGE_LABEL = __( 'Set featured image' );\nconst DEFAULT_REMOVE_FEATURE_IMAGE_LABEL = __( 'Remove image' );\n\nfunction PostFeaturedImage( {\n\tcurrentPostId,\n\tfeaturedImageId,\n\tonUpdateImage,\n\tonDropImage,\n\tonRemoveImage,\n\tmedia,\n\tpostType,\n\tnoticeUI,\n} ) {\n\tconst postLabel = get( postType, [ 'labels' ], {} );\n\tconst instructions = (\n\t\t<p>\n\t\t\t{ __(\n\t\t\t\t'To edit the featured image, you need permission to upload media.'\n\t\t\t) }\n\t\t</p>\n\t);\n\n\tlet mediaWidth, mediaHeight, mediaSourceUrl;\n\tif ( media ) {\n\t\tconst mediaSize = applyFilters(\n\t\t\t'editor.PostFeaturedImage.imageSize',\n\t\t\t'post-thumbnail',\n\t\t\tmedia.id,\n\t\t\tcurrentPostId\n\t\t);\n\t\tif ( has( media, [ 'media_details', 'sizes', mediaSize ] ) ) {\n\t\t\t// use mediaSize when available\n\t\t\tmediaWidth = media.media_details.sizes[ mediaSize ].width;\n\t\t\tmediaHeight = media.media_details.sizes[ mediaSize ].height;\n\t\t\tmediaSourceUrl = media.media_details.sizes[ mediaSize ].source_url;\n\t\t} else {\n\t\t\t// get fallbackMediaSize if mediaSize is not available\n\t\t\tconst fallbackMediaSize = applyFilters(\n\t\t\t\t'editor.PostFeaturedImage.imageSize',\n\t\t\t\t'thumbnail',\n\t\t\t\tmedia.id,\n\t\t\t\tcurrentPostId\n\t\t\t);\n\t\t\tif (\n\t\t\t\thas( media, [ 'media_details', 'sizes', fallbackMediaSize ] )\n\t\t\t) {\n\t\t\t\t// use fallbackMediaSize when mediaSize is not available\n\t\t\t\tmediaWidth =\n\t\t\t\t\tmedia.media_details.sizes[ fallbackMediaSize ].width;\n\t\t\t\tmediaHeight =\n\t\t\t\t\tmedia.media_details.sizes[ fallbackMediaSize ].height;\n\t\t\t\tmediaSourceUrl =\n\t\t\t\t\tmedia.media_details.sizes[ fallbackMediaSize ].source_url;\n\t\t\t} else {\n\t\t\t\t// use full image size when mediaFallbackSize and mediaSize are not available\n\t\t\t\tmediaWidth = media.media_details.width;\n\t\t\t\tmediaHeight = media.media_details.height;\n\t\t\t\tmediaSourceUrl = media.source_url;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn (\n\t\t<PostFeaturedImageCheck>\n\t\t\t{ noticeUI }\n\t\t\t<div className=\"editor-post-featured-image\">\n\t\t\t\t<MediaUploadCheck fallback={ instructions }>\n\t\t\t\t\t<MediaUpload\n\t\t\t\t\t\ttitle={\n\t\t\t\t\t\t\tpostLabel.featured_image ||\n\t\t\t\t\t\t\tDEFAULT_FEATURE_IMAGE_LABEL\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonSelect={ onUpdateImage }\n\t\t\t\t\t\tunstableFeaturedImageFlow\n\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\t\tmodalClass={\n\t\t\t\t\t\t\t! featuredImageId\n\t\t\t\t\t\t\t\t? 'editor-post-featured-image__media-modal'\n\t\t\t\t\t\t\t\t: 'editor-post-featured-image__media-modal'\n\t\t\t\t\t\t}\n\t\t\t\t\t\trender={ ( { open } ) => (\n\t\t\t\t\t\t\t<div className=\"editor-post-featured-image__container\">\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tclassName={\n\t\t\t\t\t\t\t\t\t\t! featuredImageId\n\t\t\t\t\t\t\t\t\t\t\t? 'editor-post-featured-image__toggle'\n\t\t\t\t\t\t\t\t\t\t\t: 'editor-post-featured-image__preview'\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tonClick={ open }\n\t\t\t\t\t\t\t\t\taria-label={\n\t\t\t\t\t\t\t\t\t\t! featuredImageId\n\t\t\t\t\t\t\t\t\t\t\t? null\n\t\t\t\t\t\t\t\t\t\t\t: __( 'Edit or update the image' )\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{ !! featuredImageId && media && (\n\t\t\t\t\t\t\t\t\t\t<ResponsiveWrapper\n\t\t\t\t\t\t\t\t\t\t\tnaturalWidth={ mediaWidth }\n\t\t\t\t\t\t\t\t\t\t\tnaturalHeight={ mediaHeight }\n\t\t\t\t\t\t\t\t\t\t\tisInline\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={ mediaSourceUrl }\n\t\t\t\t\t\t\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</ResponsiveWrapper>\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t{ !! featuredImageId && ! media && (\n\t\t\t\t\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\t{ ! featuredImageId &&\n\t\t\t\t\t\t\t\t\t\t( postLabel.set_featured_image ||\n\t\t\t\t\t\t\t\t\t\t\tDEFAULT_SET_FEATURE_IMAGE_LABEL ) }\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t<DropZone onFilesDrop={ onDropImage } />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) }\n\t\t\t\t\t\tvalue={ featuredImageId }\n\t\t\t\t\t/>\n\t\t\t\t</MediaUploadCheck>\n\t\t\t\t{ !! featuredImageId && media && ! media.isLoading && (\n\t\t\t\t\t<MediaUploadCheck>\n\t\t\t\t\t\t<MediaUpload\n\t\t\t\t\t\t\ttitle={\n\t\t\t\t\t\t\t\tpostLabel.featured_image ||\n\t\t\t\t\t\t\t\tDEFAULT_FEATURE_IMAGE_LABEL\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonSelect={ onUpdateImage }\n\t\t\t\t\t\t\tunstableFeaturedImageFlow\n\t\t\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\t\t\tmodalClass=\"editor-post-featured-image__media-modal\"\n\t\t\t\t\t\t\trender={ ( { open } ) => (\n\t\t\t\t\t\t\t\t<Button onClick={ open } isSecondary>\n\t\t\t\t\t\t\t\t\t{ __( 'Replace Image' ) }\n\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</MediaUploadCheck>\n\t\t\t\t) }\n\t\t\t\t{ !! featuredImageId && (\n\t\t\t\t\t<MediaUploadCheck>\n\t\t\t\t\t\t<Button onClick={ onRemoveImage } isLink isDestructive>\n\t\t\t\t\t\t\t{ postLabel.remove_featured_image ||\n\t\t\t\t\t\t\t\tDEFAULT_REMOVE_FEATURE_IMAGE_LABEL }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</MediaUploadCheck>\n\t\t\t\t) }\n\t\t\t</div>\n\t\t</PostFeaturedImageCheck>\n\t);\n}\n\nconst applyWithSelect = withSelect( ( select ) => {\n\tconst { getMedia, getPostType } = select( 'core' );\n\tconst { getCurrentPostId, getEditedPostAttribute } = select(\n\t\t'core/editor'\n\t);\n\tconst featuredImageId = getEditedPostAttribute( 'featured_media' );\n\n\treturn {\n\t\tmedia: featuredImageId ? getMedia( featuredImageId ) : null,\n\t\tcurrentPostId: getCurrentPostId(),\n\t\tpostType: getPostType( getEditedPostAttribute( 'type' ) ),\n\t\tfeaturedImageId,\n\t};\n} );\n\nconst applyWithDispatch = withDispatch(\n\t( dispatch, { noticeOperations }, { select } ) => {\n\t\tconst { editPost } = dispatch( 'core/editor' );\n\t\treturn {\n\t\t\tonUpdateImage( image ) {\n\t\t\t\teditPost( { featured_media: image.id } );\n\t\t\t},\n\t\t\tonDropImage( filesList ) {\n\t\t\t\tselect( 'core/block-editor' )\n\t\t\t\t\t.getSettings()\n\t\t\t\t\t.mediaUpload( {\n\t\t\t\t\t\tallowedTypes: [ 'image' ],\n\t\t\t\t\t\tfilesList,\n\t\t\t\t\t\tonFileChange( [ image ] ) {\n\t\t\t\t\t\t\teditPost( { featured_media: image.id } );\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonError( message ) {\n\t\t\t\t\t\t\tnoticeOperations.removeAllNotices();\n\t\t\t\t\t\t\tnoticeOperations.createErrorNotice( message );\n\t\t\t\t\t\t},\n\t\t\t\t\t} );\n\t\t\t},\n\t\t\tonRemoveImage() {\n\t\t\t\teditPost( { featured_media: 0 } );\n\t\t\t},\n\t\t};\n\t}\n);\n\nexport default compose(\n\twithNotices,\n\tapplyWithSelect,\n\tapplyWithDispatch,\n\twithFilters( 'editor.PostFeaturedImage' )\n)( PostFeaturedImage );\n"]}