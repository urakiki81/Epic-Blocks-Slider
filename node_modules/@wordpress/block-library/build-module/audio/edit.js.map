{"version":3,"sources":["@wordpress/block-library/src/audio/edit.js"],"names":["getBlobByURL","isBlobURL","Disabled","PanelBody","SelectControl","ToggleControl","withNotices","BlockControls","BlockIcon","InspectorControls","MediaPlaceholder","MediaReplaceFlow","RichText","__experimentalBlock","Block","useEffect","__","useSelect","audio","icon","createBlock","createUpgradedEmbedBlock","ALLOWED_MEDIA_TYPES","AudioEdit","attributes","noticeOperations","setAttributes","onReplace","isSelected","noticeUI","insertBlocksAfter","id","autoplay","caption","loop","preload","src","mediaUpload","select","getSettings","file","filesList","onFileChange","mediaId","url","onError","e","undefined","createErrorNotice","allowedTypes","toggleAttribute","attribute","newValue","onSelectURL","newSrc","embedBlock","onUploadError","message","removeAllNotices","getAutoplayHelp","checked","onSelectAudio","media","value","label","isEmpty"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { getBlobByURL, isBlobURL } from '@wordpress/blob';\nimport {\n\tDisabled,\n\tPanelBody,\n\tSelectControl,\n\tToggleControl,\n\twithNotices,\n} from '@wordpress/components';\nimport {\n\tBlockControls,\n\tBlockIcon,\n\tInspectorControls,\n\tMediaPlaceholder,\n\tMediaReplaceFlow,\n\tRichText,\n\t__experimentalBlock as Block,\n} from '@wordpress/block-editor';\nimport { useEffect } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { useSelect } from '@wordpress/data';\nimport { audio as icon } from '@wordpress/icons';\nimport { createBlock } from '@wordpress/blocks';\n\n/**\n * Internal dependencies\n */\nimport { createUpgradedEmbedBlock } from '../embed/util';\n\nconst ALLOWED_MEDIA_TYPES = [ 'audio' ];\n\nfunction AudioEdit( {\n\tattributes,\n\tnoticeOperations,\n\tsetAttributes,\n\tonReplace,\n\tisSelected,\n\tnoticeUI,\n\tinsertBlocksAfter,\n} ) {\n\tconst { id, autoplay, caption, loop, preload, src } = attributes;\n\n\tconst mediaUpload = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( 'core/block-editor' );\n\t\treturn getSettings().mediaUpload;\n\t}, [] );\n\n\tuseEffect( () => {\n\t\tif ( ! id && isBlobURL( src ) ) {\n\t\t\tconst file = getBlobByURL( src );\n\n\t\t\tif ( file ) {\n\t\t\t\tmediaUpload( {\n\t\t\t\t\tfilesList: [ file ],\n\t\t\t\t\tonFileChange: ( [ { id: mediaId, url } ] ) => {\n\t\t\t\t\t\tsetAttributes( { id: mediaId, src: url } );\n\t\t\t\t\t},\n\t\t\t\t\tonError: ( e ) => {\n\t\t\t\t\t\tsetAttributes( { src: undefined, id: undefined } );\n\t\t\t\t\t\tnoticeOperations.createErrorNotice( e );\n\t\t\t\t\t},\n\t\t\t\t\tallowedTypes: ALLOWED_MEDIA_TYPES,\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t}, [] );\n\n\tfunction toggleAttribute( attribute ) {\n\t\treturn ( newValue ) => {\n\t\t\tsetAttributes( { [ attribute ]: newValue } );\n\t\t};\n\t}\n\n\tfunction onSelectURL( newSrc ) {\n\t\t// Set the block's src from the edit component's state, and switch off\n\t\t// the editing UI.\n\t\tif ( newSrc !== src ) {\n\t\t\t// Check if there's an embed block that handles this URL.\n\t\t\tconst embedBlock = createUpgradedEmbedBlock( {\n\t\t\t\tattributes: { url: newSrc },\n\t\t\t} );\n\t\t\tif ( undefined !== embedBlock ) {\n\t\t\t\tonReplace( embedBlock );\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetAttributes( { src: newSrc, id: undefined } );\n\t\t}\n\t}\n\n\tfunction onUploadError( message ) {\n\t\tnoticeOperations.removeAllNotices();\n\t\tnoticeOperations.createErrorNotice( message );\n\t}\n\n\tfunction getAutoplayHelp( checked ) {\n\t\treturn checked\n\t\t\t? __(\n\t\t\t\t\t'Note: Autoplaying audio may cause usability issues for some visitors.'\n\t\t\t  )\n\t\t\t: null;\n\t}\n\n\t// const { setAttributes, isSelected, noticeUI } = this.props;\n\tfunction onSelectAudio( media ) {\n\t\tif ( ! media || ! media.url ) {\n\t\t\t// in this case there was an error and we should continue in the editing state\n\t\t\t// previous attributes should be removed because they may be temporary blob urls\n\t\t\tsetAttributes( { src: undefined, id: undefined } );\n\t\t\treturn;\n\t\t}\n\t\t// sets the block's attribute and updates the edit component from the\n\t\t// selected media, then switches off the editing UI\n\t\tsetAttributes( { src: media.url, id: media.id } );\n\t}\n\tif ( ! src ) {\n\t\treturn (\n\t\t\t<Block.div>\n\t\t\t\t<MediaPlaceholder\n\t\t\t\t\ticon={ <BlockIcon icon={ icon } /> }\n\t\t\t\t\tonSelect={ onSelectAudio }\n\t\t\t\t\tonSelectURL={ onSelectURL }\n\t\t\t\t\taccept=\"audio/*\"\n\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\tvalue={ attributes }\n\t\t\t\t\tnotices={ noticeUI }\n\t\t\t\t\tonError={ onUploadError }\n\t\t\t\t/>\n\t\t\t</Block.div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<BlockControls>\n\t\t\t\t<MediaReplaceFlow\n\t\t\t\t\tmediaId={ id }\n\t\t\t\t\tmediaURL={ src }\n\t\t\t\t\tallowedTypes={ ALLOWED_MEDIA_TYPES }\n\t\t\t\t\taccept=\"audio/*\"\n\t\t\t\t\tonSelect={ onSelectAudio }\n\t\t\t\t\tonSelectURL={ onSelectURL }\n\t\t\t\t\tonError={ onUploadError }\n\t\t\t\t/>\n\t\t\t</BlockControls>\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Audio settings' ) }>\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ __( 'Autoplay' ) }\n\t\t\t\t\t\tonChange={ toggleAttribute( 'autoplay' ) }\n\t\t\t\t\t\tchecked={ autoplay }\n\t\t\t\t\t\thelp={ getAutoplayHelp }\n\t\t\t\t\t/>\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ __( 'Loop' ) }\n\t\t\t\t\t\tonChange={ toggleAttribute( 'loop' ) }\n\t\t\t\t\t\tchecked={ loop }\n\t\t\t\t\t/>\n\t\t\t\t\t<SelectControl\n\t\t\t\t\t\tlabel={ __( 'Preload' ) }\n\t\t\t\t\t\tvalue={ preload || '' }\n\t\t\t\t\t\t// `undefined` is required for the preload attribute to be unset.\n\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\tpreload: value || undefined,\n\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t}\n\t\t\t\t\t\toptions={ [\n\t\t\t\t\t\t\t{ value: '', label: __( 'Browser default' ) },\n\t\t\t\t\t\t\t{ value: 'auto', label: __( 'Auto' ) },\n\t\t\t\t\t\t\t{ value: 'metadata', label: __( 'Metadata' ) },\n\t\t\t\t\t\t\t{ value: 'none', label: __( 'None' ) },\n\t\t\t\t\t\t] }\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t\t<Block.figure>\n\t\t\t\t{ /*\n\t\t\t\t\tDisable the audio tag so the user clicking on it won't play the\n\t\t\t\t\tfile or change the position slider when the controls are enabled.\n\t\t\t\t*/ }\n\t\t\t\t<Disabled>\n\t\t\t\t\t<audio controls=\"controls\" src={ src } />\n\t\t\t\t</Disabled>\n\t\t\t\t{ ( ! RichText.isEmpty( caption ) || isSelected ) && (\n\t\t\t\t\t<RichText\n\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\tplaceholder={ __( 'Write caption…' ) }\n\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\tsetAttributes( { caption: value } )\n\t\t\t\t\t\t}\n\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t\t__unstableOnSplitAtEnd={ () =>\n\t\t\t\t\t\t\tinsertBlocksAfter( createBlock( 'core/paragraph' ) )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</Block.figure>\n\t\t</>\n\t);\n}\nexport default withNotices( AudioEdit );\n"]}