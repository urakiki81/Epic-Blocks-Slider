{"version":3,"sources":["@wordpress/block-library/src/template-part/edit/selection/template-part-previews.js"],"names":["useSelect","useDispatch","parse","useMemo","useCallback","ENTER","SPACE","__","sprintf","BlockPreview","Icon","useAsyncList","groupBy","uniq","deburr","PreviewPlaceholder","TemplatePartItem","templatePart","setAttributes","onClose","id","slug","theme","meta","content","raw","blocks","createSuccessNotice","onClick","postId","type","event","keyCode","PanelGroup","title","icon","children","TemplatePartsByTheme","templateParts","templatePartsByTheme","Object","values","currentShownTPs","map","templatePartList","includes","TemplatePartSearchResults","filterValue","filteredTPs","normalizedFilterValue","toLowerCase","searchResults","filter","sort","a","b","indexInSlugA","indexOf","indexInSlugB","TemplateParts","select","publishedTemplateParts","getEntityRecords","status","per_page","currentTheme","getCurrentTheme","textdomain","themeTemplateParts","combinedTemplateParts","push","length"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { parse } from '@wordpress/blocks';\nimport { useMemo, useCallback } from '@wordpress/element';\nimport { ENTER, SPACE } from '@wordpress/keycodes';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { BlockPreview } from '@wordpress/block-editor';\nimport { Icon } from '@wordpress/components';\nimport { useAsyncList } from '@wordpress/compose';\n\n/**\n * External dependencies\n */\nimport { groupBy, uniq, deburr } from 'lodash';\n\nfunction PreviewPlaceholder() {\n\treturn (\n\t\t<div className=\"wp-block-template-part__selection-preview-item is-placeholder\" />\n\t);\n}\n\nfunction TemplatePartItem( { templatePart, setAttributes, onClose } ) {\n\tconst {\n\t\tid,\n\t\tslug,\n\t\tmeta: { theme },\n\t} = templatePart;\n\t// The 'raw' property is not defined for a brief period in the save cycle.\n\t// The fallback prevents an error in the parse function while saving.\n\tconst content = templatePart.content.raw || '';\n\tconst blocks = useMemo( () => parse( content ), [ content ] );\n\tconst { createSuccessNotice } = useDispatch( 'core/notices' );\n\n\tconst onClick = useCallback( () => {\n\t\tsetAttributes( { postId: id, slug, theme } );\n\t\tcreateSuccessNotice(\n\t\t\tsprintf(\n\t\t\t\t/* translators: %s: template part title. */\n\t\t\t\t__( 'Template Part \"%s\" inserted.' ),\n\t\t\t\tslug\n\t\t\t),\n\t\t\t{\n\t\t\t\ttype: 'snackbar',\n\t\t\t}\n\t\t);\n\t\tonClose();\n\t}, [ id, slug, theme ] );\n\n\treturn (\n\t\t<div\n\t\t\tclassName=\"wp-block-template-part__selection-preview-item\"\n\t\t\trole=\"button\"\n\t\t\tonClick={ onClick }\n\t\t\tonKeyDown={ ( event ) => {\n\t\t\t\tif ( ENTER === event.keyCode || SPACE === event.keyCode ) {\n\t\t\t\t\tonClick();\n\t\t\t\t}\n\t\t\t} }\n\t\t\ttabIndex={ 0 }\n\t\t\taria-label={ templatePart.slug }\n\t\t>\n\t\t\t<BlockPreview blocks={ blocks } />\n\t\t\t<div className=\"wp-block-template-part__selection-preview-item-title\">\n\t\t\t\t{ templatePart.slug }\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction PanelGroup( { title, icon, children } ) {\n\treturn (\n\t\t<>\n\t\t\t<div className=\"wp-block-template-part__selection-panel-group-header\">\n\t\t\t\t<span className=\"wp-block-template-part__selection-panel-group-title\">\n\t\t\t\t\t{ title }\n\t\t\t\t</span>\n\t\t\t\t<Icon icon={ icon } />\n\t\t\t</div>\n\t\t\t<div className=\"wp-block-template-part__selection-panel-group-content\">\n\t\t\t\t{ children }\n\t\t\t</div>\n\t\t</>\n\t);\n}\n\nfunction TemplatePartsByTheme( { templateParts, setAttributes, onClose } ) {\n\tconst templatePartsByTheme = useMemo( () => {\n\t\treturn Object.values( groupBy( templateParts, 'meta.theme' ) );\n\t}, [ templateParts ] );\n\tconst currentShownTPs = useAsyncList( templateParts );\n\n\treturn templatePartsByTheme.map( ( templatePartList ) => (\n\t\t<PanelGroup\n\t\t\tkey={ templatePartList[ 0 ].meta.theme }\n\t\t\ttitle={ templatePartList[ 0 ].meta.theme }\n\t\t>\n\t\t\t{ templatePartList.map( ( templatePart ) => {\n\t\t\t\treturn currentShownTPs.includes( templatePart ) ? (\n\t\t\t\t\t<TemplatePartItem\n\t\t\t\t\t\tkey={ templatePart.id }\n\t\t\t\t\t\ttemplatePart={ templatePart }\n\t\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\t\tonClose={ onClose }\n\t\t\t\t\t/>\n\t\t\t\t) : (\n\t\t\t\t\t<PreviewPlaceholder key={ templatePart.id } />\n\t\t\t\t);\n\t\t\t} ) }\n\t\t</PanelGroup>\n\t) );\n}\n\nfunction TemplatePartSearchResults( {\n\ttemplateParts,\n\tsetAttributes,\n\tfilterValue,\n\tonClose,\n} ) {\n\tconst filteredTPs = useMemo( () => {\n\t\t// Filter based on value.\n\t\t// Remove diacritics and convert to lowercase to normalize.\n\t\tconst normalizedFilterValue = deburr( filterValue ).toLowerCase();\n\t\tconst searchResults = templateParts.filter(\n\t\t\t( { slug, meta: { theme } } ) =>\n\t\t\t\tslug.toLowerCase().includes( normalizedFilterValue ) ||\n\t\t\t\t// Since diacritics can be used in theme names, remove them for the comparison.\n\t\t\t\tdeburr( theme ).toLowerCase().includes( normalizedFilterValue )\n\t\t);\n\t\t// Order based on value location.\n\t\tsearchResults.sort( ( a, b ) => {\n\t\t\t// First prioritize index found in slug.\n\t\t\tconst indexInSlugA = a.slug\n\t\t\t\t.toLowerCase()\n\t\t\t\t.indexOf( normalizedFilterValue );\n\t\t\tconst indexInSlugB = b.slug\n\t\t\t\t.toLowerCase()\n\t\t\t\t.indexOf( normalizedFilterValue );\n\t\t\tif ( indexInSlugA !== -1 && indexInSlugB !== -1 ) {\n\t\t\t\treturn indexInSlugA - indexInSlugB;\n\t\t\t} else if ( indexInSlugA !== -1 ) {\n\t\t\t\treturn -1;\n\t\t\t} else if ( indexInSlugB !== -1 ) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\t// Second prioritize index found in theme.\n\t\t\t// Since diacritics can be used in theme names, remove them for the comparison.\n\t\t\treturn (\n\t\t\t\tdeburr( a.meta.theme )\n\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t.indexOf( normalizedFilterValue ) -\n\t\t\t\tdeburr( b.meta.theme )\n\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t.indexOf( normalizedFilterValue )\n\t\t\t);\n\t\t} );\n\t\treturn searchResults;\n\t}, [ filterValue, templateParts ] );\n\n\tconst currentShownTPs = useAsyncList( filteredTPs );\n\n\treturn filteredTPs.map( ( templatePart ) => (\n\t\t<PanelGroup key={ templatePart.id } title={ templatePart.meta.theme }>\n\t\t\t{ currentShownTPs.includes( templatePart ) ? (\n\t\t\t\t<TemplatePartItem\n\t\t\t\t\tkey={ templatePart.id }\n\t\t\t\t\ttemplatePart={ templatePart }\n\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\tonClose={ onClose }\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<PreviewPlaceholder key={ templatePart.id } />\n\t\t\t) }\n\t\t</PanelGroup>\n\t) );\n}\n\nexport default function TemplateParts( {\n\tsetAttributes,\n\tfilterValue,\n\tonClose,\n} ) {\n\tconst templateParts = useSelect( ( select ) => {\n\t\tconst publishedTemplateParts = select( 'core' ).getEntityRecords(\n\t\t\t'postType',\n\t\t\t'wp_template_part',\n\t\t\t{\n\t\t\t\tstatus: [ 'publish' ],\n\t\t\t\tper_page: -1,\n\t\t\t}\n\t\t);\n\t\tconst currentTheme = select( 'core' ).getCurrentTheme()?.textdomain;\n\t\tconst themeTemplateParts = select( 'core' ).getEntityRecords(\n\t\t\t'postType',\n\t\t\t'wp_template_part',\n\t\t\t{\n\t\t\t\ttheme: currentTheme,\n\t\t\t\tstatus: [ 'publish', 'auto-draft' ],\n\t\t\t\tper_page: -1,\n\t\t\t}\n\t\t);\n\t\tconst combinedTemplateParts = [];\n\t\tif ( publishedTemplateParts ) {\n\t\t\tcombinedTemplateParts.push( ...publishedTemplateParts );\n\t\t}\n\t\tif ( themeTemplateParts ) {\n\t\t\tcombinedTemplateParts.push( ...themeTemplateParts );\n\t\t}\n\t\treturn uniq( combinedTemplateParts );\n\t}, [] );\n\n\tif ( ! templateParts || ! templateParts.length ) {\n\t\treturn null;\n\t}\n\n\tif ( filterValue ) {\n\t\treturn (\n\t\t\t<TemplatePartSearchResults\n\t\t\t\ttemplateParts={ templateParts }\n\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\tfilterValue={ filterValue }\n\t\t\t\tonClose={ onClose }\n\t\t\t/>\n\t\t);\n\t}\n\n\treturn (\n\t\t<TemplatePartsByTheme\n\t\t\ttemplateParts={ templateParts }\n\t\t\tsetAttributes={ setAttributes }\n\t\t\tonClose={ onClose }\n\t\t/>\n\t);\n}\n"]}