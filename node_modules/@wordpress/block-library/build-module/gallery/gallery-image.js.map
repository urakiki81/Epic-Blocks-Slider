{"version":3,"sources":["@wordpress/block-library/src/gallery/gallery-image.js"],"names":["classnames","get","omit","Component","Button","Spinner","ButtonGroup","__","BACKSPACE","DELETE","withSelect","withDispatch","RichText","MediaPlaceholder","isBlobURL","compose","closeSmall","chevronLeft","chevronRight","edit","image","imageIcon","pickRelevantMediaFiles","isTemporaryImage","id","url","GalleryImage","arguments","onSelectImage","bind","onSelectCaption","onRemoveImage","bindContainer","onEdit","onSelectImageFromLibrary","onSelectCustomURL","state","captionSelected","isEditing","ref","container","setState","props","isSelected","onSelect","event","document","activeElement","indexOf","keyCode","stopPropagation","preventDefault","onRemove","prevProps","__unstableMarkNextChangeAsNotPersistent","setAttributes","source_url","alt","alt_text","onDeselect","media","caption","sizeSlug","mediaAttributes","newURL","undefined","linkTo","link","isFirstItem","isLastItem","onMoveForward","onMoveBackward","ariaLabel","href","img","className","title","src","newCaption","select","ownProps","getMedia","parseInt","dispatch"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\nimport { get, omit } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { Button, Spinner, ButtonGroup } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { BACKSPACE, DELETE } from '@wordpress/keycodes';\nimport { withSelect, withDispatch } from '@wordpress/data';\nimport { RichText, MediaPlaceholder } from '@wordpress/block-editor';\nimport { isBlobURL } from '@wordpress/blob';\nimport { compose } from '@wordpress/compose';\nimport {\n\tcloseSmall,\n\tchevronLeft,\n\tchevronRight,\n\tedit,\n\timage as imageIcon,\n} from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport { pickRelevantMediaFiles } from './shared';\n\nconst isTemporaryImage = ( id, url ) => ! id && isBlobURL( url );\n\nclass GalleryImage extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onSelectImage = this.onSelectImage.bind( this );\n\t\tthis.onSelectCaption = this.onSelectCaption.bind( this );\n\t\tthis.onRemoveImage = this.onRemoveImage.bind( this );\n\t\tthis.bindContainer = this.bindContainer.bind( this );\n\t\tthis.onEdit = this.onEdit.bind( this );\n\t\tthis.onSelectImageFromLibrary = this.onSelectImageFromLibrary.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.onSelectCustomURL = this.onSelectCustomURL.bind( this );\n\t\tthis.state = {\n\t\t\tcaptionSelected: false,\n\t\t\tisEditing: false,\n\t\t};\n\t}\n\n\tbindContainer( ref ) {\n\t\tthis.container = ref;\n\t}\n\n\tonSelectCaption() {\n\t\tif ( ! this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: true,\n\t\t\t} );\n\t\t}\n\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\t}\n\n\tonSelectImage() {\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\n\t\tif ( this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonRemoveImage( event ) {\n\t\tif (\n\t\t\tthis.container === document.activeElement &&\n\t\t\tthis.props.isSelected &&\n\t\t\t[ BACKSPACE, DELETE ].indexOf( event.keyCode ) !== -1\n\t\t) {\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\t\t\tthis.props.onRemove();\n\t\t}\n\t}\n\n\tonEdit() {\n\t\tthis.setState( {\n\t\t\tisEditing: true,\n\t\t} );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst {\n\t\t\tisSelected,\n\t\t\timage,\n\t\t\turl,\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t} = this.props;\n\t\tif ( image && ! url ) {\n\t\t\t__unstableMarkNextChangeAsNotPersistent();\n\t\t\tthis.props.setAttributes( {\n\t\t\t\turl: image.source_url,\n\t\t\t\talt: image.alt_text,\n\t\t\t} );\n\t\t}\n\n\t\t// unselect the caption so when the user selects other image and comeback\n\t\t// the caption is not immediately selected\n\t\tif (\n\t\t\tthis.state.captionSelected &&\n\t\t\t! isSelected &&\n\t\t\tprevProps.isSelected\n\t\t) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tdeselectOnBlur() {\n\t\tthis.props.onDeselect();\n\t}\n\n\tonSelectImageFromLibrary( media ) {\n\t\tconst { setAttributes, id, url, alt, caption, sizeSlug } = this.props;\n\t\tif ( ! media || ! media.url ) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet mediaAttributes = pickRelevantMediaFiles( media, sizeSlug );\n\n\t\t// If the current image is temporary but an alt text was meanwhile\n\t\t// written by the user, make sure the text is not overwritten.\n\t\tif ( isTemporaryImage( id, url ) ) {\n\t\t\tif ( alt ) {\n\t\t\t\tmediaAttributes = omit( mediaAttributes, [ 'alt' ] );\n\t\t\t}\n\t\t}\n\n\t\t// If a caption text was meanwhile written by the user,\n\t\t// make sure the text is not overwritten by empty captions.\n\t\tif ( caption && ! get( mediaAttributes, [ 'caption' ] ) ) {\n\t\t\tmediaAttributes = omit( mediaAttributes, [ 'caption' ] );\n\t\t}\n\n\t\tsetAttributes( mediaAttributes );\n\t\tthis.setState( {\n\t\t\tisEditing: false,\n\t\t} );\n\t}\n\n\tonSelectCustomURL( newURL ) {\n\t\tconst { setAttributes, url } = this.props;\n\t\tif ( newURL !== url ) {\n\t\t\tsetAttributes( {\n\t\t\t\turl: newURL,\n\t\t\t\tid: undefined,\n\t\t\t} );\n\t\t\tthis.setState( {\n\t\t\t\tisEditing: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\turl,\n\t\t\talt,\n\t\t\tid,\n\t\t\tlinkTo,\n\t\t\tlink,\n\t\t\tisFirstItem,\n\t\t\tisLastItem,\n\t\t\tisSelected,\n\t\t\tcaption,\n\t\t\tonRemove,\n\t\t\tonMoveForward,\n\t\t\tonMoveBackward,\n\t\t\tsetAttributes,\n\t\t\t'aria-label': ariaLabel,\n\t\t} = this.props;\n\t\tconst { isEditing } = this.state;\n\n\t\tlet href;\n\n\t\tswitch ( linkTo ) {\n\t\t\tcase 'media':\n\t\t\t\thref = url;\n\t\t\t\tbreak;\n\t\t\tcase 'attachment':\n\t\t\t\thref = link;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconst img = (\n\t\t\t// Disable reason: Image itself is not meant to be interactive, but should\n\t\t\t// direct image selection and unfocus caption fields.\n\t\t\t/* eslint-disable jsx-a11y/no-noninteractive-element-interactions */\n\t\t\t<>\n\t\t\t\t<img\n\t\t\t\t\tsrc={ url }\n\t\t\t\t\talt={ alt }\n\t\t\t\t\tdata-id={ id }\n\t\t\t\t\tonClick={ this.onSelectImage }\n\t\t\t\t\tonFocus={ this.onSelectImage }\n\t\t\t\t\tonKeyDown={ this.onRemoveImage }\n\t\t\t\t\ttabIndex=\"0\"\n\t\t\t\t\taria-label={ ariaLabel }\n\t\t\t\t\tref={ this.bindContainer }\n\t\t\t\t/>\n\t\t\t\t{ isBlobURL( url ) && <Spinner /> }\n\t\t\t</>\n\t\t\t/* eslint-enable jsx-a11y/no-noninteractive-element-interactions */\n\t\t);\n\n\t\tconst className = classnames( {\n\t\t\t'is-selected': isSelected,\n\t\t\t'is-transient': isBlobURL( url ),\n\t\t} );\n\n\t\treturn (\n\t\t\t<figure className={ className }>\n\t\t\t\t{ ! isEditing && ( href ? <a href={ href }>{ img }</a> : img ) }\n\t\t\t\t{ isEditing && (\n\t\t\t\t\t<MediaPlaceholder\n\t\t\t\t\t\tlabels={ { title: __( 'Edit gallery image' ) } }\n\t\t\t\t\t\ticon={ imageIcon }\n\t\t\t\t\t\tonSelect={ this.onSelectImageFromLibrary }\n\t\t\t\t\t\tonSelectURL={ this.onSelectCustomURL }\n\t\t\t\t\t\taccept=\"image/*\"\n\t\t\t\t\t\tallowedTypes={ [ 'image' ] }\n\t\t\t\t\t\tvalue={ { id, src: url } }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\t<ButtonGroup className=\"block-library-gallery-item__inline-menu is-left\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\ticon={ chevronLeft }\n\t\t\t\t\t\tonClick={ isFirstItem ? undefined : onMoveBackward }\n\t\t\t\t\t\tlabel={ __( 'Move image backward' ) }\n\t\t\t\t\t\taria-disabled={ isFirstItem }\n\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\ticon={ chevronRight }\n\t\t\t\t\t\tonClick={ isLastItem ? undefined : onMoveForward }\n\t\t\t\t\t\tlabel={ __( 'Move image forward' ) }\n\t\t\t\t\t\taria-disabled={ isLastItem }\n\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t/>\n\t\t\t\t</ButtonGroup>\n\t\t\t\t<ButtonGroup className=\"block-library-gallery-item__inline-menu is-right\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\ticon={ edit }\n\t\t\t\t\t\tonClick={ this.onEdit }\n\t\t\t\t\t\tlabel={ __( 'Replace image' ) }\n\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t/>\n\t\t\t\t\t<Button\n\t\t\t\t\t\ticon={ closeSmall }\n\t\t\t\t\t\tonClick={ onRemove }\n\t\t\t\t\t\tlabel={ __( 'Remove image' ) }\n\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t/>\n\t\t\t\t</ButtonGroup>\n\t\t\t\t{ ! isEditing && ( isSelected || caption ) && (\n\t\t\t\t\t<RichText\n\t\t\t\t\t\ttagName=\"figcaption\"\n\t\t\t\t\t\tplaceholder={\n\t\t\t\t\t\t\tisSelected ? __( 'Write caption…' ) : null\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\tisSelected={ this.state.captionSelected }\n\t\t\t\t\t\tonChange={ ( newCaption ) =>\n\t\t\t\t\t\t\tsetAttributes( { caption: newCaption } )\n\t\t\t\t\t\t}\n\t\t\t\t\t\tunstableOnFocus={ this.onSelectCaption }\n\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</figure>\n\t\t);\n\t}\n}\n\nexport default compose( [\n\twithSelect( ( select, ownProps ) => {\n\t\tconst { getMedia } = select( 'core' );\n\t\tconst { id } = ownProps;\n\n\t\treturn {\n\t\t\timage: id ? getMedia( parseInt( id, 10 ) ) : null,\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { __unstableMarkNextChangeAsNotPersistent } = dispatch(\n\t\t\t'core/block-editor'\n\t\t);\n\t\treturn {\n\t\t\t__unstableMarkNextChangeAsNotPersistent,\n\t\t};\n\t} ),\n] )( GalleryImage );\n"]}