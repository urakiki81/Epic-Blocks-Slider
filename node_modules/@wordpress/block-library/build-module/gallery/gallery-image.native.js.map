{"version":3,"sources":["@wordpress/block-library/src/gallery/gallery-image.native.js"],"names":["StyleSheet","View","ScrollView","Text","TouchableWithoutFeedback","isEmpty","requestImageFailedRetryDialog","requestImageUploadCancelDialog","requestImageFullscreenPreview","Component","Icon","Image","__","sprintf","Caption","MediaUploadProgress","getProtocol","withPreferredColorScheme","arrowLeft","arrowRight","Button","style","compose","separatorStyle","separator","borderRightWidth","hairlineWidth","buttonStyle","button","aspectRatio","ICON_SIZE_ARROW","GalleryImage","arguments","onSelectImage","bind","onSelectCaption","onMediaPressed","onCaptionChange","onSelectMedia","updateMediaProgress","finishMediaUploadWithSuccess","finishMediaUploadWithFailure","renderContent","state","captionSelected","isUploadInProgress","didUploadFail","setState","props","isSelected","onSelect","id","url","isBlockSelected","onSelectBlock","media","setAttributes","caption","prevProps","image","source_url","alt","alt_text","payload","mediaServerId","mediaUrl","params","isFirstItem","isLastItem","onRemove","onMoveForward","onMoveBackward","ariaLabel","isCropped","getStylesFromColorScheme","isRTL","isUploadFailed","retryMessage","resizeMode","captionPlaceholderStyle","captionPlaceholder","captionPlaceholderDark","shouldShowCaptionEditable","shouldShowCaptionExpanded","captionContainerStyle","captionExpandedContainer","captionContainer","captionStyle","captionExpanded","mediaPickerOptions","destructiveButton","label","onPress","separated","value","height","uploadFailedContainer","uploadFailed","uploadFailedIcon","uploadFailedText","toolbarContainer","toolbar","moverButtonContainer","undefined","color","containerStyle","galleryImageContainer","galleryImageContainerDark","accessibilityLabelImageContainer"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tStyleSheet,\n\tView,\n\tScrollView,\n\tText,\n\tTouchableWithoutFeedback,\n} from 'react-native';\nimport { isEmpty } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport {\n\trequestImageFailedRetryDialog,\n\trequestImageUploadCancelDialog,\n\trequestImageFullscreenPreview,\n} from '@wordpress/react-native-bridge';\nimport { Component } from '@wordpress/element';\nimport { Icon, Image } from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { Caption, MediaUploadProgress } from '@wordpress/block-editor';\nimport { getProtocol } from '@wordpress/url';\nimport { withPreferredColorScheme } from '@wordpress/compose';\nimport { arrowLeft, arrowRight } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport Button from './gallery-button';\nimport style from './gallery-image-style.scss';\n\nconst { compose } = StyleSheet;\n\nconst separatorStyle = compose( style.separator, {\n\tborderRightWidth: StyleSheet.hairlineWidth,\n} );\nconst buttonStyle = compose( style.button, { aspectRatio: 1 } );\nconst ICON_SIZE_ARROW = 15;\n\nclass GalleryImage extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.onSelectImage = this.onSelectImage.bind( this );\n\t\tthis.onSelectCaption = this.onSelectCaption.bind( this );\n\t\tthis.onMediaPressed = this.onMediaPressed.bind( this );\n\t\tthis.onCaptionChange = this.onCaptionChange.bind( this );\n\t\tthis.onSelectMedia = this.onSelectMedia.bind( this );\n\n\t\tthis.updateMediaProgress = this.updateMediaProgress.bind( this );\n\t\tthis.finishMediaUploadWithSuccess = this.finishMediaUploadWithSuccess.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.finishMediaUploadWithFailure = this.finishMediaUploadWithFailure.bind(\n\t\t\tthis\n\t\t);\n\t\tthis.renderContent = this.renderContent.bind( this );\n\n\t\tthis.state = {\n\t\t\tcaptionSelected: false,\n\t\t\tisUploadInProgress: false,\n\t\t\tdidUploadFail: false,\n\t\t};\n\t}\n\n\tonSelectCaption() {\n\t\tif ( ! this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: true,\n\t\t\t} );\n\t\t}\n\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\t}\n\n\tonMediaPressed() {\n\t\tconst { id, url, isSelected } = this.props;\n\t\tconst {\n\t\t\tcaptionSelected,\n\t\t\tisUploadInProgress,\n\t\t\tdidUploadFail,\n\t\t} = this.state;\n\n\t\tthis.onSelectImage();\n\n\t\tif ( isUploadInProgress ) {\n\t\t\trequestImageUploadCancelDialog( id );\n\t\t} else if (\n\t\t\tdidUploadFail ||\n\t\t\t( id && getProtocol( url ) === 'file:' )\n\t\t) {\n\t\t\trequestImageFailedRetryDialog( id );\n\t\t} else if ( isSelected && ! captionSelected ) {\n\t\t\trequestImageFullscreenPreview( url );\n\t\t}\n\t}\n\n\tonSelectImage() {\n\t\tif ( ! this.props.isBlockSelected ) {\n\t\t\tthis.props.onSelectBlock();\n\t\t}\n\n\t\tif ( ! this.props.isSelected ) {\n\t\t\tthis.props.onSelect();\n\t\t}\n\n\t\tif ( this.state.captionSelected ) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tonSelectMedia( media ) {\n\t\tconst { setAttributes } = this.props;\n\t\tsetAttributes( media );\n\t}\n\n\tonCaptionChange( caption ) {\n\t\tconst { setAttributes } = this.props;\n\t\tsetAttributes( { caption } );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tconst { isSelected, image, url } = this.props;\n\t\tif ( image && ! url ) {\n\t\t\tthis.props.setAttributes( {\n\t\t\t\turl: image.source_url,\n\t\t\t\talt: image.alt_text,\n\t\t\t} );\n\t\t}\n\n\t\t// unselect the caption so when the user selects other image and comeback\n\t\t// the caption is not immediately selected\n\t\tif (\n\t\t\tthis.state.captionSelected &&\n\t\t\t! isSelected &&\n\t\t\tprevProps.isSelected\n\t\t) {\n\t\t\tthis.setState( {\n\t\t\t\tcaptionSelected: false,\n\t\t\t} );\n\t\t}\n\t}\n\n\tupdateMediaProgress() {\n\t\tif ( ! this.state.isUploadInProgress ) {\n\t\t\tthis.setState( { isUploadInProgress: true } );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tthis.setState( {\n\t\t\tisUploadInProgress: false,\n\t\t\tdidUploadFail: false,\n\t\t} );\n\n\t\tthis.props.setAttributes( {\n\t\t\tid: payload.mediaServerId,\n\t\t\turl: payload.mediaUrl,\n\t\t} );\n\t}\n\n\tfinishMediaUploadWithFailure() {\n\t\tthis.setState( {\n\t\t\tisUploadInProgress: false,\n\t\t\tdidUploadFail: true,\n\t\t} );\n\t}\n\n\trenderContent( params ) {\n\t\tconst {\n\t\t\turl,\n\t\t\tisFirstItem,\n\t\t\tisLastItem,\n\t\t\tisSelected,\n\t\t\tcaption,\n\t\t\tonRemove,\n\t\t\tonMoveForward,\n\t\t\tonMoveBackward,\n\t\t\t'aria-label': ariaLabel,\n\t\t\tisCropped,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tisRTL,\n\t\t} = this.props;\n\n\t\tconst { isUploadInProgress, captionSelected } = this.state;\n\t\tconst { isUploadFailed, retryMessage } = params;\n\t\tconst resizeMode = isCropped ? 'cover' : 'contain';\n\n\t\tconst captionPlaceholderStyle = getStylesFromColorScheme(\n\t\t\tstyle.captionPlaceholder,\n\t\t\tstyle.captionPlaceholderDark\n\t\t);\n\n\t\tconst shouldShowCaptionEditable = ! isUploadFailed && isSelected;\n\t\tconst shouldShowCaptionExpanded =\n\t\t\t! isUploadFailed && ! isSelected && !! caption;\n\n\t\tconst captionContainerStyle = shouldShowCaptionExpanded\n\t\t\t? style.captionExpandedContainer\n\t\t\t: style.captionContainer;\n\n\t\tconst captionStyle = shouldShowCaptionExpanded\n\t\t\t? style.captionExpanded\n\t\t\t: style.caption;\n\n\t\tconst mediaPickerOptions = [\n\t\t\t{\n\t\t\t\tdestructiveButton: true,\n\t\t\t\tid: 'removeImage',\n\t\t\t\tlabel: __( 'Remove' ),\n\t\t\t\tonPress: onRemove,\n\t\t\t\tseparated: true,\n\t\t\t\tvalue: 'removeImage',\n\t\t\t},\n\t\t];\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<Image\n\t\t\t\t\talt={ ariaLabel }\n\t\t\t\t\theight={ style.image.height }\n\t\t\t\t\tisSelected={ isSelected }\n\t\t\t\t\tisUploadFailed={ isUploadFailed }\n\t\t\t\t\tisUploadInProgress={ isUploadInProgress }\n\t\t\t\t\tmediaPickerOptions={ mediaPickerOptions }\n\t\t\t\t\tonSelectMediaUploadOption={ this.onSelectMedia }\n\t\t\t\t\tresizeMode={ resizeMode }\n\t\t\t\t\turl={ url }\n\t\t\t\t/>\n\n\t\t\t\t{ isUploadFailed && (\n\t\t\t\t\t<View style={ style.uploadFailedContainer }>\n\t\t\t\t\t\t<View style={ style.uploadFailed }>\n\t\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\t\ticon={ 'warning' }\n\t\t\t\t\t\t\t\t{ ...style.uploadFailedIcon }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</View>\n\t\t\t\t\t\t<Text style={ style.uploadFailedText }>\n\t\t\t\t\t\t\t{ retryMessage }\n\t\t\t\t\t\t</Text>\n\t\t\t\t\t</View>\n\t\t\t\t) }\n\n\t\t\t\t{ ! isUploadInProgress && isSelected && (\n\t\t\t\t\t<View style={ style.toolbarContainer }>\n\t\t\t\t\t\t<View style={ style.toolbar }>\n\t\t\t\t\t\t\t<View style={ style.moverButtonContainer }>\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tstyle={ buttonStyle }\n\t\t\t\t\t\t\t\t\ticon={ isRTL ? arrowRight : arrowLeft }\n\t\t\t\t\t\t\t\t\ticonSize={ ICON_SIZE_ARROW }\n\t\t\t\t\t\t\t\t\tonClick={\n\t\t\t\t\t\t\t\t\t\tisFirstItem ? undefined : onMoveBackward\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\taccessibilityLabel={ __(\n\t\t\t\t\t\t\t\t\t\t'Move Image Backward'\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\taria-disabled={ isFirstItem }\n\t\t\t\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<View style={ separatorStyle } />\n\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\tstyle={ buttonStyle }\n\t\t\t\t\t\t\t\t\ticon={ isRTL ? arrowLeft : arrowRight }\n\t\t\t\t\t\t\t\t\ticonSize={ ICON_SIZE_ARROW }\n\t\t\t\t\t\t\t\t\tonClick={\n\t\t\t\t\t\t\t\t\t\tisLastItem ? undefined : onMoveForward\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\taccessibilityLabel={ __(\n\t\t\t\t\t\t\t\t\t\t'Move Image Forward'\n\t\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\t\taria-disabled={ isLastItem }\n\t\t\t\t\t\t\t\t\tdisabled={ ! isSelected }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</View>\n\t\t\t\t\t\t</View>\n\t\t\t\t\t</View>\n\t\t\t\t) }\n\n\t\t\t\t{ ! isUploadInProgress &&\n\t\t\t\t\t( shouldShowCaptionEditable ||\n\t\t\t\t\t\tshouldShowCaptionExpanded ) && (\n\t\t\t\t\t\t<View style={ captionContainerStyle }>\n\t\t\t\t\t\t\t<ScrollView\n\t\t\t\t\t\t\t\tnestedScrollEnabled\n\t\t\t\t\t\t\t\tkeyboardShouldPersistTaps=\"handled\"\n\t\t\t\t\t\t\t\tbounces={ false }\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Caption\n\t\t\t\t\t\t\t\t\tinlineToolbar\n\t\t\t\t\t\t\t\t\tisSelected={ captionSelected }\n\t\t\t\t\t\t\t\t\tonChange={ this.onCaptionChange }\n\t\t\t\t\t\t\t\t\tonFocus={ this.onSelectCaption }\n\t\t\t\t\t\t\t\t\tplaceholder={\n\t\t\t\t\t\t\t\t\t\tisSelected\n\t\t\t\t\t\t\t\t\t\t\t? __( 'Write caption…' )\n\t\t\t\t\t\t\t\t\t\t\t: null\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tplaceholderTextColor={\n\t\t\t\t\t\t\t\t\t\tcaptionPlaceholderStyle.color\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tstyle={ captionStyle }\n\t\t\t\t\t\t\t\t\tvalue={ caption }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</ScrollView>\n\t\t\t\t\t\t</View>\n\t\t\t\t\t) }\n\t\t\t</>\n\t\t);\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\tid,\n\t\t\tonRemove,\n\t\t\tgetStylesFromColorScheme,\n\t\t\tisSelected,\n\t\t} = this.props;\n\n\t\tconst containerStyle = getStylesFromColorScheme(\n\t\t\tstyle.galleryImageContainer,\n\t\t\tstyle.galleryImageContainerDark\n\t\t);\n\n\t\treturn (\n\t\t\t<TouchableWithoutFeedback\n\t\t\t\tonPress={ this.onMediaPressed }\n\t\t\t\taccessible={ ! isSelected } // We need only child views to be accessible after the selection\n\t\t\t\taccessibilityLabel={ this.accessibilityLabelImageContainer() } // if we don't set this explicitly it reads system provided accessibilityLabels of all child components and those include pretty technical words which don't make sense\n\t\t\t\taccessibilityRole={ 'imagebutton' } // this makes VoiceOver to read a description of image provided by system on iOS and lets user know this is a button which conveys the message of tappablity\n\t\t\t>\n\t\t\t\t<View style={ containerStyle }>\n\t\t\t\t\t<MediaUploadProgress\n\t\t\t\t\t\tmediaId={ id }\n\t\t\t\t\t\tonUpdateMediaProgress={ this.updateMediaProgress }\n\t\t\t\t\t\tonFinishMediaUploadWithSuccess={\n\t\t\t\t\t\t\tthis.finishMediaUploadWithSuccess\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonFinishMediaUploadWithFailure={\n\t\t\t\t\t\t\tthis.finishMediaUploadWithFailure\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonMediaUploadStateReset={ onRemove }\n\t\t\t\t\t\trenderContent={ this.renderContent }\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t</TouchableWithoutFeedback>\n\t\t);\n\t}\n\n\taccessibilityLabelImageContainer() {\n\t\tconst { caption, 'aria-label': ariaLabel } = this.props;\n\n\t\treturn isEmpty( caption )\n\t\t\t? ariaLabel\n\t\t\t: ariaLabel +\n\t\t\t\t\t'. ' +\n\t\t\t\t\tsprintf(\n\t\t\t\t\t\t/* translators: accessibility text. %s: image caption. */\n\t\t\t\t\t\t__( 'Image caption. %s' ),\n\t\t\t\t\t\tcaption\n\t\t\t\t\t);\n\t}\n}\n\nexport default withPreferredColorScheme( GalleryImage );\n"]}