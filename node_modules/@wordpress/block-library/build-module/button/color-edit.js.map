{"version":3,"sources":["@wordpress/block-library/src/button/color-edit.js"],"names":["pickBy","isEqual","isObject","identity","mapValues","__","useState","useEffect","useRef","Platform","useSelect","getColorObjectByColorValue","getColorObjectByAttributeValues","getGradientValueBySlug","getGradientSlugByValue","__experimentalPanelColorGradientSettings","PanelColorGradientSettings","ContrastChecker","InspectorControls","isWebPlatform","OS","getBlockDOMNode","clientId","document","getElementById","cleanEmptyObject","object","cleanedNestedObjects","undefined","ColorPanel","settings","enableContrastChecking","window","getComputedStyle","Node","detectedBackgroundColor","setDetectedBackgroundColor","detectedColor","setDetectedColor","title","colorsDetectionElement","color","backgroundColorNode","backgroundColor","parentNode","nodeType","ELEMENT_NODE","ColorEdit","props","attributes","select","getSettings","colors","gradients","localAttributes","current","style","textColor","gradient","gradientValue","onChangeColor","name","value","colorObject","attributeName","newStyle","slug","newNamedColor","newAttributes","setAttributes","onChangeGradient","label","onColorChange","colorValue","text","background","onGradientChange"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { pickBy, isEqual, isObject, identity, mapValues } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useState, useEffect, useRef, Platform } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport {\n\tgetColorObjectByColorValue,\n\tgetColorObjectByAttributeValues,\n\tgetGradientValueBySlug,\n\tgetGradientSlugByValue,\n\t__experimentalPanelColorGradientSettings as PanelColorGradientSettings,\n\tContrastChecker,\n\tInspectorControls,\n} from '@wordpress/block-editor';\n\nconst isWebPlatform = Platform.OS === 'web';\n\n// The code in this file is copied entirely from the \"color\" and \"style\" support flags\n// The flag can't be used at the moment because of the extra wrapper around\n// the button block markup.\n\nfunction getBlockDOMNode( clientId ) {\n\treturn document.getElementById( 'block-' + clientId );\n}\n\n/**\n * Removed undefined values from nested object.\n *\n * @param {*} object\n * @return {*} Object cleaned from undefined values\n */\nconst cleanEmptyObject = ( object ) => {\n\tif ( ! isObject( object ) ) {\n\t\treturn object;\n\t}\n\tconst cleanedNestedObjects = pickBy(\n\t\tmapValues( object, cleanEmptyObject ),\n\t\tidentity\n\t);\n\treturn isEqual( cleanedNestedObjects, {} )\n\t\t? undefined\n\t\t: cleanedNestedObjects;\n};\n\nfunction ColorPanel( { settings, clientId, enableContrastChecking = true } ) {\n\tconst { getComputedStyle, Node } = window;\n\n\tconst [ detectedBackgroundColor, setDetectedBackgroundColor ] = useState();\n\tconst [ detectedColor, setDetectedColor ] = useState();\n\n\tconst title = isWebPlatform\n\t\t? __( 'Color settings' )\n\t\t: __( 'Color Settings' );\n\n\tuseEffect( () => {\n\t\tif ( isWebPlatform && ! enableContrastChecking ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst colorsDetectionElement = getBlockDOMNode( clientId );\n\t\tif ( ! colorsDetectionElement ) {\n\t\t\treturn;\n\t\t}\n\t\tsetDetectedColor( getComputedStyle( colorsDetectionElement ).color );\n\n\t\tlet backgroundColorNode = colorsDetectionElement;\n\t\tlet backgroundColor = getComputedStyle( backgroundColorNode )\n\t\t\t.backgroundColor;\n\t\twhile (\n\t\t\tbackgroundColor === 'rgba(0, 0, 0, 0)' &&\n\t\t\tbackgroundColorNode.parentNode &&\n\t\t\tbackgroundColorNode.parentNode.nodeType === Node.ELEMENT_NODE\n\t\t) {\n\t\t\tbackgroundColorNode = backgroundColorNode.parentNode;\n\t\t\tbackgroundColor = getComputedStyle( backgroundColorNode )\n\t\t\t\t.backgroundColor;\n\t\t}\n\n\t\tsetDetectedBackgroundColor( backgroundColor );\n\t} );\n\n\treturn (\n\t\t<InspectorControls>\n\t\t\t<PanelColorGradientSettings\n\t\t\t\ttitle={ title }\n\t\t\t\tinitialOpen={ false }\n\t\t\t\tsettings={ settings }\n\t\t\t>\n\t\t\t\t{ isWebPlatform && enableContrastChecking && (\n\t\t\t\t\t<ContrastChecker\n\t\t\t\t\t\tbackgroundColor={ detectedBackgroundColor }\n\t\t\t\t\t\ttextColor={ detectedColor }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</PanelColorGradientSettings>\n\t\t</InspectorControls>\n\t);\n}\n\n/**\n * Inspector control panel containing the color related configuration\n *\n * @param {Object} props\n *\n * @return {WPElement} Color edit element.\n */\nfunction ColorEdit( props ) {\n\tconst { attributes } = props;\n\tconst { colors, gradients } = useSelect( ( select ) => {\n\t\treturn select( 'core/block-editor' ).getSettings();\n\t}, [] );\n\t// Shouldn't be needed but right now the ColorGradientsPanel\n\t// can trigger both onChangeColor and onChangeBackground\n\t// synchronously causing our two callbacks to override changes\n\t// from each other.\n\tconst localAttributes = useRef( attributes );\n\tuseEffect( () => {\n\t\tlocalAttributes.current = attributes;\n\t}, [ attributes ] );\n\n\tconst { style, textColor, backgroundColor, gradient } = attributes;\n\tlet gradientValue;\n\tif ( gradient ) {\n\t\tgradientValue = getGradientValueBySlug( gradients, gradient );\n\t} else {\n\t\tgradientValue = style?.color?.gradient;\n\t}\n\n\tconst onChangeColor = ( name ) => ( value ) => {\n\t\tconst colorObject = getColorObjectByColorValue( colors, value );\n\t\tconst attributeName = name + 'Color';\n\t\tconst newStyle = {\n\t\t\t...localAttributes.current.style,\n\t\t\tcolor: {\n\t\t\t\t...localAttributes.current?.style?.color,\n\t\t\t\t[ name ]: colorObject?.slug ? undefined : value,\n\t\t\t},\n\t\t};\n\n\t\tconst newNamedColor = colorObject?.slug ? colorObject.slug : undefined;\n\t\tconst newAttributes = {\n\t\t\tstyle: cleanEmptyObject( newStyle ),\n\t\t\t[ attributeName ]: newNamedColor,\n\t\t};\n\n\t\tprops.setAttributes( newAttributes );\n\t\tlocalAttributes.current = {\n\t\t\t...localAttributes.current,\n\t\t\t...newAttributes,\n\t\t};\n\t};\n\n\tconst onChangeGradient = ( value ) => {\n\t\tconst slug = getGradientSlugByValue( gradients, value );\n\t\tlet newAttributes;\n\t\tif ( slug ) {\n\t\t\tconst newStyle = {\n\t\t\t\t...localAttributes.current?.style,\n\t\t\t\tcolor: {\n\t\t\t\t\t...localAttributes.current?.style?.color,\n\t\t\t\t\tgradient: undefined,\n\t\t\t\t},\n\t\t\t};\n\t\t\tnewAttributes = {\n\t\t\t\tstyle: cleanEmptyObject( newStyle ),\n\t\t\t\tgradient: slug,\n\t\t\t};\n\t\t} else {\n\t\t\tconst newStyle = {\n\t\t\t\t...localAttributes.current?.style,\n\t\t\t\tcolor: {\n\t\t\t\t\t...localAttributes.current?.style?.color,\n\t\t\t\t\tgradient: value,\n\t\t\t\t},\n\t\t\t};\n\t\t\tnewAttributes = {\n\t\t\t\tstyle: cleanEmptyObject( newStyle ),\n\t\t\t\tgradient: undefined,\n\t\t\t};\n\t\t}\n\t\tprops.setAttributes( newAttributes );\n\t\tlocalAttributes.current = {\n\t\t\t...localAttributes.current,\n\t\t\t...newAttributes,\n\t\t};\n\t};\n\n\treturn (\n\t\t<ColorPanel\n\t\t\tenableContrastChecking={ ! gradient && ! style?.color?.gradient }\n\t\t\tclientId={ props.clientId }\n\t\t\tsettings={ [\n\t\t\t\t{\n\t\t\t\t\tlabel: __( 'Text Color' ),\n\t\t\t\t\tonColorChange: onChangeColor( 'text' ),\n\t\t\t\t\tcolorValue: getColorObjectByAttributeValues(\n\t\t\t\t\t\tcolors,\n\t\t\t\t\t\ttextColor,\n\t\t\t\t\t\tstyle?.color?.text\n\t\t\t\t\t).color,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: __( 'Background Color' ),\n\t\t\t\t\tonColorChange: onChangeColor( 'background' ),\n\t\t\t\t\tcolorValue: getColorObjectByAttributeValues(\n\t\t\t\t\t\tcolors,\n\t\t\t\t\t\tbackgroundColor,\n\t\t\t\t\t\tstyle?.color?.background\n\t\t\t\t\t).color,\n\t\t\t\t\tgradientValue,\n\t\t\t\t\tonGradientChange: onChangeGradient,\n\t\t\t\t},\n\t\t\t] }\n\t\t/>\n\t);\n}\n\nexport default ColorEdit;\n"]}