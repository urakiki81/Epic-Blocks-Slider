{"version":3,"sources":["@wordpress/block-library/src/query/edit/query-toolbar.js"],"names":["QueryToolbar","query","setQuery","select","getEntityRecords","termsQuery","per_page","MAX_FETCHED_TERMS","_categories","_tags","categories","tags","search","querySearch","setQuerySearch","onChangeDebounced","cancel","onTermsChange","terms","queryProperty","newTermValues","termIds","reduce","accumulator","termValue","termId","id","mapByName","push","onCategoriesChange","onTagsChange","onToggle","postList","perPage","value","pages","offset","categoryIds","map","categoryId","mapById","name","names","tagIds","tagId"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { debounce } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { useEffect, useState, useCallback } from '@wordpress/element';\nimport {\n\tToolbar,\n\tDropdown,\n\tToolbarButton,\n\tRangeControl,\n\tTextControl,\n\tFormTokenField,\n} from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { postList } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport { getTermsInfo } from '../utils';\nimport { MAX_FETCHED_TERMS } from '../constants';\n\nexport default function QueryToolbar( { query, setQuery } ) {\n\tconst { categories, tags } = useSelect( ( select ) => {\n\t\tconst { getEntityRecords } = select( 'core' );\n\t\tconst termsQuery = { per_page: MAX_FETCHED_TERMS };\n\t\tconst _categories = getEntityRecords(\n\t\t\t'taxonomy',\n\t\t\t'category',\n\t\t\ttermsQuery\n\t\t);\n\t\tconst _tags = getEntityRecords( 'taxonomy', 'post_tag', termsQuery );\n\t\treturn {\n\t\t\tcategories: getTermsInfo( _categories ),\n\t\t\ttags: getTermsInfo( _tags ),\n\t\t};\n\t}, [] );\n\tconst [ querySearch, setQuerySearch ] = useState( query.search );\n\tconst onChangeDebounced = useCallback(\n\t\tdebounce( () => setQuery( { search: querySearch } ), 250 ),\n\t\t[ querySearch ]\n\t);\n\tuseEffect( () => {\n\t\tonChangeDebounced();\n\t\treturn onChangeDebounced.cancel;\n\t}, [ querySearch, onChangeDebounced ] );\n\n\t// Handles categories and tags changes.\n\tconst onTermsChange = ( terms, queryProperty ) => ( newTermValues ) => {\n\t\tconst termIds = newTermValues.reduce( ( accumulator, termValue ) => {\n\t\t\tconst termId = termValue?.id || terms.mapByName[ termValue ]?.id;\n\t\t\tif ( termId ) accumulator.push( termId );\n\t\t\treturn accumulator;\n\t\t}, [] );\n\t\tsetQuery( { [ queryProperty ]: termIds } );\n\t};\n\tconst onCategoriesChange = onTermsChange( categories, 'categoryIds' );\n\tconst onTagsChange = onTermsChange( tags, 'tagIds' );\n\n\treturn (\n\t\t<Toolbar>\n\t\t\t<Dropdown\n\t\t\t\trenderToggle={ ( { onToggle } ) => (\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ticon={ postList }\n\t\t\t\t\t\tlabel={ __( 'Query' ) }\n\t\t\t\t\t\tonClick={ onToggle }\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t\trenderContent={ () => (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<RangeControl\n\t\t\t\t\t\t\tlabel={ __( 'Posts per Page' ) }\n\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\tallowReset\n\t\t\t\t\t\t\tvalue={ query.perPage }\n\t\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\t\tsetQuery( { perPage: value ?? -1 } )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<RangeControl\n\t\t\t\t\t\t\tlabel={ __( 'Number of Pages' ) }\n\t\t\t\t\t\t\tmin={ 1 }\n\t\t\t\t\t\t\tallowReset\n\t\t\t\t\t\t\tvalue={ query.pages }\n\t\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\t\tsetQuery( { pages: value ?? -1 } )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<RangeControl\n\t\t\t\t\t\t\tlabel={ __( 'Offset' ) }\n\t\t\t\t\t\t\tmin={ 0 }\n\t\t\t\t\t\t\tallowReset\n\t\t\t\t\t\t\tvalue={ query.offset }\n\t\t\t\t\t\t\tonChange={ ( value ) =>\n\t\t\t\t\t\t\t\tsetQuery( { offset: value ?? 0 } )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{ categories?.terms && (\n\t\t\t\t\t\t\t<FormTokenField\n\t\t\t\t\t\t\t\tlabel={ __( 'Categories' ) }\n\t\t\t\t\t\t\t\tvalue={ query.categoryIds.map(\n\t\t\t\t\t\t\t\t\t( categoryId ) => ( {\n\t\t\t\t\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\t\t\t\t\tvalue:\n\t\t\t\t\t\t\t\t\t\t\tcategories.mapById[ categoryId ]\n\t\t\t\t\t\t\t\t\t\t\t\t.name,\n\t\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\tsuggestions={ categories.names }\n\t\t\t\t\t\t\t\tonChange={ onCategoriesChange }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t{ tags?.terms && (\n\t\t\t\t\t\t\t<FormTokenField\n\t\t\t\t\t\t\t\tlabel={ __( 'Tags' ) }\n\t\t\t\t\t\t\t\tvalue={ ( query.tagIds || [] ).map(\n\t\t\t\t\t\t\t\t\t( tagId ) => ( {\n\t\t\t\t\t\t\t\t\t\tid: tagId,\n\t\t\t\t\t\t\t\t\t\tvalue: tags.mapById[ tagId ].name,\n\t\t\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t\tsuggestions={ tags.names }\n\t\t\t\t\t\t\t\tonChange={ onTagsChange }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t\t<TextControl\n\t\t\t\t\t\t\tlabel={ __( 'Search' ) }\n\t\t\t\t\t\t\tvalue={ querySearch }\n\t\t\t\t\t\t\tonChange={ ( value ) => setQuerySearch( value ) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</>\n\t\t\t\t) }\n\t\t\t/>\n\t\t</Toolbar>\n\t);\n}\n"]}