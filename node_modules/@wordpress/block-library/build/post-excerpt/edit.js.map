{"version":3,"sources":["@wordpress/block-library/src/post-excerpt/edit.js"],"names":["usePostContentExcerpt","wordCount","postId","postType","content","rawPostContent","raw","excerptElement","document","createElement","innerHTML","excerpt","textContent","innerText","trim","split","join","PostExcerptEditor","attributes","textAlign","moreText","showMoreOnNewLine","setAttributes","isSelected","context","setExcerpt","postContentExcerpt","newAlign","newExcerptLength","newShowMoreOnNewLine","newMoreText","PostExcerptEdit"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { useEntityProp } from '@wordpress/core-data';\nimport { useMemo } from '@wordpress/element';\nimport {\n\tAlignmentToolbar,\n\tBlockControls,\n\tInspectorControls,\n\tRichText,\n\tWarning,\n\t__experimentalBlock as Block,\n} from '@wordpress/block-editor';\nimport { PanelBody, RangeControl, ToggleControl } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\n\nfunction usePostContentExcerpt( wordCount, postId, postType ) {\n\t// Don't destrcuture items from content here, it can be undefined.\n\tconst [ , , content ] = useEntityProp(\n\t\t'postType',\n\t\tpostType,\n\t\t'content',\n\t\tpostId\n\t);\n\tconst rawPostContent = content?.raw;\n\treturn useMemo( () => {\n\t\tif ( ! rawPostContent ) {\n\t\t\treturn '';\n\t\t}\n\t\tconst excerptElement = document.createElement( 'div' );\n\t\texcerptElement.innerHTML = rawPostContent;\n\t\tconst excerpt =\n\t\t\texcerptElement.textContent || excerptElement.innerText || '';\n\t\treturn excerpt.trim().split( ' ', wordCount ).join( ' ' );\n\t}, [ rawPostContent, wordCount ] );\n}\n\nfunction PostExcerptEditor( {\n\tattributes: { textAlign, wordCount, moreText, showMoreOnNewLine },\n\tsetAttributes,\n\tisSelected,\n\tcontext: { postId, postType },\n} ) {\n\tconst [ excerpt, setExcerpt ] = useEntityProp(\n\t\t'postType',\n\t\tpostType,\n\t\t'excerpt',\n\t\tpostId\n\t);\n\tconst postContentExcerpt = usePostContentExcerpt(\n\t\twordCount,\n\t\tpostId,\n\t\tpostType\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<BlockControls>\n\t\t\t\t<AlignmentToolbar\n\t\t\t\t\tvalue={ textAlign }\n\t\t\t\t\tonChange={ ( newAlign ) =>\n\t\t\t\t\t\tsetAttributes( { textAlign: newAlign } )\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t</BlockControls>\n\t\t\t<InspectorControls>\n\t\t\t\t<PanelBody title={ __( 'Post Excerpt Settings' ) }>\n\t\t\t\t\t{ ! excerpt && (\n\t\t\t\t\t\t<RangeControl\n\t\t\t\t\t\t\tlabel={ __( 'Max words' ) }\n\t\t\t\t\t\t\tvalue={ wordCount }\n\t\t\t\t\t\t\tonChange={ ( newExcerptLength ) =>\n\t\t\t\t\t\t\t\tsetAttributes( { wordCount: newExcerptLength } )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tmin={ 10 }\n\t\t\t\t\t\t\tmax={ 100 }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t<ToggleControl\n\t\t\t\t\t\tlabel={ __( 'Show link on new line' ) }\n\t\t\t\t\t\tchecked={ showMoreOnNewLine }\n\t\t\t\t\t\tonChange={ ( newShowMoreOnNewLine ) =>\n\t\t\t\t\t\t\tsetAttributes( {\n\t\t\t\t\t\t\t\tshowMoreOnNewLine: newShowMoreOnNewLine,\n\t\t\t\t\t\t\t} )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t</PanelBody>\n\t\t\t</InspectorControls>\n\t\t\t<Block.div\n\t\t\t\tclassName={ classnames( {\n\t\t\t\t\t[ `has-text-align-${ textAlign }` ]: textAlign,\n\t\t\t\t} ) }\n\t\t\t>\n\t\t\t\t<RichText\n\t\t\t\t\tclassName={\n\t\t\t\t\t\t! showMoreOnNewLine &&\n\t\t\t\t\t\t'wp-block-post-excerpt__excerpt is-inline'\n\t\t\t\t\t}\n\t\t\t\t\tplaceholder={ postContentExcerpt }\n\t\t\t\t\tvalue={\n\t\t\t\t\t\texcerpt ||\n\t\t\t\t\t\t( isSelected\n\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t: postContentExcerpt ||\n\t\t\t\t\t\t\t  __( 'No post excerpt found' ) )\n\t\t\t\t\t}\n\t\t\t\t\tonChange={ setExcerpt }\n\t\t\t\t\tkeepPlaceholderOnFocus\n\t\t\t\t/>\n\t\t\t\t{ ! showMoreOnNewLine && ' ' }\n\t\t\t\t{ showMoreOnNewLine ? (\n\t\t\t\t\t<p className=\"wp-block-post-excerpt__more-text\">\n\t\t\t\t\t\t<RichText\n\t\t\t\t\t\t\ttagName=\"a\"\n\t\t\t\t\t\t\tplaceholder={ __( 'Read more…' ) }\n\t\t\t\t\t\t\tvalue={ moreText }\n\t\t\t\t\t\t\tonChange={ ( newMoreText ) =>\n\t\t\t\t\t\t\t\tsetAttributes( { moreText: newMoreText } )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</p>\n\t\t\t\t) : (\n\t\t\t\t\t<RichText\n\t\t\t\t\t\ttagName=\"a\"\n\t\t\t\t\t\tplaceholder={ __( 'Read more…' ) }\n\t\t\t\t\t\tvalue={ moreText }\n\t\t\t\t\t\tonChange={ ( newMoreText ) =>\n\t\t\t\t\t\t\tsetAttributes( { moreText: newMoreText } )\n\t\t\t\t\t\t}\n\t\t\t\t\t/>\n\t\t\t\t) }\n\t\t\t</Block.div>\n\t\t</>\n\t);\n}\n\nexport default function PostExcerptEdit( {\n\tattributes,\n\tsetAttributes,\n\tisSelected,\n\tcontext,\n} ) {\n\tif ( ! context.postType || ! context.postId ) {\n\t\treturn (\n\t\t\t<Warning>{ __( 'Post excerpt block: no post found.' ) }</Warning>\n\t\t);\n\t}\n\treturn (\n\t\t<PostExcerptEditor\n\t\t\tattributes={ attributes }\n\t\t\tsetAttributes={ setAttributes }\n\t\t\tisSelected={ isSelected }\n\t\t\tcontext={ context }\n\t\t/>\n\t);\n}\n"]}