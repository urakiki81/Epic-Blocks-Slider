{"version":3,"sources":["@wordpress/block-library/src/image/image-editor.js"],"names":["MIN_ZOOM","MAX_ZOOM","POPOVER_PROPS","position","isAlternate","AspectGroup","aspectRatios","isDisabled","label","onClick","value","map","title","aspect","check","undefined","AspectMenu","defaultValue","aspectRatioIcon","onClose","ImageEditor","id","url","setAttributes","naturalWidth","naturalHeight","width","height","clientWidth","setIsEditingImage","createErrorNotice","inProgress","setIsProgress","crop","setCrop","x","y","setPosition","zoom","setZoom","setAspect","rotation","setRotation","editedUrl","setEditedUrl","editedWidth","editedHeight","naturalAspectRatio","apply","attrs","src","path","method","data","then","response","source_url","catch","error","message","type","finally","rotate","angle","editImage","event","canvas","document","createElement","translateX","translateY","target","context","getContext","translate","Math","PI","drawImage","toBlob","blob","URL","createObjectURL","el","window","Image","onload","newCropPercent","newZoom","isOpen","onToggle","search","round","toggleProps","rotateRightIcon"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\n\nimport Cropper from 'react-easy-crop';\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\n\nimport { BlockControls } from '@wordpress/block-editor';\nimport { useState } from '@wordpress/element';\nimport {\n\tsearch,\n\tcheck,\n\trotateRight as rotateRightIcon,\n\taspectRatio as aspectRatioIcon,\n} from '@wordpress/icons';\nimport {\n\tToolbarGroup,\n\tToolbarButton,\n\tToolbarItem,\n\tSpinner,\n\tRangeControl,\n\tDropdownMenu,\n\tMenuGroup,\n\tMenuItem,\n\tDropdown,\n} from '@wordpress/components';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { useDispatch } from '@wordpress/data';\nimport apiFetch from '@wordpress/api-fetch';\n\nconst MIN_ZOOM = 100;\nconst MAX_ZOOM = 300;\nconst POPOVER_PROPS = {\n\tposition: 'bottom right',\n\tisAlternate: true,\n};\n\nfunction AspectGroup( { aspectRatios, isDisabled, label, onClick, value } ) {\n\treturn (\n\t\t<MenuGroup label={ label }>\n\t\t\t{ aspectRatios.map( ( { title, aspect } ) => (\n\t\t\t\t<MenuItem\n\t\t\t\t\tkey={ aspect }\n\t\t\t\t\tisDisabled={ isDisabled }\n\t\t\t\t\tonClick={ () => {\n\t\t\t\t\t\tonClick( aspect );\n\t\t\t\t\t} }\n\t\t\t\t\trole=\"menuitemradio\"\n\t\t\t\t\tisSelected={ aspect === value }\n\t\t\t\t\ticon={ aspect === value ? check : undefined }\n\t\t\t\t>\n\t\t\t\t\t{ title }\n\t\t\t\t</MenuItem>\n\t\t\t) ) }\n\t\t</MenuGroup>\n\t);\n}\n\nfunction AspectMenu( { isDisabled, onClick, value, defaultValue } ) {\n\treturn (\n\t\t<DropdownMenu\n\t\t\ticon={ aspectRatioIcon }\n\t\t\tlabel={ __( 'Aspect Ratio' ) }\n\t\t\tpopoverProps={ POPOVER_PROPS }\n\t\t\tclassName=\"wp-block-image__aspect-ratio\"\n\t\t>\n\t\t\t{ ( { onClose } ) => (\n\t\t\t\t<>\n\t\t\t\t\t<AspectGroup\n\t\t\t\t\t\tisDisabled={ isDisabled }\n\t\t\t\t\t\tonClick={ ( aspect ) => {\n\t\t\t\t\t\t\tonClick( aspect );\n\t\t\t\t\t\t\tonClose();\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tvalue={ value }\n\t\t\t\t\t\taspectRatios={ [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: __( 'Original' ),\n\t\t\t\t\t\t\t\taspect: defaultValue,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: __( 'Square' ),\n\t\t\t\t\t\t\t\taspect: 1,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t] }\n\t\t\t\t\t/>\n\t\t\t\t\t<AspectGroup\n\t\t\t\t\t\tlabel={ __( 'Landscape' ) }\n\t\t\t\t\t\tisDisabled={ isDisabled }\n\t\t\t\t\t\tonClick={ ( aspect ) => {\n\t\t\t\t\t\t\tonClick( aspect );\n\t\t\t\t\t\t\tonClose();\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tvalue={ value }\n\t\t\t\t\t\taspectRatios={ [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: __( '16:10' ),\n\t\t\t\t\t\t\t\taspect: 16 / 10,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: __( '16:9' ),\n\t\t\t\t\t\t\t\taspect: 16 / 9,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: __( '4:3' ),\n\t\t\t\t\t\t\t\taspect: 4 / 3,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: __( '3:2' ),\n\t\t\t\t\t\t\t\taspect: 3 / 2,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t] }\n\t\t\t\t\t/>\n\t\t\t\t\t<AspectGroup\n\t\t\t\t\t\tlabel={ __( 'Portrait' ) }\n\t\t\t\t\t\tisDisabled={ isDisabled }\n\t\t\t\t\t\tonClick={ ( aspect ) => {\n\t\t\t\t\t\t\tonClick( aspect );\n\t\t\t\t\t\t\tonClose();\n\t\t\t\t\t\t} }\n\t\t\t\t\t\tvalue={ value }\n\t\t\t\t\t\taspectRatios={ [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: __( '10:16' ),\n\t\t\t\t\t\t\t\taspect: 10 / 16,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: __( '9:16' ),\n\t\t\t\t\t\t\t\taspect: 9 / 16,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: __( '3:4' ),\n\t\t\t\t\t\t\t\taspect: 3 / 4,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: __( '2:3' ),\n\t\t\t\t\t\t\t\taspect: 2 / 3,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t] }\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t) }\n\t\t</DropdownMenu>\n\t);\n}\n\nexport default function ImageEditor( {\n\tid,\n\turl,\n\tsetAttributes,\n\tnaturalWidth,\n\tnaturalHeight,\n\twidth,\n\theight,\n\tclientWidth,\n\tsetIsEditingImage,\n} ) {\n\tconst { createErrorNotice } = useDispatch( 'core/notices' );\n\tconst [ inProgress, setIsProgress ] = useState( false );\n\tconst [ crop, setCrop ] = useState( null );\n\tconst [ position, setPosition ] = useState( { x: 0, y: 0 } );\n\tconst [ zoom, setZoom ] = useState( 100 );\n\tconst [ aspect, setAspect ] = useState( naturalWidth / naturalHeight );\n\tconst [ rotation, setRotation ] = useState( 0 );\n\tconst [ editedUrl, setEditedUrl ] = useState();\n\n\tconst editedWidth = width;\n\tlet editedHeight = height || ( clientWidth * naturalHeight ) / naturalWidth;\n\tlet naturalAspectRatio = naturalWidth / naturalHeight;\n\n\tif ( rotation % 180 === 90 ) {\n\t\teditedHeight = ( clientWidth * naturalWidth ) / naturalHeight;\n\t\tnaturalAspectRatio = naturalHeight / naturalWidth;\n\t}\n\n\tfunction apply() {\n\t\tsetIsProgress( true );\n\n\t\tlet attrs = {};\n\n\t\t// The crop script may return some very small, sub-pixel values when the image was not cropped.\n\t\t// Crop only when the new size has changed by more than 0.1%.\n\t\tif ( crop.width < 99.9 || crop.height < 99.9 ) {\n\t\t\tattrs = crop;\n\t\t}\n\n\t\tif ( rotation > 0 ) {\n\t\t\tattrs.rotation = rotation;\n\t\t}\n\n\t\tattrs.src = url;\n\n\t\tapiFetch( {\n\t\t\tpath: `/wp/v2/media/${ id }/edit`,\n\t\t\tmethod: 'POST',\n\t\t\tdata: attrs,\n\t\t} )\n\t\t\t.then( ( response ) => {\n\t\t\t\tsetAttributes( {\n\t\t\t\t\tid: response.id,\n\t\t\t\t\turl: response.source_url,\n\t\t\t\t\theight: height && width ? width / aspect : undefined,\n\t\t\t\t} );\n\t\t\t} )\n\t\t\t.catch( ( error ) => {\n\t\t\t\tcreateErrorNotice(\n\t\t\t\t\tsprintf(\n\t\t\t\t\t\t/* translators: 1. Error message */\n\t\t\t\t\t\t__( 'Could not edit image. %s' ),\n\t\t\t\t\t\terror.message\n\t\t\t\t\t),\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'image-editing-error',\n\t\t\t\t\t\ttype: 'snackbar',\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} )\n\t\t\t.finally( () => {\n\t\t\t\tsetIsProgress( false );\n\t\t\t\tsetIsEditingImage( false );\n\t\t\t} );\n\t}\n\n\tfunction rotate() {\n\t\tconst angle = ( rotation + 90 ) % 360;\n\n\t\tif ( angle === 0 ) {\n\t\t\tsetEditedUrl();\n\t\t\tsetRotation( angle );\n\t\t\tsetAspect( 1 / aspect );\n\t\t\tsetPosition( {\n\t\t\t\tx: -( position.y * naturalAspectRatio ),\n\t\t\t\ty: position.x * naturalAspectRatio,\n\t\t\t} );\n\t\t\treturn;\n\t\t}\n\n\t\tfunction editImage( event ) {\n\t\t\tconst canvas = document.createElement( 'canvas' );\n\n\t\t\tlet translateX = 0;\n\t\t\tlet translateY = 0;\n\n\t\t\tif ( angle % 180 ) {\n\t\t\t\tcanvas.width = event.target.height;\n\t\t\t\tcanvas.height = event.target.width;\n\t\t\t} else {\n\t\t\t\tcanvas.width = event.target.width;\n\t\t\t\tcanvas.height = event.target.height;\n\t\t\t}\n\n\t\t\tif ( angle === 90 || angle === 180 ) {\n\t\t\t\ttranslateX = canvas.width;\n\t\t\t}\n\n\t\t\tif ( angle === 270 || angle === 180 ) {\n\t\t\t\ttranslateY = canvas.height;\n\t\t\t}\n\n\t\t\tconst context = canvas.getContext( '2d' );\n\n\t\t\tcontext.translate( translateX, translateY );\n\t\t\tcontext.rotate( ( angle * Math.PI ) / 180 );\n\t\t\tcontext.drawImage( event.target, 0, 0 );\n\n\t\t\tcanvas.toBlob( ( blob ) => {\n\t\t\t\tsetEditedUrl( URL.createObjectURL( blob ) );\n\t\t\t\tsetRotation( angle );\n\t\t\t\tsetAspect( 1 / aspect );\n\t\t\t\tsetPosition( {\n\t\t\t\t\tx: -( position.y * naturalAspectRatio ),\n\t\t\t\t\ty: position.x * naturalAspectRatio,\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\n\t\tconst el = new window.Image();\n\t\tel.src = url;\n\t\tel.onload = editImage;\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<div\n\t\t\t\tclassName={ classnames( 'wp-block-image__crop-area', {\n\t\t\t\t\t'is-applying': inProgress,\n\t\t\t\t} ) }\n\t\t\t\tstyle={ {\n\t\t\t\t\twidth: editedWidth,\n\t\t\t\t\theight: editedHeight,\n\t\t\t\t} }\n\t\t\t>\n\t\t\t\t<Cropper\n\t\t\t\t\timage={ editedUrl || url }\n\t\t\t\t\tdisabled={ inProgress }\n\t\t\t\t\tminZoom={ MIN_ZOOM / 100 }\n\t\t\t\t\tmaxZoom={ MAX_ZOOM / 100 }\n\t\t\t\t\tcrop={ position }\n\t\t\t\t\tzoom={ zoom / 100 }\n\t\t\t\t\taspect={ aspect }\n\t\t\t\t\tonCropChange={ setPosition }\n\t\t\t\t\tonCropComplete={ ( newCropPercent ) => {\n\t\t\t\t\t\tsetCrop( newCropPercent );\n\t\t\t\t\t} }\n\t\t\t\t\tonZoomChange={ ( newZoom ) => {\n\t\t\t\t\t\tsetZoom( newZoom * 100 );\n\t\t\t\t\t} }\n\t\t\t\t/>\n\t\t\t\t{ inProgress && <Spinner /> }\n\t\t\t</div>\n\t\t\t<BlockControls>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<Dropdown\n\t\t\t\t\t\tcontentClassName=\"wp-block-image__zoom\"\n\t\t\t\t\t\tpopoverProps={ POPOVER_PROPS }\n\t\t\t\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\t\ticon={ search }\n\t\t\t\t\t\t\t\tlabel={ __( 'Zoom' ) }\n\t\t\t\t\t\t\t\tonClick={ onToggle }\n\t\t\t\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\t\t\t\tdisabled={ inProgress }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t\trenderContent={ () => (\n\t\t\t\t\t\t\t<RangeControl\n\t\t\t\t\t\t\t\tmin={ MIN_ZOOM }\n\t\t\t\t\t\t\t\tmax={ MAX_ZOOM }\n\t\t\t\t\t\t\t\tvalue={ Math.round( zoom ) }\n\t\t\t\t\t\t\t\tonChange={ setZoom }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t/>\n\t\t\t\t\t<ToolbarItem>\n\t\t\t\t\t\t{ ( toggleProps ) => (\n\t\t\t\t\t\t\t<AspectMenu\n\t\t\t\t\t\t\t\ttoggleProps={ toggleProps }\n\t\t\t\t\t\t\t\tisDisabled={ inProgress }\n\t\t\t\t\t\t\t\tonClick={ setAspect }\n\t\t\t\t\t\t\t\tvalue={ aspect }\n\t\t\t\t\t\t\t\tdefaultValue={ naturalWidth / naturalHeight }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</ToolbarItem>\n\t\t\t\t</ToolbarGroup>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\ticon={ rotateRightIcon }\n\t\t\t\t\t\tlabel={ __( 'Rotate' ) }\n\t\t\t\t\t\tonClick={ rotate }\n\t\t\t\t\t\tdisabled={ inProgress }\n\t\t\t\t\t/>\n\t\t\t\t</ToolbarGroup>\n\t\t\t\t<ToolbarGroup>\n\t\t\t\t\t<ToolbarButton onClick={ apply } disabled={ inProgress }>\n\t\t\t\t\t\t{ __( 'Apply' ) }\n\t\t\t\t\t</ToolbarButton>\n\t\t\t\t\t<ToolbarButton onClick={ () => setIsEditingImage( false ) }>\n\t\t\t\t\t\t{ __( 'Cancel' ) }\n\t\t\t\t\t</ToolbarButton>\n\t\t\t\t</ToolbarGroup>\n\t\t\t</BlockControls>\n\t\t</>\n\t);\n}\n"]}