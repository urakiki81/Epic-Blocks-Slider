{"version":3,"sources":["@wordpress/block-library/src/gallery/gallery.native.js"],"names":["TILE_SPACING","MAX_DISPLAYED_COLUMNS","MAX_DISPLAYED_COLUMNS_NARROW","Gallery","props","isCaptionSelected","setIsCaptionSelected","mediaUploadSync","isRTL","select","getSettings","clientId","selectedImage","mediaPlaceholder","onBlur","onMoveBackward","onMoveForward","onRemoveImage","onSelectImage","onSetImageAttributes","onFocusGalleryCaption","attributes","isSelected","isNarrow","onFocus","insertBlocksAfter","columns","imageCrop","images","displayedColumns","Math","min","selectImage","index","focusGalleryCaption","flex","styles","galleryTilesContainerSelected","undefined","map","img","ariaLabel","length","id","url","alt","parseInt","attrs","caption"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { View } from 'react-native';\nimport { isEmpty } from 'lodash';\n\n/**\n * Internal dependencies\n */\nimport GalleryImage from './gallery-image';\nimport { defaultColumnsNumber } from './shared';\nimport styles from './gallery-styles.scss';\nimport Tiles from './tiles';\n\n/**\n * WordPress dependencies\n */\nimport { __, sprintf } from '@wordpress/i18n';\nimport { BlockCaption } from '@wordpress/block-editor';\nimport { useState, useEffect } from '@wordpress/element';\nimport { mediaUploadSync } from '@wordpress/react-native-bridge';\nimport { useSelect } from '@wordpress/data';\n\nconst TILE_SPACING = 15;\n\n// we must limit displayed columns since readable content max-width is 580px\nconst MAX_DISPLAYED_COLUMNS = 4;\nconst MAX_DISPLAYED_COLUMNS_NARROW = 2;\n\nexport const Gallery = ( props ) => {\n\tconst [ isCaptionSelected, setIsCaptionSelected ] = useState( false );\n\tuseEffect( mediaUploadSync, [] );\n\n\tconst isRTL = useSelect( ( select ) => {\n\t\treturn !! select( 'core/block-editor' ).getSettings().isRTL;\n\t}, [] );\n\n\tconst {\n\t\tclientId,\n\t\tselectedImage,\n\t\tmediaPlaceholder,\n\t\tonBlur,\n\t\tonMoveBackward,\n\t\tonMoveForward,\n\t\tonRemoveImage,\n\t\tonSelectImage,\n\t\tonSetImageAttributes,\n\t\tonFocusGalleryCaption,\n\t\tattributes,\n\t\tisSelected,\n\t\tisNarrow,\n\t\tonFocus,\n\t\tinsertBlocksAfter,\n\t} = props;\n\n\tconst {\n\t\tcolumns = defaultColumnsNumber( attributes ),\n\t\timageCrop,\n\t\timages,\n\t} = attributes;\n\n\t// limit displayed columns when isNarrow is true (i.e. when viewport width is\n\t// less than \"small\", where small = 600)\n\tconst displayedColumns = isNarrow\n\t\t? Math.min( columns, MAX_DISPLAYED_COLUMNS_NARROW )\n\t\t: Math.min( columns, MAX_DISPLAYED_COLUMNS );\n\n\tconst selectImage = ( index ) => {\n\t\treturn () => {\n\t\t\tif ( isCaptionSelected ) {\n\t\t\t\tsetIsCaptionSelected( false );\n\t\t\t}\n\t\t\t// we need to fully invoke the curried function here\n\t\t\tonSelectImage( index )();\n\t\t};\n\t};\n\n\tconst focusGalleryCaption = () => {\n\t\tif ( ! isCaptionSelected ) {\n\t\t\tsetIsCaptionSelected( true );\n\t\t}\n\t\tonFocusGalleryCaption();\n\t};\n\n\treturn (\n\t\t<View style={ { flex: 1 } }>\n\t\t\t<Tiles\n\t\t\t\tcolumns={ displayedColumns }\n\t\t\t\tspacing={ TILE_SPACING }\n\t\t\t\tstyle={\n\t\t\t\t\tisSelected\n\t\t\t\t\t\t? styles.galleryTilesContainerSelected\n\t\t\t\t\t\t: undefined\n\t\t\t\t}\n\t\t\t>\n\t\t\t\t{ images.map( ( img, index ) => {\n\t\t\t\t\tconst ariaLabel = sprintf(\n\t\t\t\t\t\t/* translators: 1: the order number of the image. 2: the total number of images. */\n\t\t\t\t\t\t__( 'image %1$d of %2$d in gallery' ),\n\t\t\t\t\t\tindex + 1,\n\t\t\t\t\t\timages.length\n\t\t\t\t\t);\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<GalleryImage\n\t\t\t\t\t\t\tkey={ img.id || img.url }\n\t\t\t\t\t\t\turl={ img.url }\n\t\t\t\t\t\t\talt={ img.alt }\n\t\t\t\t\t\t\tid={ parseInt( img.id, 10 ) } // make id an integer explicitly\n\t\t\t\t\t\t\tisCropped={ imageCrop }\n\t\t\t\t\t\t\tisFirstItem={ index === 0 }\n\t\t\t\t\t\t\tisLastItem={ index + 1 === images.length }\n\t\t\t\t\t\t\tisSelected={ isSelected && selectedImage === index }\n\t\t\t\t\t\t\tisBlockSelected={ isSelected }\n\t\t\t\t\t\t\tonMoveBackward={ onMoveBackward( index ) }\n\t\t\t\t\t\t\tonMoveForward={ onMoveForward( index ) }\n\t\t\t\t\t\t\tonRemove={ onRemoveImage( index ) }\n\t\t\t\t\t\t\tonSelect={ selectImage( index ) }\n\t\t\t\t\t\t\tonSelectBlock={ onFocus }\n\t\t\t\t\t\t\tsetAttributes={ ( attrs ) =>\n\t\t\t\t\t\t\t\tonSetImageAttributes( index, attrs )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcaption={ img.caption }\n\t\t\t\t\t\t\taria-label={ ariaLabel }\n\t\t\t\t\t\t\tisRTL={ isRTL }\n\t\t\t\t\t\t/>\n\t\t\t\t\t);\n\t\t\t\t} ) }\n\t\t\t</Tiles>\n\t\t\t{ mediaPlaceholder }\n\t\t\t<BlockCaption\n\t\t\t\tclientId={ clientId }\n\t\t\t\tisSelected={ isCaptionSelected }\n\t\t\t\taccessible={ true }\n\t\t\t\taccessibilityLabelCreator={ ( caption ) =>\n\t\t\t\t\tisEmpty( caption )\n\t\t\t\t\t\t? /* translators: accessibility text. Empty gallery caption. */\n\t\t\t\t\t\t  'Gallery caption. Empty'\n\t\t\t\t\t\t: sprintf(\n\t\t\t\t\t\t\t\t/* translators: accessibility text. %s: gallery caption. */\n\t\t\t\t\t\t\t\t__( 'Gallery caption. %s' ),\n\t\t\t\t\t\t\t\tcaption\n\t\t\t\t\t\t  )\n\t\t\t\t}\n\t\t\t\tonFocus={ focusGalleryCaption }\n\t\t\t\tonBlur={ onBlur } // always assign onBlur as props\n\t\t\t\tinsertBlocksAfter={ insertBlocksAfter }\n\t\t\t/>\n\t\t</View>\n\t);\n};\n\nexport default Gallery;\n"]}