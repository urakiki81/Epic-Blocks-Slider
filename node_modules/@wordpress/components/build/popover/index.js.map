{"version":3,"sources":["@wordpress/components/src/popover/index.js"],"names":["FocusManaged","children","SLOT_NAME","Popover","arguments","getAnchorRect","bind","computePopoverPosition","maybeClose","throttledRefresh","refresh","refreshOnAnchorMove","contentNode","anchorNode","state","popoverLeft","popoverTop","yAxis","xAxis","contentHeight","contentWidth","isMobile","popoverSize","isReadyToAnimate","anchorRect","toggleAutoRefresh","props","hasOwnProperty","focusTimeout","setTimeout","focus","prevProps","position","hasAnchorRect","clearTimeout","isActive","window","cancelAnimationFrame","rafHandle","handler","autoRefresh","setInterval","clearInterval","event","type","current","contains","target","requestAnimationFrame","didAnchorRectChange","contentRect","getBoundingClientRect","width","height","didPopoverSizeChange","setState","focusOnMount","firstTabbable","tabbable","find","anchor","parentNode","rect","getComputedStyle","paddingTop","paddingBottom","topPad","parseInt","bottomPad","x","left","y","top","right","bottom","expandOnMobile","newPopoverPosition","onKeyDown","onClose","keyCode","ESCAPE","stopPropagation","headerTitle","className","onClickOutside","noArrow","range","animate","contentProps","yAxisMapping","xAxisMapping","animateYAxis","animateXAxis","classes","content","origin","animateClassName","undefined","visibility","maxHeight","maxWidth","getSlot","Component","defaultProps","PopoverContainer","Slot"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport classnames from 'classnames';\n\n/**\n * WordPress dependencies\n */\nimport { Component, createRef } from '@wordpress/element';\nimport { focus } from '@wordpress/dom';\nimport { ESCAPE } from '@wordpress/keycodes';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\n\n/**\n * Internal dependencies\n */\nimport { computePopoverPosition } from './utils';\nimport withFocusReturn from '../higher-order/with-focus-return';\nimport withConstrainedTabbing from '../higher-order/with-constrained-tabbing';\nimport PopoverDetectOutside from './detect-outside';\nimport IconButton from '../icon-button';\nimport ScrollLock from '../scroll-lock';\nimport IsolatedEventContainer from '../isolated-event-container';\nimport { Slot, Fill, Consumer } from '../slot-fill';\nimport Animate from '../animate';\n\nconst FocusManaged = withConstrainedTabbing( withFocusReturn( ( { children } ) => children ) );\n\n/**\n * Name of slot in which popover should fill.\n *\n * @type {String}\n */\nconst SLOT_NAME = 'Popover';\n\nclass Popover extends Component {\n\tconstructor() {\n\t\tsuper( ...arguments );\n\n\t\tthis.getAnchorRect = this.getAnchorRect.bind( this );\n\t\tthis.computePopoverPosition = this.computePopoverPosition.bind( this );\n\t\tthis.maybeClose = this.maybeClose.bind( this );\n\t\tthis.throttledRefresh = this.throttledRefresh.bind( this );\n\t\tthis.refresh = this.refresh.bind( this );\n\t\tthis.refreshOnAnchorMove = this.refreshOnAnchorMove.bind( this );\n\n\t\tthis.contentNode = createRef();\n\t\tthis.anchorNode = createRef();\n\n\t\tthis.state = {\n\t\t\tpopoverLeft: null,\n\t\t\tpopoverTop: null,\n\t\t\tyAxis: 'top',\n\t\t\txAxis: 'center',\n\t\t\tcontentHeight: null,\n\t\t\tcontentWidth: null,\n\t\t\tisMobile: false,\n\t\t\tpopoverSize: null,\n\n\t\t\t// Delay the animation after the initial render\n\t\t\t// because the animation have impact on the height of the popover\n\t\t\t// causing the computed position to be wrong.\n\t\t\tisReadyToAnimate: false,\n\t\t};\n\n\t\t// Property used keep track of the previous anchor rect\n\t\t// used to compute the popover position and size.\n\t\tthis.anchorRect = {};\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.toggleAutoRefresh( ! this.props.hasOwnProperty( 'anchorRect' ) );\n\t\tthis.refresh();\n\n\t\t/*\n\t\t * Without the setTimeout, the dom node is not being focused. Related:\n\t\t * https://stackoverflow.com/questions/35522220/react-ref-with-focus-doesnt-work-without-settimeout-my-example\n\t\t *\n\t\t * TODO: Treat the cause, not the symptom.\n\t\t */\n\t\tthis.focusTimeout = setTimeout( () => {\n\t\t\tthis.focus();\n\t\t}, 0 );\n\t}\n\n\tcomponentDidUpdate( prevProps ) {\n\t\tif ( prevProps.position !== this.props.position ) {\n\t\t\tthis.computePopoverPosition( this.state.popoverSize, this.anchorRect );\n\t\t}\n\n\t\tif ( prevProps.anchorRect !== this.props.anchorRect ) {\n\t\t\tthis.refreshOnAnchorMove();\n\t\t}\n\n\t\tconst hasAnchorRect = this.props.hasOwnProperty( 'anchorRect' );\n\t\tif ( hasAnchorRect !== prevProps.hasOwnProperty( 'anchorRect' ) ) {\n\t\t\tthis.toggleAutoRefresh( ! hasAnchorRect );\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tclearTimeout( this.focusTimeout );\n\t\tthis.toggleAutoRefresh( false );\n\t}\n\n\ttoggleAutoRefresh( isActive ) {\n\t\twindow.cancelAnimationFrame( this.rafHandle );\n\n\t\t// Refresh the popover every time the window is resized or scrolled\n\t\tconst handler = isActive ? 'addEventListener' : 'removeEventListener';\n\t\twindow[ handler ]( 'resize', this.throttledRefresh );\n\t\twindow[ handler ]( 'scroll', this.throttledRefresh, true );\n\n\t\t/*\n\t\t * There are sometimes we need to reposition or resize the popover that are not\n\t\t * handled by the resize/scroll window events (i.e. CSS changes in the layout\n\t\t * that changes the position of the anchor).\n\t\t *\n\t\t * For these situations, we refresh the popover every 0.5s\n\t\t */\n\t\tif ( isActive ) {\n\t\t\tthis.autoRefresh = setInterval( this.refreshOnAnchorMove, 500 );\n\t\t} else {\n\t\t\tclearInterval( this.autoRefresh );\n\t\t}\n\t}\n\n\tthrottledRefresh( event ) {\n\t\twindow.cancelAnimationFrame( this.rafHandle );\n\t\tif ( event && event.type === 'scroll' && this.contentNode.current.contains( event.target ) ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.rafHandle = window.requestAnimationFrame( this.refresh );\n\t}\n\n\t/**\n\t * Calling refreshOnAnchorMove\n\t * will only refresh the popover position if the anchor moves.\n\t */\n\trefreshOnAnchorMove() {\n\t\tconst anchorRect = this.getAnchorRect( this.anchorNode.current );\n\t\tconst didAnchorRectChange = ! isShallowEqual( anchorRect, this.anchorRect );\n\t\tif ( didAnchorRectChange ) {\n\t\t\tthis.anchorRect = anchorRect;\n\t\t\tthis.computePopoverPosition( this.state.popoverSize, anchorRect );\n\t\t}\n\t}\n\n\t/**\n\t * Calling `refresh()` will force the Popover to recalculate its size and\n\t * position. This is useful when a DOM change causes the anchor node to change\n\t * position.\n\t */\n\trefresh() {\n\t\tconst anchorRect = this.getAnchorRect( this.anchorNode.current );\n\t\tconst contentRect = this.contentNode.current.getBoundingClientRect();\n\t\tconst popoverSize = {\n\t\t\twidth: contentRect.width,\n\t\t\theight: contentRect.height,\n\t\t};\n\t\tconst didPopoverSizeChange = ! this.state.popoverSize || (\n\t\t\tpopoverSize.width !== this.state.popoverSize.width ||\n\t\t\tpopoverSize.height !== this.state.popoverSize.height\n\t\t);\n\t\tif ( didPopoverSizeChange ) {\n\t\t\tthis.setState( { popoverSize, isReadyToAnimate: true } );\n\t\t}\n\t\tthis.anchorRect = anchorRect;\n\t\tthis.computePopoverPosition( popoverSize, anchorRect );\n\t}\n\n\tfocus() {\n\t\tconst { focusOnMount } = this.props;\n\n\t\tif ( ! focusOnMount || ! this.contentNode.current ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( focusOnMount === 'firstElement' ) {\n\t\t\t// Find first tabbable node within content and shift focus, falling\n\t\t\t// back to the popover panel itself.\n\t\t\tconst firstTabbable = focus.tabbable.find( this.contentNode.current )[ 0 ];\n\n\t\t\tif ( firstTabbable ) {\n\t\t\t\tfirstTabbable.focus();\n\t\t\t} else {\n\t\t\t\tthis.contentNode.current.focus();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif ( focusOnMount === 'container' ) {\n\t\t\t// Focus the popover panel itself so items in the popover are easily\n\t\t\t// accessed via keyboard navigation.\n\t\t\tthis.contentNode.current.focus();\n\t\t}\n\t}\n\n\tgetAnchorRect( anchor ) {\n\t\tconst { getAnchorRect, anchorRect } = this.props;\n\n\t\tif ( anchorRect ) {\n\t\t\treturn anchorRect;\n\t\t}\n\n\t\tif ( getAnchorRect ) {\n\t\t\treturn getAnchorRect( anchor );\n\t\t}\n\n\t\tif ( ! anchor || ! anchor.parentNode ) {\n\t\t\treturn;\n\t\t}\n\t\tconst rect = anchor.parentNode.getBoundingClientRect();\n\t\t// subtract padding\n\t\tconst { paddingTop, paddingBottom } = window.getComputedStyle( anchor.parentNode );\n\t\tconst topPad = parseInt( paddingTop, 10 );\n\t\tconst bottomPad = parseInt( paddingBottom, 10 );\n\t\treturn {\n\t\t\tx: rect.left,\n\t\t\ty: rect.top + topPad,\n\t\t\twidth: rect.width,\n\t\t\theight: rect.height - topPad - bottomPad,\n\t\t\tleft: rect.left,\n\t\t\tright: rect.right,\n\t\t\ttop: rect.top + topPad,\n\t\t\tbottom: rect.bottom - bottomPad,\n\t\t};\n\t}\n\n\tcomputePopoverPosition( popoverSize, anchorRect ) {\n\t\tconst { position = 'top', expandOnMobile } = this.props;\n\t\tconst newPopoverPosition = computePopoverPosition(\n\t\t\tanchorRect,\n\t\t\tpopoverSize,\n\t\t\tposition,\n\t\t\texpandOnMobile\n\t\t);\n\n\t\tif (\n\t\t\tthis.state.yAxis !== newPopoverPosition.yAxis ||\n\t\t\tthis.state.xAxis !== newPopoverPosition.xAxis ||\n\t\t\tthis.state.popoverLeft !== newPopoverPosition.popoverLeft ||\n\t\t\tthis.state.popoverTop !== newPopoverPosition.popoverTop ||\n\t\t\tthis.state.contentHeight !== newPopoverPosition.contentHeight ||\n\t\t\tthis.state.contentWidth !== newPopoverPosition.contentWidth ||\n\t\t\tthis.state.isMobile !== newPopoverPosition.isMobile\n\t\t) {\n\t\t\tthis.setState( newPopoverPosition );\n\t\t}\n\t}\n\n\tmaybeClose( event ) {\n\t\tconst { onKeyDown, onClose } = this.props;\n\n\t\t// Close on escape\n\t\tif ( event.keyCode === ESCAPE && onClose ) {\n\t\t\tevent.stopPropagation();\n\t\t\tonClose();\n\t\t}\n\n\t\t// Preserve original content prop behavior\n\t\tif ( onKeyDown ) {\n\t\t\tonKeyDown( event );\n\t\t}\n\t}\n\n\trender() {\n\t\tconst {\n\t\t\theaderTitle,\n\t\t\tonClose,\n\t\t\tchildren,\n\t\t\tclassName,\n\t\t\tonClickOutside = onClose,\n\t\t\tnoArrow,\n\t\t\t// Disable reason: We generate the `...contentProps` rest as remainder\n\t\t\t// of props which aren't explicitly handled by this component.\n\t\t\t/* eslint-disable no-unused-vars */\n\t\t\tposition,\n\t\t\trange,\n\t\t\tfocusOnMount,\n\t\t\tgetAnchorRect,\n\t\t\texpandOnMobile,\n\t\t\tanimate = true,\n\t\t\tanchorRect,\n\t\t\t/* eslint-enable no-unused-vars */\n\t\t\t...contentProps\n\t\t} = this.props;\n\t\tconst {\n\t\t\tpopoverLeft,\n\t\t\tpopoverTop,\n\t\t\tyAxis,\n\t\t\txAxis,\n\t\t\tcontentHeight,\n\t\t\tcontentWidth,\n\t\t\tpopoverSize,\n\t\t\tisMobile,\n\t\t\tisReadyToAnimate,\n\t\t} = this.state;\n\n\t\t// Compute the animation position\n\t\tconst yAxisMapping = {\n\t\t\ttop: 'bottom',\n\t\t\tbottom: 'top',\n\t\t};\n\t\tconst xAxisMapping = {\n\t\t\tleft: 'right',\n\t\t\tright: 'left',\n\t\t};\n\t\tconst animateYAxis = yAxisMapping[ yAxis ] || 'middle';\n\t\tconst animateXAxis = xAxisMapping[ xAxis ] || 'center';\n\n\t\tconst classes = classnames(\n\t\t\t'components-popover',\n\t\t\tclassName,\n\t\t\t'is-' + yAxis,\n\t\t\t'is-' + xAxis,\n\t\t\t{\n\t\t\t\t'is-mobile': isMobile,\n\t\t\t\t'is-without-arrow': noArrow || ( xAxis === 'center' && yAxis === 'middle' ),\n\t\t\t}\n\t\t);\n\n\t\t// Disable reason: We care to capture the _bubbled_ events from inputs\n\t\t// within popover as inferring close intent.\n\n\t\t/* eslint-disable jsx-a11y/no-static-element-interactions */\n\t\tlet content = (\n\t\t\t<PopoverDetectOutside onClickOutside={ onClickOutside }>\n\t\t\t\t<Animate\n\t\t\t\t\ttype={ animate && isReadyToAnimate ? 'appear' : null }\n\t\t\t\t\toptions={ { origin: animateYAxis + ' ' + animateXAxis } }\n\t\t\t\t>\n\t\t\t\t\t{ ( { className: animateClassName } ) => (\n\t\t\t\t\t\t<IsolatedEventContainer\n\t\t\t\t\t\t\tclassName={ classnames( classes, animateClassName ) }\n\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\ttop: ! isMobile && popoverTop ? popoverTop + 'px' : undefined,\n\t\t\t\t\t\t\t\tleft: ! isMobile && popoverLeft ? popoverLeft + 'px' : undefined,\n\t\t\t\t\t\t\t\tvisibility: popoverSize ? undefined : 'hidden',\n\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t{ ...contentProps }\n\t\t\t\t\t\t\tonKeyDown={ this.maybeClose }\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ isMobile && (\n\t\t\t\t\t\t\t\t<div className=\"components-popover__header\">\n\t\t\t\t\t\t\t\t\t<span className=\"components-popover__header-title\">\n\t\t\t\t\t\t\t\t\t\t{ headerTitle }\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<IconButton className=\"components-popover__close\" icon=\"no-alt\" onClick={ onClose } />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tref={ this.contentNode }\n\t\t\t\t\t\t\t\tclassName=\"components-popover__content\"\n\t\t\t\t\t\t\t\tstyle={ {\n\t\t\t\t\t\t\t\t\tmaxHeight: ! isMobile && contentHeight ? contentHeight + 'px' : undefined,\n\t\t\t\t\t\t\t\t\tmaxWidth: ! isMobile && contentWidth ? contentWidth + 'px' : undefined,\n\t\t\t\t\t\t\t\t} }\n\t\t\t\t\t\t\t\ttabIndex=\"-1\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{ children }\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</IsolatedEventContainer>\n\t\t\t\t\t) }\n\t\t\t\t</Animate>\n\t\t\t</PopoverDetectOutside>\n\t\t);\n\t\t/* eslint-enable jsx-a11y/no-static-element-interactions */\n\n\t\t// Apply focus to element as long as focusOnMount is truthy; false is\n\t\t// the only \"disabled\" value.\n\t\tif ( focusOnMount ) {\n\t\t\tcontent = <FocusManaged>{ content }</FocusManaged>;\n\t\t}\n\n\t\treturn (\n\t\t\t<Consumer>\n\t\t\t\t{ ( { getSlot } ) => {\n\t\t\t\t\t// In case there is no slot context in which to render,\n\t\t\t\t\t// default to an in-place rendering.\n\t\t\t\t\tif ( getSlot && getSlot( SLOT_NAME ) ) {\n\t\t\t\t\t\tcontent = <Fill name={ SLOT_NAME }>{ content }</Fill>;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<span ref={ this.anchorNode }>\n\t\t\t\t\t\t\t{ content }\n\t\t\t\t\t\t\t{ isMobile && expandOnMobile && <ScrollLock /> }\n\t\t\t\t\t\t</span>\n\t\t\t\t\t);\n\t\t\t\t} }\n\t\t\t</Consumer>\n\t\t);\n\t}\n}\n\nPopover.defaultProps = {\n\tfocusOnMount: 'firstElement',\n\tnoArrow: false,\n};\n\nconst PopoverContainer = Popover;\n\nPopoverContainer.Slot = () => <Slot bubblesVirtually name={ SLOT_NAME } />;\n\nexport default PopoverContainer;\n"]}